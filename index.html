<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제주교육청 스마트단말 관리 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .tg-header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
        }
        .tg-sidebar {
            background: linear-gradient(180deg, #e2e8f0 0%, #cbd5e0 100%);
            border-right: 1px solid #cbd5e0;
        }
        .tg-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .tg-button-primary {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.3s;
        }
        .tg-button-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        .tg-table {
            border-collapse: collapse;
            width: 100%;
        }
        .tg-table th {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            padding: 12px;
            text-align: center;
            border: 1px solid #cbd5e0;
        }
        .tg-table td {
            padding: 10px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        .login-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .stats-card {
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: white;
            margin: 10px;
        }
        .stats-1st { background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%); }
        .stats-2nd { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        .stats-total { background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); }
        .stats-alert { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); }
    </style>
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="text-center mb-8">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iNTAiIGN5PSI1MCIgcj0iNDgiIGZpbGw9IiM0Mjk5ZTEiIHN0cm9rZT0iIzMxODJjZSIgc3Ryb2tlLXdpZHRoPSI0Ii8+PHRleHQgeD0iNTAiIHk9IjU1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7soJzso7w8L3RleHQ+PC9zdmc+" alt="제주교육청" class="mx-auto mb-4" style="width: 80px; height: 80px;">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">제주교육청 스마트단말 관리 시스템</h2>
                <p class="text-gray-600">관리자님 환영합니다</p>
            </div>
            
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">사용자명</label>
                    <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="사용자명을 입력하세요">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">비밀번호</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="비밀번호를 입력하세요">
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
                    <i class="fas fa-sign-in-alt mr-2"></i>로그인
                </button>
            </form>
            
            <div class="mt-6 text-center text-sm text-gray-600">
                <p>콜센터 번호: 1811-8290</p>
            </div>
        </div>
    </div>

    <!-- 메인 시스템 -->
    <div id="mainSystem" style="display: none;">
        <!-- 헤더 -->
        <header class="tg-header py-3 px-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-laptop mr-3 text-xl"></i>
                    <h1 class="text-xl font-bold">제주교육청 스마트단말 관리 시스템</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="currentUserDisplay">관리자님 환영합니다!</span>
                    <span class="text-sm opacity-75" id="currentDateTime"></span>
                </div>
            </div>
        </header>

        <div class="flex">
            <!-- 사이드바 -->
            <nav class="tg-sidebar w-64 min-h-screen p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" onclick="showPage('rental')" class="flex items-center p-3 text-gray-700 rounded hover:bg-gray-300 transition">
                            <i class="fas fa-clipboard-list mr-3"></i>대여 관리
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showPage('product')" class="flex items-center p-3 text-gray-700 rounded hover:bg-gray-300 transition">
                            <i class="fas fa-box mr-3"></i>제품 관리
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showPage('users')" class="flex items-center p-3 text-gray-700 rounded hover:bg-gray-300 transition">
                            <i class="fas fa-users mr-3"></i>사용자 관리
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showPage('feedback')" class="flex items-center p-3 text-gray-700 rounded hover:bg-gray-300 transition">
                            <i class="fas fa-comments mr-3"></i>피드백 게시판
                        </a>
                    </li>
                </ul>
                
                <div class="mt-8 pt-4 border-t border-gray-300">
                    <button onclick="logout()" class="w-full flex items-center p-3 text-red-600 rounded hover:bg-red-100 transition">
                        <i class="fas fa-sign-out-alt mr-3"></i>로그아웃
                    </button>
                </div>
            </nav>

            <!-- 메인 콘텐츠 -->
            <main class="flex-1 p-6 bg-gray-50">
                <!-- 대여 관리 페이지 -->
                <div id="rentalPage" class="page-content">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">대여 관리</h2>
                        <p class="text-gray-600 mb-4">스마트단말 대여 현황을 관리합니다.</p>
                        
                        <!-- 통계 대시보드 -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="stats-card stats-1st">
                                <div class="text-sm opacity-75 mb-1">1차 장비 수</div>
                                <div class="text-3xl font-bold" id="stats1st">0</div>
                                <i class="fas fa-laptop text-2xl mt-2"></i>
                            </div>
                            <div class="stats-card stats-2nd">
                                <div class="text-sm opacity-75 mb-1">2차 장비 수</div>
                                <div class="text-3xl font-bold" id="stats2nd">0</div>
                                <i class="fas fa-tablet-alt text-2xl mt-2"></i>
                            </div>
                            <div class="stats-card stats-total">
                                <div class="text-sm opacity-75 mb-1">대여중</div>
                                <div class="text-3xl font-bold" id="statsRented">0</div>
                                <i class="fas fa-user-check text-2xl mt-2"></i>
                            </div>
                            <div class="stats-card stats-alert">
                                <div class="text-sm opacity-75 mb-1">미 대여중</div>
                                <div class="text-3xl font-bold" id="statsAvailable">0</div>
                                <i class="fas fa-exclamation-triangle text-2xl mt-2"></i>
                            </div>
                        </div>

                        <!-- 검색 및 필터 -->
                        <div class="tg-card p-4 mb-4">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">통합 검색</label>
                                    <input type="text" id="rentalSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="관리번호, 학교명, 학생명, 제품명...">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">상태 선택</label>
                                    <select id="statusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">전체 상태</option>
                                        <option value="대여중">대여중</option>
                                        <option value="미대여중">미 대여중</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">차수 선택</label>
                                    <select id="phaseFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">전체 차수</option>
                                        <option value="1차">1차</option>
                                        <option value="2차">2차</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">모델 선택</label>
                                    <select id="modelFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">전체 모델</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">개인정보동의일자 시작</label>
                                    <input type="date" id="dateStart" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">개인정보동의일자 종료</label>
                                    <input type="date" id="dateEnd" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button onclick="applyFilters()" class="tg-button-primary">
                                    <i class="fas fa-search mr-2"></i>검색
                                </button>
                                <button onclick="resetFilters()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition">
                                    <i class="fas fa-undo mr-2"></i>초기화
                                </button>
                            </div>
                        </div>

                        <!-- 액션 버튼 -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            <button onclick="showAddRentalModal()" class="tg-button-primary">
                                <i class="fas fa-plus mr-2"></i>새 대여 추가
                            </button>
                            <button onclick="downloadRentalSample()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
                                <i class="fas fa-download mr-2"></i>Excel 샘플
                            </button>
                            <button onclick="uploadRentalExcel()" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition">
                                <i class="fas fa-upload mr-2"></i>Excel 업로드
                            </button>
                            <button onclick="deleteAllRentals()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">
                                <i class="fas fa-trash mr-2"></i>전체 삭제
                            </button>
                        </div>
                    </div>

                    <!-- 대여 목록 테이블 -->
                    <div class="tg-card p-4">
                        <div class="overflow-x-auto">
                            <table class="tg-table">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" id="selectAllRentals" onchange="toggleAllRentals()">
                                        </th>
                                        <th>순번</th>
                                        <th>관리번호</th>
                                        <th>제품시리얼</th>
                                        <th>학교명</th>
                                        <th>학교급</th>
                                        <th>학생명</th>
                                        <th>제품명</th>
                                        <th>상태</th>
                                        <th>메모1</th>
                                        <th>메모2</th>
                                        <th>기타</th>
                                    </tr>
                                </thead>
                                <tbody id="rentalTableBody">
                                    <!-- 동적으로 채워짐 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div class="flex justify-center items-center mt-4 space-x-2">
                            <button onclick="previousPage()" class="px-3 py-1 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span>페이지</span>
                            <input type="number" id="currentPageInput" value="1" min="1" class="w-16 px-2 py-1 text-center border border-gray-300 rounded" onchange="goToPage()">
                            <span>/</span>
                            <span id="totalPages">1</span>
                            <button onclick="nextPage()" class="px-3 py-1 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 제품 관리 페이지 -->
                <div id="productPage" class="page-content" style="display: none;">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">제품 관리</h2>
                        <p class="text-gray-600 mb-4">제품 데이터를 관리합니다.</p>
                        
                        <!-- 검색 -->
                        <div class="tg-card p-4 mb-4">
                            <div class="flex gap-4">
                                <input type="text" id="productSearch" class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="차수, 관리번호, 제품명, 시리얼 검색...">
                                <button onclick="searchProducts()" class="tg-button-primary">
                                    <i class="fas fa-search mr-2"></i>검색
                                </button>
                                <button onclick="resetProductSearch()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition">
                                    <i class="fas fa-undo mr-2"></i>초기화
                                </button>
                            </div>
                        </div>

                        <!-- 액션 버튼 -->
                        <div class="flex flex-wrap gap-2 mb-4">
                            <button onclick="showAddProductModal()" class="tg-button-primary">
                                <i class="fas fa-plus mr-2"></i>제품 추가
                            </button>
                            <button onclick="downloadProductSample()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
                                <i class="fas fa-download mr-2"></i>Excel 샘플
                            </button>
                            <button onclick="uploadProductExcel()" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition">
                                <i class="fas fa-upload mr-2"></i>Excel 업로드
                            </button>
                            <button onclick="deleteAllProducts()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">
                                <i class="fas fa-trash mr-2"></i>전체 삭제
                            </button>
                        </div>
                    </div>

                    <!-- 제품 목록 테이블 -->
                    <div class="tg-card p-4">
                        <div class="overflow-x-auto">
                            <table class="tg-table">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" id="selectAllProducts" onchange="toggleAllProducts()">
                                        </th>
                                        <th>차수</th>
                                        <th>관리번호</th>
                                        <th>제품명</th>
                                        <th>시리얼</th>
                                        <th>작업</th>
                                    </tr>
                                </thead>
                                <tbody id="productTableBody">
                                    <!-- 동적으로 채워짐 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div class="flex justify-center items-center mt-4 space-x-2">
                            <button onclick="previousProductPage()" class="px-3 py-1 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span>페이지</span>
                            <input type="number" id="currentProductPageInput" value="1" min="1" class="w-16 px-2 py-1 text-center border border-gray-300 rounded" onchange="goToProductPage()">
                            <span>/</span>
                            <span id="totalProductPages">1</span>
                            <button onclick="nextProductPage()" class="px-3 py-1 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 사용자 관리 페이지 -->
                <div id="usersPage" class="page-content" style="display: none;">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">사용자 관리</h2>
                        <p class="text-gray-600 mb-4">시스템 사용자를 관리합니다.</p>
                        
                        <div class="flex gap-2 mb-4">
                            <button onclick="showAddUserModal()" class="tg-button-primary">
                                <i class="fas fa-user-plus mr-2"></i>사용자 추가
                            </button>
                        </div>
                    </div>

                    <!-- 사용자 목록 -->
                    <div class="tg-card p-4">
                        <table class="tg-table">
                            <thead>
                                <tr>
                                    <th>사용자명</th>
                                    <th>권한</th>
                                    <th>생성일</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- 동적으로 채워짐 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 피드백 게시판 페이지 -->
                <div id="feedbackPage" class="page-content" style="display: none;">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">피드백 게시판</h2>
                        <p class="text-gray-600 mb-4">사용자 피드백을 관리합니다.</p>
                        
                        <div class="flex gap-2 mb-4">
                            <button onclick="showAddFeedbackModal()" class="tg-button-primary">
                                <i class="fas fa-plus mr-2"></i>새 글 작성
                            </button>
                        </div>
                    </div>

                    <!-- 게시글 목록 -->
                    <div class="tg-card p-4">
                        <table class="tg-table">
                            <thead>
                                <tr>
                                    <th>번호</th>
                                    <th>제목</th>
                                    <th>작성자</th>
                                    <th>작성일</th>
                                    <th>조회수</th>
                                </tr>
                            </thead>
                            <tbody id="feedbackTableBody">
                                <!-- 동적으로 채워짐 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 대여 추가/수정 모달 -->
    <div id="rentalModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="rentalModalTitle">대여 정보 수정</h3>
                <button onclick="closeModal('rentalModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="rentalForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">관리번호</label>
                    <input type="text" id="rentalManagementNumber" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">제품시리얼</label>
                    <input type="text" id="rentalProductSerial" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">학교명</label>
                    <input type="text" id="rentalSchoolName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">학교급</label>
                    <select id="rentalSchoolLevel" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="초등학교">초등학교</option>
                        <option value="중학교">중학교</option>
                        <option value="고등학교">고등학교</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">학생명</label>
                    <input type="text" id="rentalStudentName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">상태</label>
                    <select id="rentalStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="대여중">대여중</option>
                        <option value="미대여중">미 대여중</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">메모1</label>
                    <input type="text" id="rentalMemo1" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">메모2</label>
                    <input type="text" id="rentalMemo2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">학생생년월일</label>
                    <input type="date" id="rentalStudentBirthDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">학생연락처</label>
                    <input type="tel" id="rentalStudentPhone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">개인정보동의일자</label>
                    <input type="date" id="rentalPrivacyDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">보호자명</label>
                    <input type="text" id="rentalGuardianName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">관계</label>
                    <select id="rentalRelationship" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="부모">부모</option>
                        <option value="조부모">조부모</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">보호자연락처</label>
                    <input type="tel" id="rentalGuardianPhone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">기타사항</label>
                    <textarea id="rentalEtc" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>

                <!-- 악세사리 관리 -->
                <div class="md:col-span-2">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-tools mr-2"></i>악세사리 관리
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-plug mr-1"></i>충전기
                            </label>
                            <select id="rentalCharger" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-usb-cable mr-1"></i>충전케이블
                            </label>
                            <select id="rentalChargeCable" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ethernet mr-1"></i>USB 랜 젠더
                            </label>
                            <select id="rentalUsbLan" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-mouse mr-1"></i>마우스
                            </label>
                            <select id="rentalMouse" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-briefcase mr-1"></i>가방
                            </label>
                            <select id="rentalBag" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-mobile-alt mr-1"></i>케이스
                            </label>
                            <select id="rentalCase" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="md:col-span-2 flex justify-end space-x-2 mt-4">
                    <button type="button" onclick="closeModal('rentalModal')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition">
                        취소
                    </button>
                    <button type="submit" class="tg-button-primary">
                        저장
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 제품 추가/수정 모달 -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="productModalTitle">제품 추가</h3>
                <button onclick="closeModal('productModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="productForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">차수</label>
                    <select id="productPhase" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="1차">1차</option>
                        <option value="2차">2차</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">관리번호</label>
                    <input type="text" id="productManagementNumber" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">제품명</label>
                    <input type="text" id="productName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">시리얼</label>
                    <input type="text" id="productSerial" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="md:col-span-2 flex justify-end space-x-2 mt-4">
                    <button type="button" onclick="closeModal('productModal')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition">
                        취소
                    </button>
                    <button type="submit" class="tg-button-primary">
                        저장
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 사용자 추가/수정 모달 -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="userModalTitle">사용자 추가</h3>
                <button onclick="closeModal('userModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="userForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">사용자명</label>
                    <input type="text" id="userName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">비밀번호</label>
                    <input type="password" id="userPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">권한</label>
                    <select id="userRole" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="사용자">사용자</option>
                        <option value="관리자">관리자</option>
                        <option value="최고관리자">최고관리자</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeModal('userModal')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition">
                        취소
                    </button>
                    <button type="submit" class="tg-button-primary">
                        저장
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 피드백 추가 모달 -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">새 글 작성</h3>
                <button onclick="closeModal('feedbackModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="feedbackForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">제목</label>
                    <input type="text" id="feedbackTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">내용</label>
                    <textarea id="feedbackContent" rows="6" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeModal('feedbackModal')" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition">
                        취소
                    </button>
                    <button type="submit" class="tg-button-primary">
                        작성
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyBQW8SvnYg4R-1IssLlAZ5fJ4382nNztKA",
            authDomain: "jeju-education-system.firebaseapp.com",
            databaseURL: "https://jeju-education-system-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "jeju-education-system",
            storageBucket: "jeju-education-system.firebasestorage.app",
            messagingSenderId: "462514623607",
            appId: "1:462514623607:web:afa068226e4f115a4a2272",
            measurementId: "G-YJ3MLN4XH1"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 전역 변수
        let currentUser = null;
        let currentPage = 1;
        let currentProductPage = 1;
        let itemsPerPage = 20;
        let allRentals = [];
        let allProducts = [];
        let filteredRentals = [];
        let filteredProducts = [];
        let editingRentalId = null;
        let editingProductId = null;

        // 로그인 시스템
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // 간단한 로그인 검증
            const users = {
                'admin': { password: 'admin123', role: '최고관리자' },
                'manager': { password: 'manager123', role: '관리자' },
                'user': { password: 'user123', role: '사용자' }
            };

            if (users[username] && users[username].password === password) {
                currentUser = { username, role: users[username].role };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showMainSystem();
            } else {
                alert('잘못된 사용자명 또는 비밀번호입니다.');
            }
        }

        function showMainSystem() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainSystem').style.display = 'block';
            
            if (currentUser) {
                document.getElementById('currentUserDisplay').textContent = 
                    `${currentUser.role} (${currentUser.username})님 환영합니다!`;
            }
            
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // 기본 페이지 표시
            showPage('rental');
            
            // 데이터 로드
            loadAllData();
        }

        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('mainSystem').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentDateTime').textContent = dateTimeString;
        }

        // 페이지 전환
        function showPage(pageName) {
            // 모든 페이지 숨기기
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.style.display = 'none');
            
            // 선택된 페이지 보이기
            document.getElementById(pageName + 'Page').style.display = 'block';
            
            // 데이터 로드
            if (pageName === 'rental') {
                loadRentals();
            } else if (pageName === 'product') {
                loadProducts();
            } else if (pageName === 'users') {
                loadUsers();
            } else if (pageName === 'feedback') {
                loadFeedback();
            }
        }

        // Firebase 데이터 로드
        function loadAllData() {
            loadRentals();
            loadProducts();
            loadUsers();
            loadFeedback();
        }

        function loadRentals() {
            database.ref('rentals').on('value', (snapshot) => {
                allRentals = [];
                const data = snapshot.val();
                if (data) {
                    Object.keys(data).forEach(key => {
                        allRentals.push({ id: key, ...data[key] });
                    });
                }
                applyFilters();
                updateStats();
            });
        }

        function loadProducts() {
            database.ref('products').on('value', (snapshot) => {
                allProducts = [];
                const data = snapshot.val();
                if (data) {
                    Object.keys(data).forEach(key => {
                        allProducts.push({ id: key, ...data[key] });
                    });
                }
                searchProducts();
                updateModelFilter();
            });
        }

        function loadUsers() {
            // 기본 사용자 표시
            const users = [
                { username: 'admin', role: '최고관리자', createdAt: '2024-01-01' },
                { username: 'manager', role: '관리자', createdAt: '2024-01-02' },
                { username: 'user', role: '사용자', createdAt: '2024-01-03' }
            ];
            
            displayUsers(users);
        }

        function loadFeedback() {
            database.ref('feedback').on('value', (snapshot) => {
                const feedback = [];
                const data = snapshot.val();
                if (data) {
                    Object.keys(data).forEach(key => {
                        feedback.push({ id: key, ...data[key] });
                    });
                }
                displayFeedback(feedback);
            });
        }

        // 통계 업데이트
        function updateStats() {
            const stats1st = allRentals.filter(r => r.phase === '1차').length;
            const stats2nd = allRentals.filter(r => r.phase === '2차').length;
            const statsRented = allRentals.filter(r => r.status === '대여중').length;
            const statsAvailable = allRentals.filter(r => r.status === '미대여중').length;

            document.getElementById('stats1st').textContent = stats1st;
            document.getElementById('stats2nd').textContent = stats2nd;
            document.getElementById('statsRented').textContent = statsRented;
            document.getElementById('statsAvailable').textContent = statsAvailable;
        }

        // 모델 필터 업데이트
        function updateModelFilter() {
            const modelFilter = document.getElementById('modelFilter');
            const models = [...new Set(allProducts.map(p => p.productName))];
            
            modelFilter.innerHTML = '<option value="">전체 모델</option>';
            models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelFilter.appendChild(option);
            });
        }

        // 필터 적용
        function applyFilters() {
            const search = document.getElementById('rentalSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const phaseFilter = document.getElementById('phaseFilter').value;
            const modelFilter = document.getElementById('modelFilter').value;
            const dateStart = document.getElementById('dateStart').value;
            const dateEnd = document.getElementById('dateEnd').value;

            filteredRentals = allRentals.filter(rental => {
                const matchesSearch = !search || 
                    Object.values(rental).some(value => 
                        value && value.toString().toLowerCase().includes(search)
                    );
                
                const matchesStatus = !statusFilter || rental.status === statusFilter;
                const matchesPhase = !phaseFilter || rental.phase === phaseFilter;
                const matchesModel = !modelFilter || rental.productName === modelFilter;
                
                let matchesDate = true;
                if (dateStart && rental.privacyDate) {
                    matchesDate = matchesDate && rental.privacyDate >= dateStart;
                }
                if (dateEnd && rental.privacyDate) {
                    matchesDate = matchesDate && rental.privacyDate <= dateEnd;
                }

                return matchesSearch && matchesStatus && matchesPhase && matchesModel && matchesDate;
            });

            currentPage = 1;
            displayRentals();
        }

        function resetFilters() {
            document.getElementById('rentalSearch').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('phaseFilter').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('dateStart').value = '';
            document.getElementById('dateEnd').value = '';
            applyFilters();
        }

        // 대여 목록 표시
        function displayRentals() {
            const tbody = document.getElementById('rentalTableBody');
            tbody.innerHTML = '';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageRentals = filteredRentals.slice(startIndex, endIndex);

            pageRentals.forEach((rental, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="rental-checkbox" value="${rental.id}"></td>
                    <td>${startIndex + index + 1}</td>
                    <td><a href="#" onclick="editRental('${rental.id}')" class="text-blue-600 hover:text-blue-800">${rental.managementNumber || ''}</a></td>
                    <td>${rental.productSerial || ''}</td>
                    <td>${rental.schoolName || ''}</td>
                    <td>${rental.schoolLevel || ''}</td>
                    <td>${rental.studentName || ''}</td>
                    <td>${rental.productName || ''}</td>
                    <td>
                        <select onchange="updateRentalStatus('${rental.id}', this.value)" class="px-2 py-1 border rounded ${rental.status === '대여중' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                            <option value="대여중" ${rental.status === '대여중' ? 'selected' : ''}>대여중</option>
                            <option value="미대여중" ${rental.status === '미대여중' ? 'selected' : ''}>미대여중</option>
                        </select>
                    </td>
                    <td>${rental.memo1 || ''}</td>
                    <td>${rental.memo2 || ''}</td>
                    <td>${rental.etc || ''}</td>
                `;
                tbody.appendChild(row);
            });

            updatePagination();
        }

        // 제품 목록 표시
        function displayProducts() {
            const tbody = document.getElementById('productTableBody');
            tbody.innerHTML = '';

            const startIndex = (currentProductPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageProducts = filteredProducts.slice(startIndex, endIndex);

            pageProducts.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="product-checkbox" value="${product.id}"></td>
                    <td>${product.phase || ''}</td>
                    <td>${product.managementNumber || ''}</td>
                    <td>${product.productName || ''}</td>
                    <td>${product.serial || ''}</td>
                    <td>
                        <button onclick="editProduct('${product.id}')" class="px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 mr-1">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct('${product.id}')" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateProductPagination();
        }

        // 사용자 목록 표시
        function displayUsers(users) {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>
                        <span class="px-2 py-1 rounded text-sm ${
                            user.role === '최고관리자' ? 'bg-red-100 text-red-800' :
                            user.role === '관리자' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-green-100 text-green-800'
                        }">${user.role}</span>
                    </td>
                    <td>${user.createdAt}</td>
                    <td>
                        <button onclick="editUser('${user.username}')" class="px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 mr-1">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${user.username !== 'admin' ? `
                        <button onclick="deleteUser('${user.username}')" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 피드백 목록 표시
        function displayFeedback(feedback) {
            const tbody = document.getElementById('feedbackTableBody');
            tbody.innerHTML = '';

            feedback.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.title || ''}</td>
                    <td>${item.author || ''}</td>
                    <td>${item.createdAt || ''}</td>
                    <td>${item.views || 0}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // 페이지네이션
        function updatePagination() {
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            document.getElementById('totalPages').textContent = totalPages;
            document.getElementById('currentPageInput').value = currentPage;
        }

        function updateProductPagination() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            document.getElementById('totalProductPages').textContent = totalPages;
            document.getElementById('currentProductPageInput').value = currentProductPage;
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                displayRentals();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayRentals();
            }
        }

        function goToPage() {
            const page = parseInt(document.getElementById('currentPageInput').value);
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayRentals();
            }
        }

        function previousProductPage() {
            if (currentProductPage > 1) {
                currentProductPage--;
                displayProducts();
            }
        }

        function nextProductPage() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            if (currentProductPage < totalPages) {
                currentProductPage++;
                displayProducts();
            }
        }

        function goToProductPage() {
            const page = parseInt(document.getElementById('currentProductPageInput').value);
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentProductPage = page;
                displayProducts();
            }
        }

        // 모달 관리
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'rentalModal') {
                document.getElementById('rentalForm').reset();
                editingRentalId = null;
            } else if (modalId === 'productModal') {
                document.getElementById('productForm').reset();
                editingProductId = null;
            }
        }

        // 대여 관련 함수
        function showAddRentalModal() {
            editingRentalId = null;
            document.getElementById('rentalModalTitle').textContent = '새 대여 추가';
            document.getElementById('rentalForm').reset();
            showModal('rentalModal');
        }

        function editRental(id) {
            const rental = allRentals.find(r => r.id === id);
            if (rental) {
                editingRentalId = id;
                document.getElementById('rentalModalTitle').textContent = '대여 정보 수정';
                
                // 폼에 데이터 입력
                document.getElementById('rentalManagementNumber').value = rental.managementNumber || '';
                document.getElementById('rentalProductSerial').value = rental.productSerial || '';
                document.getElementById('rentalSchoolName').value = rental.schoolName || '';
                document.getElementById('rentalSchoolLevel').value = rental.schoolLevel || '';
                document.getElementById('rentalStudentName').value = rental.studentName || '';
                document.getElementById('rentalStatus').value = rental.status || '';
                document.getElementById('rentalMemo1').value = rental.memo1 || '';
                document.getElementById('rentalMemo2').value = rental.memo2 || '';
                document.getElementById('rentalStudentBirthDate').value = rental.studentBirthDate || '';
                document.getElementById('rentalStudentPhone').value = rental.studentPhone || '';
                document.getElementById('rentalPrivacyDate').value = rental.privacyDate || '';
                document.getElementById('rentalGuardianName').value = rental.guardianName || '';
                document.getElementById('rentalRelationship').value = rental.relationship || '';
                document.getElementById('rentalGuardianPhone').value = rental.guardianPhone || '';
                document.getElementById('rentalEtc').value = rental.etc || '';
                
                // 악세사리 정보
                document.getElementById('rentalCharger').value = rental.charger || '양호';
                document.getElementById('rentalChargeCable').value = rental.chargeCable || '양호';
                document.getElementById('rentalUsbLan').value = rental.usbLan || '양호';
                document.getElementById('rentalMouse').value = rental.mouse || '양호';
                document.getElementById('rentalBag').value = rental.bag || '양호';
                document.getElementById('rentalCase').value = rental.case || '양호';
                
                showModal('rentalModal');
            }
        }

        function updateRentalStatus(id, status) {
            database.ref(`rentals/${id}`).update({ status: status })
                .then(() => {
                    console.log('상태가 업데이트되었습니다.');
                })
                .catch((error) => {
                    console.error('상태 업데이트 실패:', error);
                    alert('상태 업데이트에 실패했습니다.');
                });
        }

        // 제품 관련 함수
        function showAddProductModal() {
            editingProductId = null;
            document.getElementById('productModalTitle').textContent = '제품 추가';
            document.getElementById('productForm').reset();
            showModal('productModal');
        }

        function editProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (product) {
                editingProductId = id;
                document.getElementById('productModalTitle').textContent = '제품 수정';
                
                document.getElementById('productPhase').value = product.phase || '';
                document.getElementById('productManagementNumber').value = product.managementNumber || '';
                document.getElementById('productName').value = product.productName || '';
                document.getElementById('productSerial').value = product.serial || '';
                
                showModal('productModal');
            }
        }

        function deleteProduct(id) {
            if (confirm('이 제품을 삭제하시겠습니까?')) {
                database.ref(`products/${id}`).remove()
                    .then(() => {
                        alert('제품이 삭제되었습니다.');
                    })
                    .catch((error) => {
                        console.error('삭제 실패:', error);
                        alert('삭제에 실패했습니다.');
                    });
            }
        }

        // 사용자 관련 함수
        function showAddUserModal() {
            document.getElementById('userModalTitle').textContent = '사용자 추가';
            document.getElementById('userForm').reset();
            showModal('userModal');
        }

        function editUser(username) {
            // 실제 구현에서는 사용자 데이터를 가져와서 폼에 채움
            alert('사용자 수정 기능은 데모에서는 제한됩니다.');
        }

        function deleteUser(username) {
            if (confirm(`사용자 '${username}'을 삭제하시겠습니까?`)) {
                alert('사용자 삭제 기능은 데모에서는 제한됩니다.');
            }
        }

        // 피드백 관련 함수
        function showAddFeedbackModal() {
            document.getElementById('feedbackForm').reset();
            showModal('feedbackModal');
        }

        // 검색 함수
        function searchProducts() {
            const search = document.getElementById('productSearch').value.toLowerCase();
            
            filteredProducts = allProducts.filter(product => {
                return !search || Object.values(product).some(value => 
                    value && value.toString().toLowerCase().includes(search)
                );
            });

            currentProductPage = 1;
            displayProducts();
        }

        function resetProductSearch() {
            document.getElementById('productSearch').value = '';
            searchProducts();
        }

        // 체크박스 관리
        function toggleAllRentals() {
            const checkboxes = document.querySelectorAll('.rental-checkbox');
            const selectAll = document.getElementById('selectAllRentals').checked;
            checkboxes.forEach(checkbox => checkbox.checked = selectAll);
        }

        function toggleAllProducts() {
            const checkboxes = document.querySelectorAll('.product-checkbox');
            const selectAll = document.getElementById('selectAllProducts').checked;
            checkboxes.forEach(checkbox => checkbox.checked = selectAll);
        }

        // 삭제 함수
        function deleteAllRentals() {
            if (confirm('모든 대여 데이터를 삭제하시겠습니까?')) {
                database.ref('rentals').remove()
                    .then(() => {
                        alert('모든 대여 데이터가 삭제되었습니다.');
                    })
                    .catch((error) => {
                        console.error('삭제 실패:', error);
                        alert('삭제에 실패했습니다.');
                    });
            }
        }

        function deleteAllProducts() {
            if (confirm('모든 제품 데이터를 삭제하시겠습니까?')) {
                database.ref('products').remove()
                    .then(() => {
                        alert('모든 제품 데이터가 삭제되었습니다.');
                    })
                    .catch((error) => {
                        console.error('삭제 실패:', error);
                        alert('삭제에 실패했습니다.');
                    });
            }
        }

        // 샘플 다운로드 함수
        function downloadRentalSample() {
            const headers = [
                '순번', '관리번호', '제품시리얼', '학교명', '학교급', '학생명', '상태', 
                '메모1', '메모2', '학생생년월일', '학생연락처', '개인정보동의일자', 
                '보호자명', '관계', '보호자연락처', '기타사항', '충전기상태', 
                '충전케이블상태', 'USB랜젠더상태', '마우스상태', '가방상태', '케이스상태'
            ];
            
            const sampleData = [
                ['1', '2025-0001', 'SAMPLE001', '제주중학교', '중학교', '홍길동', '대여중', '정상', '', '20100101', '010-1234-5678', '20240101', '홍부모', '부모', '010-9876-5432', '특이사항 없음', '양호', '양호', '양호', '양호', '양호', '양호']
            ];
            
            downloadExcel(headers, sampleData, '대여관리_샘플.xlsx');
        }

        function downloadProductSample() {
            const headers = ['차수', '관리번호', '제품명', '시리얼'];
            const sampleData = [
                ['1차', '2025-0001', '삼성노트북A', 'SAMPLE001'],
                ['2차', '2025-0002', 'LG태블릿B', 'SAMPLE002']
            ];
            
            downloadExcel(headers, sampleData, '제품관리_샘플.xlsx');
        }

        function downloadExcel(headers, data, filename) {
            // 간단한 CSV 다운로드 (실제로는 Excel 라이브러리 사용 권장)
            let csvContent = headers.join(',') + '\n';
            data.forEach(row => {
                csvContent += row.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 업로드 함수
        function uploadRentalExcel() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.xls,.csv';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // 파일 처리 로직 (실제로는 Excel 파싱 라이브러리 사용)
                    alert('Excel 업로드 기능은 실제 환경에서 구현됩니다.');
                }
            };
            input.click();
        }

        function uploadProductExcel() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.xls,.csv';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    alert('Excel 업로드 기능은 실제 환경에서 구현됩니다.');
                }
            };
            input.click();
        }

        // 폼 제출 처리
        document.getElementById('loginForm').addEventListener('submit', handleLogin);

        document.getElementById('rentalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                managementNumber: document.getElementById('rentalManagementNumber').value,
                productSerial: document.getElementById('rentalProductSerial').value,
                schoolName: document.getElementById('rentalSchoolName').value,
                schoolLevel: document.getElementById('rentalSchoolLevel').value,
                studentName: document.getElementById('rentalStudentName').value,
                status: document.getElementById('rentalStatus').value,
                memo1: document.getElementById('rentalMemo1').value,
                memo2: document.getElementById('rentalMemo2').value,
                studentBirthDate: document.getElementById('rentalStudentBirthDate').value,
                studentPhone: document.getElementById('rentalStudentPhone').value,
                privacyDate: document.getElementById('rentalPrivacyDate').value,
                guardianName: document.getElementById('rentalGuardianName').value,
                relationship: document.getElementById('rentalRelationship').value,
                guardianPhone: document.getElementById('rentalGuardianPhone').value,
                etc: document.getElementById('rentalEtc').value,
                charger: document.getElementById('rentalCharger').value,
                chargeCable: document.getElementById('rentalChargeCable').value,
                usbLan: document.getElementById('rentalUsbLan').value,
                mouse: document.getElementById('rentalMouse').value,
                bag: document.getElementById('rentalBag').value,
                case: document.getElementById('rentalCase').value,
                createdAt: new Date().toISOString()
            };

            // 제품명 자동 설정 (제품시리얼 기반)
            const product = allProducts.find(p => p.serial === formData.productSerial);
            if (product) {
                formData.productName = product.productName;
                formData.phase = product.phase;
            }

            if (editingRentalId) {
                database.ref(`rentals/${editingRentalId}`).update(formData)
                    .then(() => {
                        alert('대여 정보가 수정되었습니다.');
                        closeModal('rentalModal');
                    })
                    .catch((error) => {
                        console.error('수정 실패:', error);
                        alert('수정에 실패했습니다.');
                    });
            } else {
                database.ref('rentals').push(formData)
                    .then(() => {
                        alert('새 대여가 추가되었습니다.');
                        closeModal('rentalModal');
                    })
                    .catch((error) => {
                        console.error('저장 실패:', error);
                        alert('저장에 실패했습니다.');
                    });
            }
        });

        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                phase: document.getElementById('productPhase').value,
                managementNumber: document.getElementById('productManagementNumber').value,
                productName: document.getElementById('productName').value,
                serial: document.getElementById('productSerial').value,
                createdAt: new Date().toISOString()
            };

            if (editingProductId) {
                database.ref(`products/${editingProductId}`).update(formData)
                    .then(() => {
                        alert('제품 정보가 수정되었습니다.');
                        closeModal('productModal');
                    })
                    .catch((error) => {
                        console.error('수정 실패:', error);
                        alert('수정에 실패했습니다.');
                    });
            } else {
                database.ref('products').push(formData)
                    .then(() => {
                        alert('새 제품이 추가되었습니다.');
                        closeModal('productModal');
                    })
                    .catch((error) => {
                        console.error('저장 실패:', error);
                        alert('저장에 실패했습니다.');
                    });
            }
        });

        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('사용자 관리 기능은 데모에서는 제한됩니다.');
            closeModal('userModal');
        });

        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('feedbackTitle').value,
                content: document.getElementById('feedbackContent').value,
                author: currentUser ? currentUser.username : 'Anonymous',
                createdAt: new Date().toISOString(),
                views: 0
            };

            database.ref('feedback').push(formData)
                .then(() => {
                    alert('피드백이 작성되었습니다.');
                    closeModal('feedbackModal');
                })
                .catch((error) => {
                    console.error('작성 실패:', error);
                    alert('작성에 실패했습니다.');
                });
        });

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // 자동 로그인 확인
        document.addEventListener('DOMContentLoaded', function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainSystem();
            }
        });

        // 검색 이벤트 리스너
        document.getElementById('rentalSearch').addEventListener('input', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('phaseFilter').addEventListener('change', applyFilters);
        document.getElementById('modelFilter').addEventListener('change', applyFilters);
        document.getElementById('dateStart').addEventListener('change', applyFilters);
        document.getElementById('dateEnd').addEventListener('change', applyFilters);
        document.getElementById('productSearch').addEventListener('input', searchProducts);
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"954a2b437ce1d771","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDm5f%2BApHwExHaRaEKUseOzslj5ROdcXnBOUOW03EzO3l35H5XEiqKUqC5vsWiZjFAb%2F2GSy2NUeCRrLxghRiiA43Xg1vXSuhtKGTzCs5F3JXdGIMO8wuilO9E1g27kJXNI0zAo12d2wS2u4gV9AJPH%2FwwWQteY%2B2KGAVfol2zXqmDqkQXIka0trW5Nd93JnxKYsSu5%2B9eiPcqhIkrtG1biX4PQQ3kL%2B%2FvQo41x4k7HyzGjzY8Qe4ybN3CPMkupVRm2bcFM4F6PxxbJyw%2Fz4WA3nZuutuG%2BDe1liSjSJAVcjDB7WHdDd2sEFdvmp7yKhy9NSCCD1ZB%2BKo6Msu9Wu0FZSsW8O9Ad%2BjjpSVYDADk2XnyuKLeMr3JXzrGOHPdLna%2Flby2CwIiRAKv4uzlybFa0al559vyj2mgGxhq2PgxKCSvnGP1eNBFDuPonGJ5tiocZ3WP4mDzxetV1Dc7vkfkzYZNsw32OmqWRtWmLrwioKX0rRG7qTCZybhWir4nOV5tgCdULD5gsoWyT5tMeITjL0%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDm5f+ApHwExHaRaEKUseOzslj5ROdcXnBOUOW03EzO3l35H5XEiqKUqC5vsWiZjFAb/2GSy2NUeCRrLxghRiiA43Xg1vXSuhtKGTzCs5F3JXdGIMO8wuilO9E1g27kJXNI0zAo12d2wS2u4gV9AJPH/wwWQteY+2KGAVfol2zXqmDqkQXIka0trW5Nd93JnxKYsSu5+9eiPcqhIkrtG1biX4PQQ3kL+/vQo41x4k7HyzGjzY8Qe4ybN3CPMkupVRm2bcFM4F6PxxbJyw/z4WA3nZuutuG+De1liSjSJAVcjDB7WHdDd2sEFdvmp7yKhy9NSCCD1ZB+Ko6Msu9Wu0FZSsW8O9Ad+jjpSVYDADk2XnyuKLeMr3JXzrGOHPdLna/lby2CwIiRAKv4uzlybFa0al559vyj2mgGxhq2PgxKCSvnGP1eNBFDuPonGJ5tiocZ3WP4mDzxetV1Dc7vkfkzYZNsw32OmqWRtWmLrwioKX0rRG7qTCZybhWir4nOV5tgCdULD5gsoWyT5tMeITjL0=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
