<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제주교육청 스마트단말 관리 시스템</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        /* TGService Style Header */
        .header {
            background: linear-gradient(135deg, #5a5a5a 0%, #404040 100%);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header .logo {
            display: flex;
            align-items: center;
            font-size: 18px;
            font-weight: 600;
        }

        .header .logo i {
            margin-right: 8px;
            color: #4a90e2;
        }

        .header .user-info {
            font-size: 14px;
            color: #e0e0e0;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 60px;
            width: 250px;
            height: calc(100vh - 60px);
            background: linear-gradient(180deg, #e8e8e8 0%, #d0d0d0 100%);
            border-right: 1px solid #ccc;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
        }

        .sidebar-menu li {
            border-bottom: 1px solid #bbb;
        }

        .sidebar-menu a {
            display: block;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
        }

        .sidebar-menu i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .logout-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 20px;
            min-height: calc(100vh - 60px);
        }

        /* Login Page */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            width: 400px;
            text-align: center;
        }

        .login-box img {
            width: 120px;
            margin-bottom: 20px;
        }

        .login-box h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }

        .contact-info {
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #4a90e2;
        }

        .card.blue { border-left-color: #4a90e2; }
        .card.green { border-left-color: #28a745; }
        .card.orange { border-left-color: #fd7e14; }
        .card.red { border-left-color: #dc3545; }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: #333;
        }

        .card-icon {
            font-size: 24px;
            color: #4a90e2;
        }

        /* Filters and Controls */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .controls-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .control-group input, .control-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #fd7e14 0%, #ffc107 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        .table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        .table tr:nth-child(even) {
            background-color: #fafafa;
        }

        .status-select {
            border: none;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-대여중 {
            background: #ffebee;
            color: #c62828;
        }

        .status-미대여중 {
            background: #e8f5e8;
            color: #2e7d32;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: white;
            margin-top: 10px;
            border-radius: 0 0 10px 10px;
        }

        .pagination button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .pagination button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .pagination input {
            width: 60px;
            text-align: center;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .pagination-info {
            font-size: 14px;
            color: #666;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 3000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: linear-gradient(135deg, #5a5a5a 0%, #404040 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            cursor: move;
            user-select: none;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #4a90e2;
        }

        .form-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .accessories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .accessory-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .accessory-item label {
            font-size: 14px;
            font-weight: 500;
            color: #555;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .controls-row {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top-color: #4a90e2;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div style="width: 120px; height: 120px; margin: 0 auto 20px; background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjYwIiBjeT0iNjAiIHI9IjU4IiBmaWxsPSIjNEE5MEUyIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iNCIvPgo8dGV4dCB4PSI2MCIgeT0iNzAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzMCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7soJU8L3RleHQ+Cjwvc3ZnPgo=') center/contain no-repeat;"></div>
            <h2>제주교육청 스마트단말 관리 시스템</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">사용자명</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn">로그인</button>
            </form>
            <div class="contact-info">
                <p>콜센터 번호: 1811-8290</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-tablet-alt"></i>
                제주교육청 스마트단말 관리 시스템
            </div>
            <div class="user-info">
                <span id="currentUser">관리자</span>님 환영합니다!
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li><a href="#" onclick="showPage('rental')" class="active"><i class="fas fa-clipboard-list"></i>대여 관리</a></li>
                <li><a href="#" onclick="showPage('products')"><i class="fas fa-box"></i>제품 관리</a></li>
                <li><a href="#" onclick="showPage('users')" id="userManagementMenu"><i class="fas fa-users"></i>사용자 관리</a></li>
                <li><a href="#" onclick="showPage('feedback')"><i class="fas fa-comments"></i>피드백 게시판</a></li>
            </ul>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> 로그아웃
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Rental Management Page -->
            <div id="rentalPage" class="page">
                <h1>대여 관리</h1>
                <p>스마트단말 대여 현황을 관리합니다.</p>

                <!-- Dashboard Cards -->
                <div class="dashboard-cards">
                    <div class="card blue">
                        <div class="card-header">
                            <span class="card-title">1차 장비 수</span>
                            <i class="fas fa-laptop card-icon"></i>
                        </div>
                        <div class="card-value" id="firstPhaseCount">0</div>
                    </div>
                    <div class="card green">
                        <div class="card-header">
                            <span class="card-title">2차 장비 수</span>
                            <i class="fas fa-tablet card-icon"></i>
                        </div>
                        <div class="card-value" id="secondPhaseCount">0</div>
                    </div>
                    <div class="card orange">
                        <div class="card-header">
                            <span class="card-title">대여중</span>
                            <i class="fas fa-user-clock card-icon"></i>
                        </div>
                        <div class="card-value" id="rentedCount">0</div>
                    </div>
                    <div class="card red">
                        <div class="card-header">
                            <span class="card-title">미 대여중</span>
                            <i class="fas fa-exclamation-triangle card-icon"></i>
                        </div>
                        <div class="card-value" id="availableCount">0</div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <div class="controls-row">
                        <div class="control-group">
                            <label>통합 검색</label>
                            <input type="text" id="rentalSearch" placeholder="관리번호, 학교명, 학생명, 제품명..." />
                        </div>
                        <div class="control-group">
                            <label>상태 선택</label>
                            <select id="statusFilter">
                                <option value="">전체 상태</option>
                                <option value="대여중">대여중</option>
                                <option value="미대여중">미대여중</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>차수 선택</label>
                            <select id="phaseFilter">
                                <option value="">전체 차수</option>
                                <option value="1차">1차</option>
                                <option value="2차">2차</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>모델 선택</label>
                            <select id="modelFilter">
                                <option value="">전체 모델</option>
                            </select>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <label>개인정보동의일자 시작</label>
                            <input type="date" id="dateStart" />
                        </div>
                        <div class="control-group">
                            <label>개인정보동의일자 종료</label>
                            <input type="date" id="dateEnd" />
                        </div>
                        <div class="control-group">
                            <button class="btn btn-primary" onclick="searchRentals()">
                                <i class="fas fa-search"></i> 검색
                            </button>
                            <button class="btn btn-warning" onclick="resetFilters()">
                                <i class="fas fa-undo"></i> 초기화
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button class="btn btn-success" onclick="showAddRentalModal()">
                        <i class="fas fa-plus"></i> 새 대여 추가
                    </button>
                    <button class="btn btn-primary" onclick="downloadRentalSample()">
                        <i class="fas fa-download"></i> Excel 샘플
                    </button>
                    <button class="btn btn-warning" onclick="document.getElementById('rentalFileInput').click()">
                        <i class="fas fa-upload"></i> Excel 업로드
                    </button>
                    <button class="btn btn-danger" onclick="deleteAllRentals()" id="deleteAllRentalsBtn">
                        <i class="fas fa-trash"></i> 전체 삭제
                    </button>
                </div>
                <input type="file" id="rentalFileInput" accept=".xlsx,.xls" style="display: none;" onchange="uploadRentalFile(this)" />

                <!-- Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllRentals" onchange="toggleSelectAllRentals()"></th>
                                <th>순번</th>
                                <th>관리번호</th>
                                <th>제품시리얼</th>
                                <th>학교명</th>
                                <th>학교급</th>
                                <th>학생명</th>
                                <th>제품명</th>
                                <th>상태</th>
                                <th>메모1</th>
                                <th>메모2</th>
                                <th>기타</th>
                            </tr>
                        </thead>
                        <tbody id="rentalTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button id="prevPageRental" onclick="changeRentalPage(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <input type="number" id="currentPageRental" value="1" min="1" onchange="goToRentalPage()" />
                    <span class="pagination-info">/ <span id="totalPagesRental">1</span></span>
                    <button id="nextPageRental" onclick="changeRentalPage(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Products Management Page -->
            <div id="productsPage" class="page hidden">
                <h1>제품 관리</h1>
                <p>제품 데이터를 관리합니다.</p>

                <!-- Search -->
                <div class="controls">
                    <div class="controls-row">
                        <div class="control-group">
                            <label>검색</label>
                            <input type="text" id="productSearch" placeholder="차수, 관리번호, 제품명, 시리얼 검색..." />
                        </div>
                        <div class="control-group">
                            <button class="btn btn-primary" onclick="searchProducts()">
                                <i class="fas fa-search"></i> 검색
                            </button>
                            <button class="btn btn-warning" onclick="resetProductFilters()">
                                <i class="fas fa-undo"></i> 초기화
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button class="btn btn-success" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i> 제품 추가
                    </button>
                    <button class="btn btn-primary" onclick="downloadProductSample()">
                        <i class="fas fa-download"></i> Excel 샘플
                    </button>
                    <button class="btn btn-warning" onclick="document.getElementById('productFileInput').click()">
                        <i class="fas fa-upload"></i> Excel 업로드
                    </button>
                    <button class="btn btn-danger" onclick="deleteAllProducts()" id="deleteAllProductsBtn">
                        <i class="fas fa-trash"></i> 전체 삭제
                    </button>
                </div>
                <input type="file" id="productFileInput" accept=".xlsx,.xls" style="display: none;" onchange="uploadProductFile(this)" />

                <!-- Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllProducts" onchange="toggleSelectAllProducts()"></th>
                                <th>차수</th>
                                <th>관리번호</th>
                                <th>제품명</th>
                                <th>시리얼</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button id="prevPageProduct" onclick="changeProductPage(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <input type="number" id="currentPageProduct" value="1" min="1" onchange="goToProductPage()" />
                    <span class="pagination-info">/ <span id="totalPagesProduct">1</span></span>
                    <button id="nextPageProduct" onclick="changeProductPage(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- User Management Page -->
            <div id="usersPage" class="page hidden">
                <h1>사용자 관리</h1>
                <p>시스템 사용자를 관리합니다.</p>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button class="btn btn-success" onclick="showAddUserModal()">
                        <i class="fas fa-user-plus"></i> 사용자 추가
                    </button>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>사용자명</th>
                                <th>권한</th>
                                <th>생성일</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Feedback Board Page -->
            <div id="feedbackPage" class="page hidden">
                <h1>피드백 게시판</h1>
                <p>의견과 피드백을 공유합니다.</p>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button class="btn btn-success" onclick="showAddPostModal()">
                        <i class="fas fa-edit"></i> 새 글 작성
                    </button>
                </div>

                <!-- Search -->
                <div class="controls">
                    <div class="controls-row">
                        <div class="control-group">
                            <label>검색</label>
                            <input type="text" id="feedbackSearch" placeholder="제목 또는 내용 검색..." />
                        </div>
                        <div class="control-group">
                            <button class="btn btn-primary" onclick="searchFeedback()">
                                <i class="fas fa-search"></i> 검색
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>제목</th>
                                <th>작성자</th>
                                <th>작성일</th>
                                <th>조회수</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="feedbackTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button id="prevPageFeedback" onclick="changeFeedbackPage(-1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <input type="number" id="currentPageFeedback" value="1" min="1" onchange="goToFeedbackPage()" />
                    <span class="pagination-info">/ <span id="totalPagesFeedback">1</span></span>
                    <button id="nextPageFeedback" onclick="changeFeedbackPage(1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Rental Detail Modal -->
    <div id="rentalDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" onmousedown="startDrag(event)">
                <div class="modal-title">대여 정보 수정</div>
                <button class="modal-close" onclick="closeModal('rentalDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-section">
                        <h3><i class="fas fa-info-circle"></i> 기본 정보</h3>
                        <div class="form-group">
                            <label>관리번호</label>
                            <input type="text" id="editManagementNumber" />
                        </div>
                        <div class="form-group">
                            <label>제품시리얼</label>
                            <input type="text" id="editProductSerial" />
                        </div>
                        <div class="form-group">
                            <label>학교명</label>
                            <input type="text" id="editSchoolName" />
                        </div>
                        <div class="form-group">
                            <label>학교급</label>
                            <select id="editSchoolLevel">
                                <option value="초등학교">초등학교</option>
                                <option value="중학교">중학교</option>
                                <option value="고등학교">고등학교</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>학생명</label>
                            <input type="text" id="editStudentName" />
                        </div>
                        <div class="form-group">
                            <label>제품명</label>
                            <input type="text" id="editProductName" />
                        </div>
                        <div class="form-group">
                            <label>상태</label>
                            <select id="editStatus">
                                <option value="대여중">대여중</option>
                                <option value="미대여중">미대여중</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>메모1</label>
                            <input type="text" id="editMemo1" />
                        </div>
                        <div class="form-group">
                            <label>메모2</label>
                            <input type="text" id="editMemo2" />
                        </div>
                    </div>

                    <div class="form-section">
                        <h3><i class="fas fa-user"></i> 학생 정보</h3>
                        <div class="form-group">
                            <label>학생생년월일</label>
                            <input type="date" id="editStudentBirth" />
                        </div>
                        <div class="form-group">
                            <label>학생연락처</label>
                            <input type="text" id="editStudentPhone" />
                        </div>
                        <div class="form-group">
                            <label>개인정보동의일자</label>
                            <input type="date" id="editPrivacyDate" />
                        </div>
                        <div class="form-group">
                            <label>보호자명</label>
                            <input type="text" id="editGuardianName" />
                        </div>
                        <div class="form-group">
                            <label>관계</label>
                            <select id="editRelation">
                                <option value="부모">부모</option>
                                <option value="조부모">조부모</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>보호자연락처</label>
                            <input type="text" id="editGuardianPhone" />
                        </div>
                        <div class="form-group">
                            <label>기타사항</label>
                            <textarea id="editOtherInfo" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-cogs"></i> 악세사리 관리</h3>
                    <div class="accessories-grid">
                        <div class="accessory-item">
                            <label><i class="fas fa-plug"></i> 충전기</label>
                            <select id="editChargerStatus">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-cable-car"></i> 충전케이블</label>
                            <select id="editCableStatus">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-usb"></i> USB 랜 젠더</label>
                            <select id="editUsbStatus">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-mouse"></i> 마우스</label>
                            <select id="editMouseStatus">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-shopping-bag"></i> 가방</label>
                            <select id="editBagStatus">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-mobile-alt"></i> 케이스</label>
                            <select id="editCaseStatus">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="saveRentalChanges()">
                        <i class="fas fa-save"></i> 저장
                    </button>
                    <button class="btn btn-danger" onclick="closeModal('rentalDetailModal')">
                        <i class="fas fa-times"></i> 취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Rental Modal -->
    <div id="addRentalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">새 대여 추가</div>
                <button class="modal-close" onclick="closeModal('addRentalModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-section">
                        <h3>기본 정보</h3>
                        <div class="form-group">
                            <label>관리번호</label>
                            <input type="text" id="newManagementNumber" />
                        </div>
                        <div class="form-group">
                            <label>제품시리얼</label>
                            <input type="text" id="newProductSerial" />
                        </div>
                        <div class="form-group">
                            <label>학교명</label>
                            <input type="text" id="newSchoolName" />
                        </div>
                        <div class="form-group">
                            <label>학교급</label>
                            <select id="newSchoolLevel">
                                <option value="초등학교">초등학교</option>
                                <option value="중학교">중학교</option>
                                <option value="고등학교">고등학교</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>학생명</label>
                            <input type="text" id="newStudentName" />
                        </div>
                        <div class="form-group">
                            <label>제품명</label>
                            <input type="text" id="newProductName" />
                        </div>
                    </div>
                    <div class="form-section">
                        <h3>학생 정보</h3>
                        <div class="form-group">
                            <label>학생생년월일</label>
                            <input type="date" id="newStudentBirth" />
                        </div>
                        <div class="form-group">
                            <label>학생연락처</label>
                            <input type="text" id="newStudentPhone" />
                        </div>
                        <div class="form-group">
                            <label>개인정보동의일자</label>
                            <input type="date" id="newPrivacyDate" />
                        </div>
                        <div class="form-group">
                            <label>보호자명</label>
                            <input type="text" id="newGuardianName" />
                        </div>
                        <div class="form-group">
                            <label>관계</label>
                            <select id="newRelation">
                                <option value="부모">부모</option>
                                <option value="조부모">조부모</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>보호자연락처</label>
                            <input type="text" id="newGuardianPhone" />
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="addNewRental()">
                        <i class="fas fa-save"></i> 저장
                    </button>
                    <button class="btn btn-danger" onclick="closeModal('addRentalModal')">
                        <i class="fas fa-times"></i> 취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">제품 추가</div>
                <button class="modal-close" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>차수</label>
                    <select id="newProductPhase">
                        <option value="1차">1차</option>
                        <option value="2차">2차</option>
                        <option value="3차">3차</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>관리번호</label>
                    <input type="text" id="newProductManagementNumber" />
                </div>
                <div class="form-group">
                    <label>제품명</label>
                    <input type="text" id="newProductProductName" />
                </div>
                <div class="form-group">
                    <label>시리얼</label>
                    <input type="text" id="newProductSerial" />
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="addNewProduct()">
                        <i class="fas fa-save"></i> 저장
                    </button>
                    <button class="btn btn-danger" onclick="closeModal('addProductModal')">
                        <i class="fas fa-times"></i> 취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">사용자 추가</div>
                <button class="modal-close" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>사용자명</label>
                    <input type="text" id="newUsername" />
                </div>
                <div class="form-group">
                    <label>비밀번호</label>
                    <input type="password" id="newUserPassword" />
                </div>
                <div class="form-group">
                    <label>권한</label>
                    <select id="newUserRole">
                        <option value="사용자">사용자</option>
                        <option value="관리자">관리자</option>
                        <option value="최고관리자">최고관리자</option>
                    </select>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="addNewUser()">
                        <i class="fas fa-save"></i> 저장
                    </button>
                    <button class="btn btn-danger" onclick="closeModal('addUserModal')">
                        <i class="fas fa-times"></i> 취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Post Modal -->
    <div id="addPostModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">새 글 작성</div>
                <button class="modal-close" onclick="closeModal('addPostModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>제목</label>
                    <input type="text" id="newPostTitle" />
                </div>
                <div class="form-group">
                    <label>내용</label>
                    <textarea id="newPostContent" rows="10"></textarea>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="addNewPost()">
                        <i class="fas fa-save"></i> 저장
                    </button>
                    <button class="btn btn-danger" onclick="closeModal('addPostModal')">
                        <i class="fas fa-times"></i> 취소
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Configuration
        const SHEETS_API_KEY = 'AIzaSyAktuKM0rhd6GJJsvJjaFlhAVCB3poklxY';
        const SPREADSHEET_ID = '1HnnVFEa8pNEdiaEE-7DmECqtq-hOUJI_8VB4y8ojLHg';
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxk0HH1pg3lwEfDaDiFdCBCAR87yF7oizg4gSZ-A7VqhQdXVvUuooNqlvEh6h6BUfs4Kg/exec';

        // Global variables
        let currentUser = null;
        let currentUserRole = null;
        let rentals = [];
        let products = [];
        let users = [];
        let feedback = [];
        let filteredRentals = [];
        let filteredProducts = [];
        let filteredFeedback = [];
        let currentRentalPage = 1;
        let currentProductPage = 1;
        let currentFeedbackPage = 1;
        let itemsPerPage = 20;
        let editingRentalId = null;

        // Drag functionality
        let dragElement = null;
        let dragStartX = 0;
        let dragStartY = 0;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        function startDrag(e) {
            const modal = e.target.closest('.modal-content');
            if (modal) {
                dragElement = modal;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                const rect = modal.getBoundingClientRect();
                dragOffsetX = e.clientX - rect.left;
                dragOffsetY = e.clientY - rect.top;
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                e.preventDefault();
            }
        }

        function drag(e) {
            if (dragElement) {
                const x = e.clientX - dragOffsetX;
                const y = e.clientY - dragOffsetY;
                dragElement.style.position = 'fixed';
                dragElement.style.left = x + 'px';
                dragElement.style.top = y + 'px';
                dragElement.style.transform = 'none';
            }
        }

        function stopDrag() {
            dragElement = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                currentUser = userData.username;
                currentUserRole = userData.role;
                showMainApp();
            }

            // Setup login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });

            // Load initial data
            loadAllData();
        });

        // Authentication
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Simple authentication (in real app, this would be server-side)
            const validUsers = {
                'admin': { password: 'admin123', role: '최고관리자' },
                'manager': { password: 'manager123', role: '관리자' },
                'user': { password: 'user123', role: '사용자' }
            };

            if (validUsers[username] && validUsers[username].password === password) {
                currentUser = username;
                currentUserRole = validUsers[username].role;
                
                localStorage.setItem('currentUser', JSON.stringify({
                    username: username,
                    role: currentUserRole
                }));

                showMainApp();
            } else {
                alert('잘못된 사용자명 또는 비밀번호입니다.');
            }
        }

        function logout() {
            currentUser = null;
            currentUserRole = null;
            localStorage.removeItem('currentUser');
            
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            
            // Reset form
            document.getElementById('loginForm').reset();
        }

        function showMainApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('currentUser').textContent = currentUser;

            // Setup menu based on role
            setupMenuByRole();
            
            // Show default page
            showPage('rental');
            
            loadAllData();
        }

        function setupMenuByRole() {
            const userManagementMenu = document.getElementById('userManagementMenu');
            const deleteButtons = document.querySelectorAll('#deleteAllRentalsBtn, #deleteAllProductsBtn');
            
            if (currentUserRole === '사용자') {
                // Users can only see rental page in read-only mode
                userManagementMenu.style.display = 'none';
                deleteButtons.forEach(btn => btn.style.display = 'none');
                
                // Hide edit buttons for users
                document.body.classList.add('user-role');
            } else if (currentUserRole === '관리자') {
                // Managers can edit rentals but not products or users
                userManagementMenu.style.display = 'none';
            }
            // Super admins see everything (default)
        }

        // Page Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            
            // Remove active class from all menu items
            document.querySelectorAll('.sidebar-menu a').forEach(link => link.classList.remove('active'));
            
            // Show selected page
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            // Add active class to current menu item
            event.target.classList.add('active');
            
            // Load data for the page
            switch(pageId) {
                case 'rental':
                    loadRentals();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'feedback':
                    loadFeedback();
                    break;
            }
        }

        // Google Sheets API functions
        async function loadFromSheet(sheetName) {
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${sheetName}?key=${SHEETS_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                return data.values || [];
            } catch (error) {
                console.error('Error loading from sheet:', error);
                return [];
            }
        }

        async function saveToSheet(data, type) {
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({...data, type: type})
                });
                
                const result = await response.json();
                return result.success;
            } catch (error) {
                console.error('Error saving to sheet:', error);
                return false;
            }
        }

        async function loadAllData() {
            try {
                // Load products
                const productData = await loadFromSheet('제품관리');
                if (productData.length > 1) { // Skip header
                    products = productData.slice(1).map((row, index) => ({
                        id: index + 1,
                        차수: row[0] || '',
                        관리번호: row[1] || '',
                        제품명: row[2] || '',
                        시리얼: row[3] || ''
                    }));
                }

                // Load rentals
                const rentalData = await loadFromSheet('대여관리');
                if (rentalData.length > 1) { // Skip header
                    rentals = rentalData.slice(1).map((row, index) => ({
                        id: index + 1,
                        순번: row[0] || index + 1,
                        관리번호: row[1] || '',
                        제품시리얼: row[2] || '',
                        학교명: row[3] || '',
                        학교급: row[4] || '',
                        학생명: row[5] || '',
                        상태: row[6] || '대여중',
                        메모1: row[7] || '',
                        메모2: row[8] || '',
                        학생생년월일: row[9] || '',
                        학생연락처: row[10] || '',
                        개인정보동의일자: row[11] || '',
                        보호자명: row[12] || '',
                        관계: row[13] || '',
                        보호자연락처: row[14] || '',
                        기타사항: row[15] || '',
                        충전기상태: row[16] || '양호',
                        충전케이블상태: row[17] || '양호',
                        USB랜젠더상태: row[18] || '양호',
                        마우스상태: row[19] || '양호',
                        가방상태: row[20] || '양호',
                        케이스상태: row[21] || '양호',
                        제품명: getProductNameBySerial(row[2])
                    }));
                }

                // Load users
                const userData = await loadFromSheet('사용자관리');
                if (userData.length > 1) {
                    users = userData.slice(1).map((row, index) => ({
                        id: index + 1,
                        사용자명: row[0] || '',
                        권한: row[1] || '',
                        생성일: row[2] || '',
                        최종접속일: row[3] || '',
                        상태: row[4] || '활성'
                    }));
                }

                // Load feedback
                const feedbackData = await loadFromSheet('피드백');
                if (feedbackData.length > 1) {
                    feedback = feedbackData.slice(1).map((row, index) => ({
                        id: index + 1,
                        번호: row[0] || index + 1,
                        제목: row[1] || '',
                        내용: row[2] || '',
                        작성자: row[3] || '',
                        작성일: row[4] || '',
                        조회수: row[5] || 0
                    }));
                }

                // Update displays
                updateDashboard();
                loadRentals();
                
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function getProductNameBySerial(serial) {
            const product = products.find(p => p.시리얼 === serial);
            return product ? product.제품명 : '';
        }

        // Dashboard functions
        function updateDashboard() {
            const firstPhaseCount = products.filter(p => p.차수 === '1차').length;
            const secondPhaseCount = products.filter(p => p.차수 === '2차').length;
            const rentedCount = rentals.filter(r => r.상태 === '대여중').length;
            const availableCount = rentals.filter(r => r.상태 === '미대여중').length;

            document.getElementById('firstPhaseCount').textContent = firstPhaseCount;
            document.getElementById('secondPhaseCount').textContent = secondPhaseCount;
            document.getElementById('rentedCount').textContent = rentedCount;
            document.getElementById('availableCount').textContent = availableCount;

            // Update model filter
            const modelFilter = document.getElementById('modelFilter');
            const uniqueModels = [...new Set(products.map(p => p.제품명))];
            modelFilter.innerHTML = '<option value="">전체 모델</option>';
            uniqueModels.forEach(model => {
                if (model) {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelFilter.appendChild(option);
                }
            });
        }

        // Rental Management
        function loadRentals() {
            filteredRentals = [...rentals];
            displayRentals();
        }

        function displayRentals() {
            const tbody = document.getElementById('rentalTableBody');
            const startIndex = (currentRentalPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageRentals = filteredRentals.slice(startIndex, endIndex);

            tbody.innerHTML = '';
            
            pageRentals.forEach(rental => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="rental-checkbox" data-id="${rental.id}"></td>
                    <td>${rental.순번}</td>
                    <td><a href="#" onclick="showRentalDetail('${rental.id}')" style="color: #4a90e2; text-decoration: none;">${rental.관리번호}</a></td>
                    <td>${rental.제품시리얼}</td>
                    <td>${rental.학교명}</td>
                    <td>${rental.학교급}</td>
                    <td>${rental.학생명}</td>
                    <td>${rental.제품명}</td>
                    <td>
                        <select class="status-select status-${rental.상태}" onchange="updateRentalStatus('${rental.id}', this.value)">
                            <option value="대여중" ${rental.상태 === '대여중' ? 'selected' : ''}>대여중</option>
                            <option value="미대여중" ${rental.상태 === '미대여중' ? 'selected' : ''}>미대여중</option>
                        </select>
                    </td>
                    <td>${rental.메모1}</td>
                    <td>${rental.메모2}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteRental('${rental.id}')" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateRentalPagination();
        }

        function updateRentalPagination() {
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            document.getElementById('totalPagesRental').textContent = totalPages;
            document.getElementById('currentPageRental').value = currentRentalPage;
            
            document.getElementById('prevPageRental').disabled = currentRentalPage <= 1;
            document.getElementById('nextPageRental').disabled = currentRentalPage >= totalPages;
        }

        function changeRentalPage(direction) {
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            const newPage = currentRentalPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentRentalPage = newPage;
                displayRentals();
            }
        }

        function goToRentalPage() {
            const pageInput = document.getElementById('currentPageRental');
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            const newPage = parseInt(pageInput.value);
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentRentalPage = newPage;
                displayRentals();
            } else {
                pageInput.value = currentRentalPage;
            }
        }

        function searchRentals() {
            const searchTerm = document.getElementById('rentalSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const phaseFilter = document.getElementById('phaseFilter').value;
            const modelFilter = document.getElementById('modelFilter').value;
            const dateStart = document.getElementById('dateStart').value;
            const dateEnd = document.getElementById('dateEnd').value;

            filteredRentals = rentals.filter(rental => {
                const matchesSearch = !searchTerm || 
                    rental.관리번호.toLowerCase().includes(searchTerm) ||
                    rental.학교명.toLowerCase().includes(searchTerm) ||
                    rental.학생명.toLowerCase().includes(searchTerm) ||
                    rental.제품명.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || rental.상태 === statusFilter;
                
                const product = products.find(p => p.시리얼 === rental.제품시리얼);
                const matchesPhase = !phaseFilter || (product && product.차수 === phaseFilter);
                const matchesModel = !modelFilter || rental.제품명 === modelFilter;
                
                const matchesDate = (!dateStart || rental.개인정보동의일자 >= dateStart) &&
                                  (!dateEnd || rental.개인정보동의일자 <= dateEnd);

                return matchesSearch && matchesStatus && matchesPhase && matchesModel && matchesDate;
            });

            currentRentalPage = 1;
            displayRentals();
        }

        function resetFilters() {
            document.getElementById('rentalSearch').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('phaseFilter').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('dateStart').value = '';
            document.getElementById('dateEnd').value = '';
            
            loadRentals();
        }

        function showRentalDetail(rentalId) {
            const rental = rentals.find(r => r.id == rentalId);
            if (!rental) return;

            editingRentalId = rentalId;

            // Populate form fields
            document.getElementById('editManagementNumber').value = rental.관리번호;
            document.getElementById('editProductSerial').value = rental.제품시리얼;
            document.getElementById('editSchoolName').value = rental.학교명;
            document.getElementById('editSchoolLevel').value = rental.학교급;
            document.getElementById('editStudentName').value = rental.학생명;
            document.getElementById('editProductName').value = rental.제품명;
            document.getElementById('editStatus').value = rental.상태;
            document.getElementById('editMemo1').value = rental.메모1;
            document.getElementById('editMemo2').value = rental.메모2;
            
            document.getElementById('editStudentBirth').value = rental.학생생년월일;
            document.getElementById('editStudentPhone').value = rental.학생연락처;
            document.getElementById('editPrivacyDate').value = rental.개인정보동의일자;
            document.getElementById('editGuardianName').value = rental.보호자명;
            document.getElementById('editRelation').value = rental.관계;
            document.getElementById('editGuardianPhone').value = rental.보호자연락처;
            document.getElementById('editOtherInfo').value = rental.기타사항;
            
            // Accessories
            document.getElementById('editChargerStatus').value = rental.충전기상태;
            document.getElementById('editCableStatus').value = rental.충전케이블상태;
            document.getElementById('editUsbStatus').value = rental.USB랜젠더상태;
            document.getElementById('editMouseStatus').value = rental.마우스상태;
            document.getElementById('editBagStatus').value = rental.가방상태;
            document.getElementById('editCaseStatus').value = rental.케이스상태;

            showModal('rentalDetailModal');
        }

        async function saveRentalChanges() {
            if (!editingRentalId) return;

            const updatedRental = {
                관리번호: document.getElementById('editManagementNumber').value,
                제품시리얼: document.getElementById('editProductSerial').value,
                학교명: document.getElementById('editSchoolName').value,
                학교급: document.getElementById('editSchoolLevel').value,
                학생명: document.getElementById('editStudentName').value,
                제품명: document.getElementById('editProductName').value,
                상태: document.getElementById('editStatus').value,
                메모1: document.getElementById('editMemo1').value,
                메모2: document.getElementById('editMemo2').value,
                학생생년월일: document.getElementById('editStudentBirth').value,
                학생연락처: document.getElementById('editStudentPhone').value,
                개인정보동의일자: document.getElementById('editPrivacyDate').value,
                보호자명: document.getElementById('editGuardianName').value,
                관계: document.getElementById('editRelation').value,
                보호자연락처: document.getElementById('editGuardianPhone').value,
                기타사항: document.getElementById('editOtherInfo').value,
                충전기상태: document.getElementById('editChargerStatus').value,
                충전케이블상태: document.getElementById('editCableStatus').value,
                USB랜젠더상태: document.getElementById('editUsbStatus').value,
                마우스상태: document.getElementById('editMouseStatus').value,
                가방상태: document.getElementById('editBagStatus').value,
                케이스상태: document.getElementById('editCaseStatus').value
            };

            const success = await saveToSheet(updatedRental, 'rental_update');
            
            if (success) {
                // Update local data
                const rentalIndex = rentals.findIndex(r => r.id == editingRentalId);
                if (rentalIndex !== -1) {
                    rentals[rentalIndex] = { ...rentals[rentalIndex], ...updatedRental };
                }
                
                closeModal('rentalDetailModal');
                displayRentals();
                updateDashboard();
                
                showAlert('대여 정보가 성공적으로 수정되었습니다.', 'success');
            } else {
                showAlert('저장 중 오류가 발생했습니다.', 'danger');
            }
        }

        function showAddRentalModal() {
            // Clear form
            document.querySelectorAll('#addRentalModal input, #addRentalModal select, #addRentalModal textarea').forEach(input => {
                input.value = '';
            });
            
            showModal('addRentalModal');
        }

        async function addNewRental() {
            const newRental = {
                순번: rentals.length + 1,
                관리번호: document.getElementById('newManagementNumber').value,
                제품시리얼: document.getElementById('newProductSerial').value,
                학교명: document.getElementById('newSchoolName').value,
                학교급: document.getElementById('newSchoolLevel').value,
                학생명: document.getElementById('newStudentName').value,
                제품명: document.getElementById('newProductName').value,
                상태: '대여중',
                메모1: '',
                메모2: '',
                학생생년월일: document.getElementById('newStudentBirth').value,
                학생연락처: document.getElementById('newStudentPhone').value,
                개인정보동의일자: document.getElementById('newPrivacyDate').value,
                보호자명: document.getElementById('newGuardianName').value,
                관계: document.getElementById('newRelation').value,
                보호자연락처: document.getElementById('newGuardianPhone').value,
                기타사항: '',
                충전기상태: '양호',
                충전케이블상태: '양호',
                USB랜젠더상태: '양호',
                마우스상태: '양호',
                가방상태: '양호',
                케이스상태: '양호'
            };

            // Check if management number or serial already exists
            if (rentals.some(r => r.관리번호 === newRental.관리번호)) {
                showAlert('이미 존재하는 관리번호입니다.', 'danger');
                return;
            }

            if (rentals.some(r => r.제품시리얼 === newRental.제품시리얼)) {
                showAlert('이미 존재하는 시리얼입니다.', 'danger');
                return;
            }

            const success = await saveToSheet(newRental, 'rental');
            
            if (success) {
                // Add to local data
                newRental.id = rentals.length + 1;
                rentals.push(newRental);
                
                closeModal('addRentalModal');
                loadRentals();
                updateDashboard();
                
                showAlert('새 대여가 성공적으로 추가되었습니다.', 'success');
            } else {
                showAlert('저장 중 오류가 발생했습니다.', 'danger');
            }
        }

        async function updateRentalStatus(rentalId, newStatus) {
            const rental = rentals.find(r => r.id == rentalId);
            if (!rental) return;

            rental.상태 = newStatus;
            
            const success = await saveToSheet({ ...rental }, 'rental_update');
            
            if (success) {
                displayRentals();
                updateDashboard();
            } else {
                showAlert('상태 변경 중 오류가 발생했습니다.', 'danger');
                loadAllData(); // Reload to get correct state
            }
        }

        function toggleSelectAllRentals() {
            const selectAll = document.getElementById('selectAllRentals');
            const checkboxes = document.querySelectorAll('.rental-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        async function deleteRental(rentalId) {
            if (!confirm('정말 이 대여 정보를 삭제하시겠습니까?')) return;

            const success = await saveToSheet({ id: rentalId }, 'rental_delete');
            
            if (success) {
                rentals = rentals.filter(r => r.id != rentalId);
                loadRentals();
                updateDashboard();
                showAlert('대여 정보가 삭제되었습니다.', 'success');
            } else {
                showAlert('삭제 중 오류가 발생했습니다.', 'danger');
            }
        }

        async function deleteAllRentals() {
            if (!confirm('정말 모든 대여 데이터를 삭제하시겠습니까?')) return;
            if (!confirm('이 작업은 되돌릴 수 없습니다. 계속하시겠습니까?')) return;

            const success = await saveToSheet({}, 'rental_delete_all');
            
            if (success) {
                rentals = [];
                loadRentals();
                updateDashboard();
                showAlert('모든 대여 데이터가 삭제되었습니다.', 'success');
            } else {
                showAlert('삭제 중 오류가 발생했습니다.', 'danger');
            }
        }

        // Download rental sample
        function downloadRentalSample() {
            const headers = [
                '순번', '관리번호', '제품시리얼', '학교명', '학교급', '학생명', '상태', '메모1', '메모2',
                '학생생년월일', '학생연락처', '개인정보동의일자', '보호자명', '관계', '보호자연락처', '기타사항',
                '충전기상태', '충전케이블상태', 'USB랜젠더상태', '마우스상태', '가방상태', '케이스상태'
            ];
            
            const sampleData = [
                [1, '2025-NEW1', 'UPLOADED001', '김포초등학교', '초등학교', '김수진', '대여중', '정상 대여', '체크 완료', '2010-03-15', '010-1234-5678', '2024-12-01', '김영희', '부모', '010-9876-5432', '알레르기 주의', '양호', '양호', '양호', '양호', '양호', '양호']
            ];
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([headers, ...sampleData]);
            XLSX.utils.book_append_sheet(wb, ws, "대여관리");
            XLSX.writeFile(wb, "대여관리_샘플.xlsx");
        }

        // Upload rental file
        async function uploadRentalFile(input) {
            const file = input.files[0];
            if (!file) return;

            try {
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data, { type: 'buffer' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                if (jsonData.length < 2) {
                    showAlert('파일에 데이터가 없습니다.', 'danger');
                    return;
                }

                // Process data (skip header row)
                const uploadedRentals = jsonData.slice(1).map((row, index) => ({
                    순번: row[0] || index + 1,
                    관리번호: row[1] || '',
                    제품시리얼: row[2] || '',
                    학교명: row[3] || '',
                    학교급: row[4] || '',
                    학생명: row[5] || '',
                    상태: '대여중', // Always set to 대여중 regardless of file content
                    메모1: row[7] || '',
                    메모2: row[8] || '',
                    학생생년월일: row[9] || '',
                    학생연락처: row[10] || '',
                    개인정보동의일자: row[11] || '',
                    보호자명: row[12] || '',
                    관계: row[13] || '',
                    보호자연락처: row[14] || '',
                    기타사항: row[15] || '',
                    충전기상태: row[16] || '양호',
                    충전케이블상태: row[17] || '양호',
                    USB랜젠더상태: row[18] || '양호',
                    마우스상태: row[19] || '양호',
                    가방상태: row[20] || '양호',
                    케이스상태: row[21] || '양호',
                    제품명: getProductNameBySerial(row[2])
                }));

                // Save each rental
                let successCount = 0;
                for (const rental of uploadedRentals) {
                    const success = await saveToSheet(rental, 'rental');
                    if (success) successCount++;
                }

                if (successCount > 0) {
                    showAlert(`${successCount}개의 대여 정보가 성공적으로 업로드되었습니다.`, 'success');
                    loadAllData();
                } else {
                    showAlert('업로드 중 오류가 발생했습니다.', 'danger');
                }

            } catch (error) {
                console.error('Upload error:', error);
                showAlert('파일 처리 중 오류가 발생했습니다.', 'danger');
            }

            // Reset file input
            input.value = '';
        }

        // Product Management
        function loadProducts() {
            filteredProducts = [...products];
            displayProducts();
        }

        function displayProducts() {
            const tbody = document.getElementById('productTableBody');
            const startIndex = (currentProductPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageProducts = filteredProducts.slice(startIndex, endIndex);

            tbody.innerHTML = '';
            
            pageProducts.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="product-checkbox" data-id="${product.id}"></td>
                    <td>${product.차수}</td>
                    <td>${product.관리번호}</td>
                    <td>${product.제품명}</td>
                    <td>${product.시리얼}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editProduct('${product.id}')" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateProductPagination();
        }

        function updateProductPagination() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            document.getElementById('totalPagesProduct').textContent = totalPages;
            document.getElementById('currentPageProduct').value = currentProductPage;
            
            document.getElementById('prevPageProduct').disabled = currentProductPage <= 1;
            document.getElementById('nextPageProduct').disabled = currentProductPage >= totalPages;
        }

        function changeProductPage(direction) {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            const newPage = currentProductPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentProductPage = newPage;
                displayProducts();
            }
        }

        function goToProductPage() {
            const pageInput = document.getElementById('currentPageProduct');
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            const newPage = parseInt(pageInput.value);
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentProductPage = newPage;
                displayProducts();
            } else {
                pageInput.value = currentProductPage;
            }
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            
            filteredProducts = products.filter(product => {
                return product.차수.toLowerCase().includes(searchTerm) ||
                       product.관리번호.toLowerCase().includes(searchTerm) ||
                       product.제품명.toLowerCase().includes(searchTerm) ||
                       product.시리얼.toLowerCase().includes(searchTerm);
            });

            currentProductPage = 1;
            displayProducts();
        }

        function resetProductFilters() {
            document.getElementById('productSearch').value = '';
            loadProducts();
        }

        function showAddProductModal() {
            // Clear form
            document.querySelectorAll('#addProductModal input, #addProductModal select').forEach(input => {
                input.value = '';
            });
            
            showModal('addProductModal');
        }

        async function addNewProduct() {
            const newProduct = {
                차수: document.getElementById('newProductPhase').value,
                관리번호: document.getElementById('newProductManagementNumber').value,
                제품명: document.getElementById('newProductProductName').value,
                시리얼: document.getElementById('newProductSerial').value
            };

            // Check for duplicates
            if (products.some(p => p.관리번호 === newProduct.관리번호)) {
                showAlert('이미 존재하는 관리번호입니다.', 'danger');
                return;
            }

            if (products.some(p => p.시리얼 === newProduct.시리얼)) {
                showAlert('이미 존재하는 시리얼입니다.', 'danger');
                return;
            }

            const success = await saveToSheet(newProduct, 'product');
            
            if (success) {
                newProduct.id = products.length + 1;
                products.push(newProduct);
                
                closeModal('addProductModal');
                loadProducts();
                updateDashboard();
                
                showAlert('새 제품이 성공적으로 추가되었습니다.', 'success');
            } else {
                showAlert('저장 중 오류가 발생했습니다.', 'danger');
            }
        }

        function editProduct(productId) {
            // Implement product editing if needed
            showAlert('제품 편집 기능은 곧 추가될 예정입니다.', 'info');
        }

        async function deleteProduct(productId) {
            if (!confirm('정말 이 제품을 삭제하시겠습니까?')) return;

            const success = await saveToSheet({ id: productId }, 'product_delete');
            
            if (success) {
                products = products.filter(p => p.id != productId);
                loadProducts();
                updateDashboard();
                showAlert('제품이 삭제되었습니다.', 'success');
            } else {
                showAlert('삭제 중 오류가 발생했습니다.', 'danger');
            }
        }

        function toggleSelectAllProducts() {
            const selectAll = document.getElementById('selectAllProducts');
            const checkboxes = document.querySelectorAll('.product-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        async function deleteAllProducts() {
            if (!confirm('정말 모든 제품 데이터를 삭제하시겠습니까?')) return;
            if (!confirm('이 작업은 되돌릴 수 없습니다. 계속하시겠습니까?')) return;

            const success = await saveToSheet({}, 'product_delete_all');
            
            if (success) {
                products = [];
                loadProducts();
                updateDashboard();
                showAlert('모든 제품 데이터가 삭제되었습니다.', 'success');
            } else {
                showAlert('삭제 중 오류가 발생했습니다.', 'danger');
            }
        }

        // Download product sample
        function downloadProductSample() {
            const headers = ['차수', '관리번호', '제품명', '시리얼'];
            const sampleData = [
                ['1차', '2025-UPLOAD1', '삼성노트북A', 'UPLOADED001'],
                ['1차', '2025-UPLOAD2', '삼성노트북A', 'UPLOADED002'],
                ['2차', '2025-UPLOAD3', '삼성태블릿B', 'UPLOADED003']
            ];
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([headers, ...sampleData]);
            XLSX.utils.book_append_sheet(wb, ws, "제품관리");
            XLSX.writeFile(wb, "제품관리_샘플.xlsx");
        }

        // Upload product file
        async function uploadProductFile(input) {
            const file = input.files[0];
            if (!file) return;

            try {
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data, { type: 'buffer' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                if (jsonData.length < 2) {
                    showAlert('파일에 데이터가 없습니다.', 'danger');
                    return;
                }

                // Process data (skip header row)
                const uploadedProducts = jsonData.slice(1).map(row => ({
                    차수: row[0] || '',
                    관리번호: row[1] || '',
                    제품명: row[2] || '',
                    시리얼: row[3] || ''
                }));

                // Save each product
                let successCount = 0;
                for (const product of uploadedProducts) {
                    const success = await saveToSheet(product, 'product');
                    if (success) successCount++;
                }

                if (successCount > 0) {
                    showAlert(`${successCount}개의 제품이 성공적으로 업로드되었습니다.`, 'success');
                    loadAllData();
                } else {
                    showAlert('업로드 중 오류가 발생했습니다.', 'danger');
                }

            } catch (error) {
                console.error('Upload error:', error);
                showAlert('파일 처리 중 오류가 발생했습니다.', 'danger');
            }

            // Reset file input
            input.value = '';
        }

        // User Management
        function loadUsers() {
            displayUsers();
        }

        function displayUsers() {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            // Add default users + any loaded users
            const defaultUsers = [
                { 사용자명: 'admin', 권한: '최고관리자', 생성일: '2024-01-01', 상태: '활성' },
                { 사용자명: 'manager', 권한: '관리자', 생성일: '2024-01-02', 상태: '활성' },
                { 사용자명: 'user', 권한: '사용자', 생성일: '2024-01-03', 상태: '활성' }
            ];

            [...defaultUsers, ...users].forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.사용자명}</td>
                    <td>${user.권한}</td>
                    <td>${user.생성일}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editUser('${user.사용자명}')" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteUser('${user.사용자명}')" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function showAddUserModal() {
            document.querySelectorAll('#addUserModal input, #addUserModal select').forEach(input => {
                input.value = '';
            });
            
            showModal('addUserModal');
        }

        async function addNewUser() {
            const newUser = {
                사용자명: document.getElementById('newUsername').value,
                비밀번호: document.getElementById('newUserPassword').value,
                권한: document.getElementById('newUserRole').value,
                생성일: new Date().toISOString().split('T')[0],
                상태: '활성'
            };

            const success = await saveToSheet(newUser, 'user');
            
            if (success) {
                users.push(newUser);
                
                closeModal('addUserModal');
                loadUsers();
                
                showAlert('새 사용자가 성공적으로 추가되었습니다.', 'success');
            } else {
                showAlert('저장 중 오류가 발생했습니다.', 'danger');
            }
        }

        function editUser(username) {
            showAlert('사용자 편집 기능은 곧 추가될 예정입니다.', 'info');
        }

        async function deleteUser(username) {
            if (['admin', 'manager', 'user'].includes(username)) {
                showAlert('기본 사용자는 삭제할 수 없습니다.', 'danger');
                return;
            }

            if (!confirm('정말 이 사용자를 삭제하시겠습니까?')) return;

            const success = await saveToSheet({ username: username }, 'user_delete');
            
            if (success) {
                users = users.filter(u => u.사용자명 !== username);
                loadUsers();
                showAlert('사용자가 삭제되었습니다.', 'success');
            } else {
                showAlert('삭제 중 오류가 발생했습니다.', 'danger');
            }
        }

        // Feedback Board
        function loadFeedback() {
            filteredFeedback = [...feedback];
            displayFeedback();
        }

        function displayFeedback() {
            const tbody = document.getElementById('feedbackTableBody');
            const startIndex = (currentFeedbackPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageFeedback = filteredFeedback.slice(startIndex, endIndex);

            tbody.innerHTML = '';
            
            pageFeedback.forEach(post => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${post.번호}</td>
                    <td><a href="#" onclick="viewPost('${post.id}')" style="color: #4a90e2; text-decoration: none;">${post.제목}</a></td>
                    <td>${post.작성자}</td>
                    <td>${post.작성일}</td>
                    <td>${post.조회수}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deletePost('${post.id}')" style="padding: 5px 10px; font-size: 12px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateFeedbackPagination();
        }

        function updateFeedbackPagination() {
            const totalPages = Math.ceil(filteredFeedback.length / itemsPerPage);
            document.getElementById('totalPagesFeedback').textContent = totalPages;
            document.getElementById('currentPageFeedback').value = currentFeedbackPage;
            
            document.getElementById('prevPageFeedback').disabled = currentFeedbackPage <= 1;
            document.getElementById('nextPageFeedback').disabled = currentFeedbackPage >= totalPages;
        }

        function changeFeedbackPage(direction) {
            const totalPages = Math.ceil(filteredFeedback.length / itemsPerPage);
            const newPage = currentFeedbackPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentFeedbackPage = newPage;
                displayFeedback();
            }
        }

        function goToFeedbackPage() {
            const pageInput = document.getElementById('currentPageFeedback');
            const totalPages = Math.ceil(filteredFeedback.length / itemsPerPage);
            const newPage = parseInt(pageInput.value);
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentFeedbackPage = newPage;
                displayFeedback();
            } else {
                pageInput.value = currentFeedbackPage;
            }
        }

        function searchFeedback() {
            const searchTerm = document.getElementById('feedbackSearch').value.toLowerCase();
            
            filteredFeedback = feedback.filter(post => {
                return post.제목.toLowerCase().includes(searchTerm) ||
                       post.내용.toLowerCase().includes(searchTerm);
            });

            currentFeedbackPage = 1;
            displayFeedback();
        }

        function showAddPostModal() {
            document.querySelectorAll('#addPostModal input, #addPostModal textarea').forEach(input => {
                input.value = '';
            });
            
            showModal('addPostModal');
        }

        async function addNewPost() {
            const newPost = {
                번호: feedback.length + 1,
                제목: document.getElementById('newPostTitle').value,
                내용: document.getElementById('newPostContent').value,
                작성자: currentUser,
                작성일: new Date().toISOString().split('T')[0],
                조회수: 0
            };

            const success = await saveToSheet(newPost, 'feedback');
            
            if (success) {
                newPost.id = feedback.length + 1;
                feedback.push(newPost);
                
                closeModal('addPostModal');
                loadFeedback();
                
                showAlert('새 글이 성공적으로 작성되었습니다.', 'success');
            } else {
                showAlert('저장 중 오류가 발생했습니다.', 'danger');
            }
        }

        function viewPost(postId) {
            const post = feedback.find(p => p.id == postId);
            if (!post) return;

            // Increase view count
            post.조회수 = parseInt(post.조회수) + 1;
            
            alert(`제목: ${post.제목}\n\n내용: ${post.내용}\n\n작성자: ${post.작성자}\n작성일: ${post.작성일}\n조회수: ${post.조회수}`);
            
            displayFeedback();
        }

        async function deletePost(postId) {
            if (!confirm('정말 이 글을 삭제하시겠습니까?')) return;

            const success = await saveToSheet({ id: postId }, 'feedback_delete');
            
            if (success) {
                feedback = feedback.filter(p => p.id != postId);
                loadFeedback();
                showAlert('글이 삭제되었습니다.', 'success');
            } else {
                showAlert('삭제 중 오류가 발생했습니다.', 'danger');
            }
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            editingRentalId = null;
        }

        // Utility functions
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 18px; cursor: pointer;">&times;</button>
            `;
            
            document.querySelector('.main-content').insertBefore(alertDiv, document.querySelector('.main-content').firstChild);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Click outside modal to close
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
                editingRentalId = null;
            }
        });
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"95490777edf2686d","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDs%2BOGSTgxeJ7NO1t9%2FYvMWolMvDcpH7FVROr7NzMUcjc2Ythh6BUOlojOKEXtxbLsKqvuwMUbpxGb0OFhO7NoO4neW1SJH%2Fm7A6XdjmdjwTE7%2B59cMnKCoPCROmI8AcWzwffRVah9E%2FYTszbdpowRVvZRMQZJUE8FzPPI4ue4WPjb2K4eRaQS16vzFucsNKgIQ35Us%2BQuqoopNimaoXUgPyUe%2FSRIkKC20IBT6mVvVWoo0qCcUm52ckE2QG0sf7o3pTv6DuoHYgR2pLw%2FcWk%2BEU%2B3LDNfow6DoJc%2F2u0TEXwRPG6MbGw7VWhY%2FyA5AiP1dL90NeLIZSWiFtJ%2B%2Bbs321YnF%2B8fWP9qeNJUywma7pq2s3CpCRM1zZHdz2XOl5GP3AzrCaqY9cF8FevMiwt9wrd%2B%2FZ2%2F%2FFsaC%2F8ZQeF4v%2F3uTBBqlNcU7PTFXgB%2BJ%2FyIo1kYW1xKe%2FIKA3aMAoIiE6SOjGASb3Lor7aLCka5Tje8JEhsxYUrLL%2FkgKLmHe2dWffHKc6x0IHa5ht3pCO94U%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDs+OGSTgxeJ7NO1t9/YvMWolMvDcpH7FVROr7NzMUcjc2Ythh6BUOlojOKEXtxbLsKqvuwMUbpxGb0OFhO7NoO4neW1SJH/m7A6XdjmdjwTE7+59cMnKCoPCROmI8AcWzwffRVah9E/YTszbdpowRVvZRMQZJUE8FzPPI4ue4WPjb2K4eRaQS16vzFucsNKgIQ35Us+QuqoopNimaoXUgPyUe/SRIkKC20IBT6mVvVWoo0qCcUm52ckE2QG0sf7o3pTv6DuoHYgR2pLw/cWk+EU+3LDNfow6DoJc/2u0TEXwRPG6MbGw7VWhY/yA5AiP1dL90NeLIZSWiFtJ++bs321YnF+8fWP9qeNJUywma7pq2s3CpCRM1zZHdz2XOl5GP3AzrCaqY9cF8FevMiwt9wrd+/Z2//FsaC/8ZQeF4v/3uTBBqlNcU7PTFXgB+J/yIo1kYW1xKe/IKA3aMAoIiE6SOjGASb3Lor7aLCka5Tje8JEhsxYUrLL/kgKLmHe2dWffHKc6x0IHa5ht3pCO94U=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
