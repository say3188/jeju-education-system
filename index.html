<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제주교육청 스마트단말 관리 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #4a5568;
            --secondary-color: #2d3748;
            --accent-color: #3182ce;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --danger-color: #e53e3e;
            --light-gray: #f7fafc;
            --medium-gray: #edf2f7;
            --dark-gray: #718096;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-gray);
        }

        .tg-header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tg-sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            width: 250px;
            min-height: calc(100vh - 70px);
            color: white;
            position: fixed;
            left: 0;
            top: 70px;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
        }

        .tg-main {
            margin-left: 250px;
            padding: 2rem;
            min-height: calc(100vh - 70px);
            background-color: white;
        }

        .tg-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }

        .tg-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tg-btn-primary {
            background-color: var(--accent-color);
            color: white;
        }

        .tg-btn-primary:hover {
            background-color: #2c5aa0;
        }

        .tg-btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .tg-btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .tg-btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .tg-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tg-table th {
            background: linear-gradient(135deg, var(--accent-color) 0%, #2c5aa0 100%);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        .tg-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--medium-gray);
        }

        .tg-table tr:hover {
            background-color: #f8fafc;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .stat-card.success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card.info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-color) 0%, #2c5aa0 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: between;
            align-items: center;
            cursor: move;
        }

        .modal-body {
            padding: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--secondary-color);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d2d6dc;
            border-radius: 6px;
            font-size: 1rem;
        }

        .login-container {
            display: flex;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            padding: 3rem;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: auto;
            width: 100%;
            max-width: 400px;
        }

        .logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo img {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid #d2d6dc;
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .pagination button:hover {
            background: var(--light-gray);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination input {
            width: 60px;
            text-align: center;
            padding: 0.5rem;
            border: 1px solid #d2d6dc;
            border-radius: 6px;
        }

        @media (max-width: 768px) {
            .tg-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .tg-sidebar.open {
                transform: translateX(0);
            }
            
            .tg-main {
                margin-left: 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 1% auto;
            }
        }
    </style>
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="logo">
                <div class="w-20 h-20 mx-auto mb-4 bg-blue-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-graduation-cap text-white text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">제주교육청</h1>
                <p class="text-gray-600">스마트단말 관리 시스템</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">사용자명</label>
                    <input type="text" id="username" class="form-control" placeholder="사용자명을 입력하세요" required>
                </div>
                
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" class="form-control" placeholder="비밀번호를 입력하세요" required>
                </div>
                
                <button type="submit" class="tg-btn tg-btn-primary w-full">
                    <i class="fas fa-sign-in-alt"></i>
                    로그인
                </button>
            </form>
            
            <div class="text-center mt-4 text-sm text-gray-600">
                <p>콜센터: 1811-8290</p>
            </div>
        </div>
    </div>

    <!-- 메인 시스템 -->
    <div id="mainSystem" style="display: none;">
        <!-- 헤더 -->
        <header class="tg-header">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <button id="menuToggle" class="md:hidden text-white">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="text-xl font-bold">제주교육청 스마트단말 관리 시스템</h1>
                </div>
                <div class="flex items-center gap-4">
                    <span id="currentUser">관리자님 환영합니다!</span>
                    <button id="logoutBtn" class="tg-btn tg-btn-danger">
                        <i class="fas fa-sign-out-alt"></i>
                        로그아웃
                    </button>
                </div>
            </div>
        </header>

        <!-- 사이드바 -->
        <nav id="sidebar" class="tg-sidebar">
            <div class="p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#" onclick="showPage('rental')" class="flex items-center gap-3 p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-clipboard-list"></i>
                            대여 관리
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showPage('product')" class="flex items-center gap-3 p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-box"></i>
                            제품 관리
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showPage('user')" class="flex items-center gap-3 p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-users"></i>
                            사용자 관리
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="showPage('feedback')" class="flex items-center gap-3 p-3 rounded hover:bg-gray-700 transition">
                            <i class="fas fa-comments"></i>
                            피드백 게시판
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- 메인 콘텐츠 -->
        <main class="tg-main">
            <!-- 대여 관리 페이지 -->
            <div id="rentalPage" class="page">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">대여 관리</h2>
                    <p class="text-gray-600">스마트단말 대여 현황을 관리합니다.</p>
                </div>

                <!-- 통계 카드 -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="stat-card">
                        <div class="text-3xl font-bold" id="stat1차장비수">0</div>
                        <div class="text-sm opacity-80">1차 장비 수</div>
                        <i class="fas fa-laptop text-2xl mt-2"></i>
                    </div>
                    <div class="stat-card success">
                        <div class="text-3xl font-bold" id="stat2차장비수">0</div>
                        <div class="text-sm opacity-80">2차 장비 수</div>
                        <i class="fas fa-tablet text-2xl mt-2"></i>
                    </div>
                    <div class="stat-card info">
                        <div class="text-3xl font-bold" id="stat대여중">0</div>
                        <div class="text-sm opacity-80">대여중</div>
                        <i class="fas fa-hand-holding text-2xl mt-2"></i>
                    </div>
                    <div class="stat-card warning">
                        <div class="text-3xl font-bold" id="stat미대여중">0</div>
                        <div class="text-sm opacity-80">미 대여중</div>
                        <i class="fas fa-exclamation-triangle text-2xl mt-2"></i>
                    </div>
                </div>

                <!-- 검색 및 필터 -->
                <div class="tg-card mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="form-group">
                            <label>통합 검색</label>
                            <input type="text" id="rentalSearchInput" class="form-control" placeholder="관리번호, 학교명, 학생명, 제품명...">
                        </div>
                        <div class="form-group">
                            <label>상태 선택</label>
                            <select id="rentalStatusFilter" class="form-control">
                                <option value="">전체 상태</option>
                                <option value="대여중">대여중</option>
                                <option value="미대여중">미대여중</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>차수 선택</label>
                            <select id="rentalPhaseFilter" class="form-control">
                                <option value="">전체 차수</option>
                                <option value="1차">1차</option>
                                <option value="2차">2차</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>모델 선택</label>
                            <select id="rentalModelFilter" class="form-control">
                                <option value="">전체 모델</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="form-group">
                            <label>개인정보동의일자 시작</label>
                            <input type="date" id="rentalDateStart" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>개인정보동의일자 종료</label>
                            <input type="date" id="rentalDateEnd" class="form-control">
                        </div>
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="searchRentals()" class="tg-btn tg-btn-primary">
                            <i class="fas fa-search"></i> 검색
                        </button>
                        <button onclick="resetRentalSearch()" class="tg-btn" style="background-color: #6b7280; color: white;">
                            <i class="fas fa-undo"></i> 초기화
                        </button>
                    </div>
                </div>

                <!-- 액션 버튼 -->
                <div class="flex gap-2 mb-4">
                    <button onclick="openAddRentalModal()" class="tg-btn tg-btn-success">
                        <i class="fas fa-plus"></i> 새 대여 추가
                    </button>
                    <button onclick="downloadRentalSample()" class="tg-btn tg-btn-primary">
                        <i class="fas fa-download"></i> Excel 샘플
                    </button>
                    <button onclick="uploadRentalExcel()" class="tg-btn tg-btn-warning">
                        <i class="fas fa-upload"></i> Excel 업로드
                    </button>
                    <button onclick="deleteSelectedRentals()" class="tg-btn tg-btn-danger">
                        <i class="fas fa-trash"></i> 전체 삭제
                    </button>
                </div>

                <!-- 대여 테이블 -->
                <div class="overflow-x-auto">
                    <table class="tg-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllRentals"></th>
                                <th>순번</th>
                                <th>관리번호</th>
                                <th>제품시리얼</th>
                                <th>학교명</th>
                                <th>학교급</th>
                                <th>학생명</th>
                                <th>제품명</th>
                                <th>상태</th>
                                <th>메모1</th>
                                <th>메모2</th>
                                <th>기타</th>
                            </tr>
                        </thead>
                        <tbody id="rentalTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination">
                    <button onclick="changeRentalPage(-1)" id="rentalPrevBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <input type="number" id="rentalCurrentPage" value="1" min="1" onchange="goToRentalPage(this.value)">
                    <span>/ <span id="rentalTotalPages">1</span></span>
                    <button onclick="changeRentalPage(1)" id="rentalNextBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- 제품 관리 페이지 -->
            <div id="productPage" class="page" style="display: none;">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">제품 관리</h2>
                    <p class="text-gray-600">제품 데이터를 관리합니다.</p>
                </div>

                <!-- 검색 -->
                <div class="tg-card mb-6">
                    <div class="form-group">
                        <label>검색</label>
                        <input type="text" id="productSearchInput" class="form-control" placeholder="차수, 관리번호, 제품명, 시리얼 검색...">
                    </div>
                    <div class="flex gap-2">
                        <button onclick="searchProducts()" class="tg-btn tg-btn-primary">
                            <i class="fas fa-search"></i> 검색
                        </button>
                        <button onclick="resetProductSearch()" class="tg-btn" style="background-color: #6b7280; color: white;">
                            <i class="fas fa-undo"></i> 초기화
                        </button>
                    </div>
                </div>

                <!-- 액션 버튼 -->
                <div class="flex gap-2 mb-4">
                    <button onclick="openAddProductModal()" class="tg-btn tg-btn-success">
                        <i class="fas fa-plus"></i> 제품 추가
                    </button>
                    <button onclick="downloadProductSample()" class="tg-btn tg-btn-primary">
                        <i class="fas fa-download"></i> Excel 샘플
                    </button>
                    <button onclick="uploadProductExcel()" class="tg-btn tg-btn-warning">
                        <i class="fas fa-upload"></i> Excel 업로드
                    </button>
                    <button onclick="deleteSelectedProducts()" class="tg-btn tg-btn-danger">
                        <i class="fas fa-trash"></i> 전체 삭제
                    </button>
                </div>

                <!-- 제품 테이블 -->
                <div class="overflow-x-auto">
                    <table class="tg-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllProducts"></th>
                                <th>차수</th>
                                <th>관리번호</th>
                                <th>제품명</th>
                                <th>시리얼</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination">
                    <button onclick="changeProductPage(-1)" id="productPrevBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <input type="number" id="productCurrentPage" value="1" min="1" onchange="goToProductPage(this.value)">
                    <span>/ <span id="productTotalPages">1</span></span>
                    <button onclick="changeProductPage(1)" id="productNextBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- 사용자 관리 페이지 -->
            <div id="userPage" class="page" style="display: none;">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">사용자 관리</h2>
                    <p class="text-gray-600">시스템 사용자를 관리합니다.</p>
                </div>

                <div class="flex gap-2 mb-4">
                    <button onclick="openAddUserModal()" class="tg-btn tg-btn-success">
                        <i class="fas fa-user-plus"></i> 사용자 추가
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="tg-table">
                        <thead>
                            <tr>
                                <th>사용자명</th>
                                <th>권한</th>
                                <th>생성일</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <tr>
                                <td>admin</td>
                                <td><span class="bg-red-100 text-red-800 px-2 py-1 rounded">최고관리자</span></td>
                                <td>2024-01-01</td>
                                <td>
                                    <button onclick="editUser('admin')" class="tg-btn tg-btn-primary">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>manager</td>
                                <td><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded">관리자</span></td>
                                <td>2024-01-02</td>
                                <td>
                                    <button onclick="editUser('manager')" class="tg-btn tg-btn-primary">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteUser('manager')" class="tg-btn tg-btn-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>user</td>
                                <td><span class="bg-green-100 text-green-800 px-2 py-1 rounded">사용자</span></td>
                                <td>2024-01-03</td>
                                <td>
                                    <button onclick="editUser('user')" class="tg-btn tg-btn-primary">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteUser('user')" class="tg-btn tg-btn-danger">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 피드백 게시판 페이지 -->
            <div id="feedbackPage" class="page" style="display: none;">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">피드백 게시판</h2>
                    <p class="text-gray-600">시스템 개선 의견을 나눕니다.</p>
                </div>

                <div class="flex gap-2 mb-4">
                    <button onclick="openAddFeedbackModal()" class="tg-btn tg-btn-success">
                        <i class="fas fa-plus"></i> 새 글 작성
                    </button>
                </div>

                <div class="overflow-x-auto">
                    <table class="tg-table">
                        <thead>
                            <tr>
                                <th>번호</th>
                                <th>제목</th>
                                <th>작성자</th>
                                <th>작성일</th>
                                <th>조회수</th>
                            </tr>
                        </thead>
                        <tbody id="feedbackTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- 대여 정보 수정 모달 -->
    <div id="editRentalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> 대여 정보 수정</h3>
                <button onclick="closeModal('editRentalModal')" class="text-white hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editRentalForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>관리번호</label>
                            <input type="text" id="editRentalCode" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>제품시리얼</label>
                            <input type="text" id="editRentalSerial" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>학교명</label>
                            <input type="text" id="editRentalSchool" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>학교급</label>
                            <select id="editRentalGrade" class="form-control" required>
                                <option value="">선택하세요</option>
                                <option value="초등학교">초등학교</option>
                                <option value="중학교">중학교</option>
                                <option value="고등학교">고등학교</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>학생명</label>
                            <input type="text" id="editRentalStudent" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>제품명</label>
                            <input type="text" id="editRentalProduct" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>상태</label>
                            <select id="editRentalStatus" class="form-control" required>
                                <option value="대여중">대여중</option>
                                <option value="미대여중">미대여중</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>메모1</label>
                            <input type="text" id="editRentalMemo1" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>메모2</label>
                            <input type="text" id="editRentalMemo2" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생생년월일</label>
                            <input type="date" id="editStudentBirth" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생연락처</label>
                            <input type="tel" id="editStudentPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>개인정보동의일자</label>
                            <input type="date" id="editPrivacyDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자명</label>
                            <input type="text" id="editGuardianName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>관계</label>
                            <input type="text" id="editRelation" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자연락처</label>
                            <input type="tel" id="editGuardianPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>기타사항</label>
                            <textarea id="editEtc" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-4 text-blue-600">
                            <i class="fas fa-tools"></i> 악세사리 관리
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label><i class="fas fa-plug"></i> 충전기</label>
                                <select id="editCharger" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-usb"></i> 충전케이블</label>
                                <select id="editChargeCable" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-ethernet"></i> USB 랜 젠더</label>
                                <select id="editUsbLan" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mouse"></i> 마우스</label>
                                <select id="editMouse" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-briefcase"></i> 가방</label>
                                <select id="editBag" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mobile-alt"></i> 케이스</label>
                                <select id="editCase" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal('editRentalModal')" class="tg-btn" style="background-color: #6b7280; color: white;">취소</button>
                        <button type="submit" class="tg-btn tg-btn-success">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 새 대여 추가 모달 -->
    <div id="addRentalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> 새 대여 추가</h3>
                <button onclick="closeModal('addRentalModal')" class="text-white hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addRentalForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>관리번호</label>
                            <input type="text" id="newRentalCode" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>제품시리얼</label>
                            <input type="text" id="newRentalSerial" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>학교명</label>
                            <input type="text" id="newRentalSchool" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>학교급</label>
                            <select id="newRentalGrade" class="form-control" required>
                                <option value="">선택하세요</option>
                                <option value="초등학교">초등학교</option>
                                <option value="중학교">중학교</option>
                                <option value="고등학교">고등학교</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>학생명</label>
                            <input type="text" id="newRentalStudent" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>제품명</label>
                            <input type="text" id="newRentalProduct" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>상태</label>
                            <select id="newRentalStatus" class="form-control" required>
                                <option value="대여중">대여중</option>
                                <option value="미대여중">미대여중</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>메모1</label>
                            <input type="text" id="newRentalMemo1" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>메모2</label>
                            <input type="text" id="newRentalMemo2" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생생년월일</label>
                            <input type="date" id="newStudentBirth" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생연락처</label>
                            <input type="tel" id="newStudentPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>개인정보동의일자</label>
                            <input type="date" id="newPrivacyDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자명</label>
                            <input type="text" id="newGuardianName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>관계</label>
                            <input type="text" id="newRelation" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자연락처</label>
                            <input type="tel" id="newGuardianPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>기타사항</label>
                            <textarea id="newEtc" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="text-lg font-semibold mb-4 text-blue-600">
                            <i class="fas fa-tools"></i> 악세사리 관리
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label><i class="fas fa-plug"></i> 충전기</label>
                                <select id="newCharger" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-usb"></i> 충전케이블</label>
                                <select id="newChargeCable" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-ethernet"></i> USB 랜 젠더</label>
                                <select id="newUsbLan" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mouse"></i> 마우스</label>
                                <select id="newMouse" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-briefcase"></i> 가방</label>
                                <select id="newBag" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mobile-alt"></i> 케이스</label>
                                <select id="newCase" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal('addRentalModal')" class="tg-btn" style="background-color: #6b7280; color: white;">취소</button>
                        <button type="submit" class="tg-btn tg-btn-success">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 제품 추가/수정 모달 -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle"><i class="fas fa-plus"></i> 제품 추가</h3>
                <button onclick="closeModal('productModal')" class="text-white hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>차수</label>
                            <select id="productPhase" class="form-control" required>
                                <option value="">선택하세요</option>
                                <option value="1차">1차</option>
                                <option value="2차">2차</option>
                                <option value="3차">3차</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>관리번호</label>
                            <input type="text" id="productCode" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>제품명</label>
                            <input type="text" id="productName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>시리얼</label>
                            <input type="text" id="productSerial" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal('productModal')" class="tg-btn" style="background-color: #6b7280; color: white;">취소</button>
                        <button type="submit" class="tg-btn tg-btn-success">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 사용자 추가/수정 모달 -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle"><i class="fas fa-user-plus"></i> 사용자 추가</h3>
                <button onclick="closeModal('userModal')" class="text-white hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group">
                        <label>사용자명</label>
                        <input type="text" id="userName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>비밀번호</label>
                        <input type="password" id="userPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>권한</label>
                        <select id="userRole" class="form-control" required>
                            <option value="">선택하세요</option>
                            <option value="최고관리자">최고관리자</option>
                            <option value="관리자">관리자</option>
                            <option value="사용자">사용자</option>
                        </select>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal('userModal')" class="tg-btn" style="background-color: #6b7280; color: white;">취소</button>
                        <button type="submit" class="tg-btn tg-btn-success">저장</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 피드백 작성 모달 -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> 새 글 작성</h3>
                <button onclick="closeModal('feedbackModal')" class="text-white hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="feedbackForm">
                    <div class="form-group">
                        <label>제목</label>
                        <input type="text" id="feedbackTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>내용</label>
                        <textarea id="feedbackContent" class="form-control" rows="10" required></textarea>
                    </div>
                    
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" onclick="closeModal('feedbackModal')" class="tg-btn" style="background-color: #6b7280; color: white;">취소</button>
                        <button type="submit" class="tg-btn tg-btn-success">등록</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 숨겨진 파일 입력 -->
    <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">

    <script>
        // Google Sheets API 설정
        const SHEETS_API_KEY = 'AIzaSyAktuKM0rhd6GJJsvJjaFlhAVCB3poklxY';
        const SPREADSHEET_ID = '1HnnVFEa8pNEdiaEE-7DmECqtq-hOUJI_8VB4y8ojLHg';
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxk0HH1pg3lwEfDaDiFdCBCAR87yF7oizg4gSZ-A7VqhQdXVvUuooNqlvEh6h6BUfs4Kg/exec';

        // 전역 변수
        let currentUser = null;
        let currentUserRole = null;
        let allRentals = [];
        let allProducts = [];
        let filteredRentals = [];
        let filteredProducts = [];
        let currentRentalPage = 1;
        let currentProductPage = 1;
        let itemsPerPage = 20;
        let editingRentalIndex = -1;
        let editingProductIndex = -1;

        // 사용자 데이터
        const users = {
            'admin': { password: 'admin123', role: '최고관리자' },
            'manager': { password: 'manager123', role: '관리자' },
            'user': { password: 'user123', role: '사용자' }
        };

        // 로그인 처리
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (users[username] && users[username].password === password) {
                currentUser = username;
                currentUserRole = users[username].role;
                document.getElementById('currentUser').textContent = `${username}님 환영합니다! (${currentUserRole})`;
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainSystem').style.display = 'block';
                
                showPage('rental');
                loadData();
            } else {
                alert('잘못된 사용자명 또는 비밀번호입니다.');
            }
        });

        // 로그아웃
        document.getElementById('logoutBtn').addEventListener('click', function() {
            currentUser = null;
            currentUserRole = null;
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainSystem').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        // 페이지 전환
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.style.display = 'none');
            document.getElementById(pageId + 'Page').style.display = 'block';
            
            if (pageId === 'rental') {
                loadRentals();
                updateStats();
            } else if (pageId === 'product') {
                loadProducts();
            } else if (pageId === 'feedback') {
                loadFeedback();
            }
        }

        // Google Sheets API 호출
        async function loadDataFromSheets(sheetName) {
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${sheetName}?key=${SHEETS_API_KEY}`);
                const data = await response.json();
                return data.values || [];
            } catch (error) {
                console.error('데이터 로딩 오류:', error);
                return [];
            }
        }

        // Apps Script로 데이터 저장
        async function saveDataToSheets(data, type) {
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: type,
                        ...data
                    })
                });
                const result = await response.json();
                return result.success;
            } catch (error) {
                console.error('데이터 저장 오류:', error);
                return false;
            }
        }

        // 데이터 로딩
        async function loadData() {
            try {
                // 제품 데이터 로딩
                const productData = await loadDataFromSheets('제품관리');
                if (productData.length > 1) {
                    allProducts = productData.slice(1).map((row, index) => ({
                        id: index,
                        차수: row[0] || '',
                        관리번호: row[1] || '',
                        제품명: row[2] || '',
                        시리얼: row[3] || '',
                        등록일: row[4] || new Date().toISOString().split('T')[0]
                    }));
                }

                // 대여 데이터 로딩
                const rentalData = await loadDataFromSheets('대여관리');
                if (rentalData.length > 1) {
                    allRentals = rentalData.slice(1).map((row, index) => ({
                        id: index,
                        순번: index + 1,
                        관리번호: row[1] || '',
                        제품시리얼: row[2] || '',
                        학교명: row[3] || '',
                        학교급: row[4] || '',
                        학생명: row[5] || '',
                        상태: row[6] || '대여중',
                        메모1: row[7] || '',
                        메모2: row[8] || '',
                        학생생년월일: row[9] || '',
                        학생연락처: row[10] || '',
                        개인정보동의일자: row[11] || '',
                        보호자명: row[12] || '',
                        관계: row[13] || '',
                        보호자연락처: row[14] || '',
                        기타사항: row[15] || '',
                        충전기상태: row[16] || '양호',
                        충전케이블상태: row[17] || '양호',
                        USB랜젠더상태: row[18] || '양호',
                        마우스상태: row[19] || '양호',
                        가방상태: row[20] || '양호',
                        케이스상태: row[21] || '양호',
                        등록일: row[22] || new Date().toISOString().split('T')[0]
                    }));
                }

                filteredRentals = [...allRentals];
                filteredProducts = [...allProducts];
                loadRentals();
                loadProducts();
                updateStats();
            } catch (error) {
                console.error('데이터 로딩 오류:', error);
            }
        }

        // 대여 관리 로딩
        function loadRentals() {
            const tbody = document.getElementById('rentalTableBody');
            tbody.innerHTML = '';

            const startIndex = (currentRentalPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageRentals = filteredRentals.slice(startIndex, endIndex);

            pageRentals.forEach((rental, index) => {
                const actualIndex = startIndex + index;
                const product = allProducts.find(p => p.시리얼 === rental.제품시리얼);
                const productName = product ? product.제품명 : rental.제품시리얼;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" value="${actualIndex}"></td>
                    <td>${rental.순번}</td>
                    <td><a href="#" onclick="openEditRentalModal(${actualIndex})" class="text-blue-600 hover:underline">${rental.관리번호}</a></td>
                    <td>${rental.제품시리얼}</td>
                    <td>${rental.학교명}</td>
                    <td>${rental.학교급}</td>
                    <td>${rental.학생명}</td>
                    <td>${productName}</td>
                    <td>
                        <select onchange="updateRentalStatus(${actualIndex}, this.value)" class="form-control">
                            <option value="대여중" ${rental.상태 === '대여중' ? 'selected' : ''}>대여중</option>
                            <option value="미대여중" ${rental.상태 === '미대여중' ? 'selected' : ''}>미대여중</option>
                        </select>
                    </td>
                    <td>${rental.메모1}</td>
                    <td>${rental.메모2}</td>
                    <td>
                        <button onclick="deleteRental(${actualIndex})" class="tg-btn tg-btn-danger">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateRentalPagination();
        }

        // 제품 관리 로딩
        function loadProducts() {
            const tbody = document.getElementById('productTableBody');
            tbody.innerHTML = '';

            const startIndex = (currentProductPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageProducts = filteredProducts.slice(startIndex, endIndex);

            pageProducts.forEach((product, index) => {
                const actualIndex = startIndex + index;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" value="${actualIndex}"></td>
                    <td>${product.차수}</td>
                    <td>${product.관리번호}</td>
                    <td>${product.제품명}</td>
                    <td>${product.시리얼}</td>
                    <td>
                        <button onclick="editProduct(${actualIndex})" class="tg-btn tg-btn-primary">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct(${actualIndex})" class="tg-btn tg-btn-danger">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateProductPagination();
        }

        // 통계 업데이트
        function updateStats() {
            const phase1Count = allProducts.filter(p => p.차수 === '1차').length;
            const phase2Count = allProducts.filter(p => p.차수 === '2차').length;
            const rentedCount = allRentals.filter(r => r.상태 === '대여중').length;
            const availableCount = allRentals.filter(r => r.상태 === '미대여중').length;

            document.getElementById('stat1차장비수').textContent = phase1Count;
            document.getElementById('stat2차장비수').textContent = phase2Count;
            document.getElementById('stat대여중').textContent = rentedCount;
            document.getElementById('stat미대여중').textContent = availableCount;
        }

        // 페이지네이션 업데이트
        function updateRentalPagination() {
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            document.getElementById('rentalCurrentPage').value = currentRentalPage;
            document.getElementById('rentalTotalPages').textContent = totalPages;
            document.getElementById('rentalPrevBtn').disabled = currentRentalPage <= 1;
            document.getElementById('rentalNextBtn').disabled = currentRentalPage >= totalPages;
        }

        function updateProductPagination() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            document.getElementById('productCurrentPage').value = currentProductPage;
            document.getElementById('productTotalPages').textContent = totalPages;
            document.getElementById('productPrevBtn').disabled = currentProductPage <= 1;
            document.getElementById('productNextBtn').disabled = currentProductPage >= totalPages;
        }

        // 페이지 변경
        function changeRentalPage(direction) {
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            currentRentalPage = Math.max(1, Math.min(totalPages, currentRentalPage + direction));
            loadRentals();
        }

        function changeProductPage(direction) {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            currentProductPage = Math.max(1, Math.min(totalPages, currentProductPage + direction));
            loadProducts();
        }

        function goToRentalPage(page) {
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            currentRentalPage = Math.max(1, Math.min(totalPages, parseInt(page)));
            loadRentals();
        }

        function goToProductPage(page) {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            currentProductPage = Math.max(1, Math.min(totalPages, parseInt(page)));
            loadProducts();
        }

        // 검색 기능
        function searchRentals() {
            const searchTerm = document.getElementById('rentalSearchInput').value.toLowerCase();
            const statusFilter = document.getElementById('rentalStatusFilter').value;
            const phaseFilter = document.getElementById('rentalPhaseFilter').value;
            const modelFilter = document.getElementById('rentalModelFilter').value;
            const dateStart = document.getElementById('rentalDateStart').value;
            const dateEnd = document.getElementById('rentalDateEnd').value;

            filteredRentals = allRentals.filter(rental => {
                const matchesSearch = !searchTerm || 
                    rental.관리번호.toLowerCase().includes(searchTerm) ||
                    rental.학교명.toLowerCase().includes(searchTerm) ||
                    rental.학생명.toLowerCase().includes(searchTerm) ||
                    rental.제품시리얼.toLowerCase().includes(searchTerm);

                const matchesStatus = !statusFilter || rental.상태 === statusFilter;

                const product = allProducts.find(p => p.시리얼 === rental.제품시리얼);
                const matchesPhase = !phaseFilter || (product && product.차수 === phaseFilter);
                const matchesModel = !modelFilter || (product && product.제품명 === modelFilter);

                const matchesDate = (!dateStart || rental.개인정보동의일자 >= dateStart) &&
                                   (!dateEnd || rental.개인정보동의일자 <= dateEnd);

                return matchesSearch && matchesStatus && matchesPhase && matchesModel && matchesDate;
            });

            currentRentalPage = 1;
            loadRentals();
        }

        function searchProducts() {
            const searchTerm = document.getElementById('productSearchInput').value.toLowerCase();
            
            filteredProducts = allProducts.filter(product => 
                product.차수.toLowerCase().includes(searchTerm) ||
                product.관리번호.toLowerCase().includes(searchTerm) ||
                product.제품명.toLowerCase().includes(searchTerm) ||
                product.시리얼.toLowerCase().includes(searchTerm)
            );

            currentProductPage = 1;
            loadProducts();
        }

        function resetRentalSearch() {
            document.getElementById('rentalSearchInput').value = '';
            document.getElementById('rentalStatusFilter').value = '';
            document.getElementById('rentalPhaseFilter').value = '';
            document.getElementById('rentalModelFilter').value = '';
            document.getElementById('rentalDateStart').value = '';
            document.getElementById('rentalDateEnd').value = '';
            
            filteredRentals = [...allRentals];
            currentRentalPage = 1;
            loadRentals();
        }

        function resetProductSearch() {
            document.getElementById('productSearchInput').value = '';
            filteredProducts = [...allProducts];
            currentProductPage = 1;
            loadProducts();
        }

        // 대여 상태 업데이트
        async function updateRentalStatus(index, newStatus) {
            allRentals[index].상태 = newStatus;
            filteredRentals = [...allRentals];
            
            // Google Sheets에 업데이트
            const rental = allRentals[index];
            await saveDataToSheets(rental, 'rental');
            
            loadRentals();
            updateStats();
        }

        // 모달 관련 함수
        function openAddRentalModal() {
            document.getElementById('addRentalModal').style.display = 'block';
            document.getElementById('addRentalForm').reset();
        }

        function openEditRentalModal(index) {
            editingRentalIndex = index;
            const rental = allRentals[index];
            
            document.getElementById('editRentalCode').value = rental.관리번호;
            document.getElementById('editRentalSerial').value = rental.제품시리얼;
            document.getElementById('editRentalSchool').value = rental.학교명;
            document.getElementById('editRentalGrade').value = rental.학교급;
            document.getElementById('editRentalStudent').value = rental.학생명;
            
            const product = allProducts.find(p => p.시리얼 === rental.제품시리얼);
            document.getElementById('editRentalProduct').value = product ? product.제품명 : '';
            
            document.getElementById('editRentalStatus').value = rental.상태;
            document.getElementById('editRentalMemo1').value = rental.메모1;
            document.getElementById('editRentalMemo2').value = rental.메모2;
            document.getElementById('editStudentBirth').value = rental.학생생년월일;
            document.getElementById('editStudentPhone').value = rental.학생연락처;
            document.getElementById('editPrivacyDate').value = rental.개인정보동의일자;
            document.getElementById('editGuardianName').value = rental.보호자명;
            document.getElementById('editRelation').value = rental.관계;
            document.getElementById('editGuardianPhone').value = rental.보호자연락처;
            document.getElementById('editEtc').value = rental.기타사항;
            
            // 악세사리 상태
            document.getElementById('editCharger').value = rental.충전기상태 || '양호';
            document.getElementById('editChargeCable').value = rental.충전케이블상태 || '양호';
            document.getElementById('editUsbLan').value = rental.USB랜젠더상태 || '양호';
            document.getElementById('editMouse').value = rental.마우스상태 || '양호';
            document.getElementById('editBag').value = rental.가방상태 || '양호';
            document.getElementById('editCase').value = rental.케이스상태 || '양호';
            
            document.getElementById('editRentalModal').style.display = 'block';
        }

        function openAddProductModal() {
            editingProductIndex = -1;
            document.getElementById('productModalTitle').innerHTML = '<i class="fas fa-plus"></i> 제품 추가';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').style.display = 'block';
        }

        function editProduct(index) {
            editingProductIndex = index;
            const product = allProducts[index];
            
            document.getElementById('productModalTitle').innerHTML = '<i class="fas fa-edit"></i> 제품 수정';
            document.getElementById('productPhase').value = product.차수;
            document.getElementById('productCode').value = product.관리번호;
            document.getElementById('productName').value = product.제품명;
            document.getElementById('productSerial').value = product.시리얼;
            
            document.getElementById('productModal').style.display = 'block';
        }

        function openAddUserModal() {
            document.getElementById('userModalTitle').innerHTML = '<i class="fas fa-user-plus"></i> 사용자 추가';
            document.getElementById('userForm').reset();
            document.getElementById('userModal').style.display = 'block';
        }

        function openAddFeedbackModal() {
            document.getElementById('feedbackForm').reset();
            document.getElementById('feedbackModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // 폼 제출 처리
        document.getElementById('addRentalForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const newRental = {
                순번: allRentals.length + 1,
                관리번호: document.getElementById('newRentalCode').value,
                제품시리얼: document.getElementById('newRentalSerial').value,
                학교명: document.getElementById('newRentalSchool').value,
                학교급: document.getElementById('newRentalGrade').value,
                학생명: document.getElementById('newRentalStudent').value,
                상태: document.getElementById('newRentalStatus').value,
                메모1: document.getElementById('newRentalMemo1').value,
                메모2: document.getElementById('newRentalMemo2').value,
                학생생년월일: document.getElementById('newStudentBirth').value,
                학생연락처: document.getElementById('newStudentPhone').value,
                개인정보동의일자: document.getElementById('newPrivacyDate').value,
                보호자명: document.getElementById('newGuardianName').value,
                관계: document.getElementById('newRelation').value,
                보호자연락처: document.getElementById('newGuardianPhone').value,
                기타사항: document.getElementById('newEtc').value,
                충전기상태: document.getElementById('newCharger').value,
                충전케이블상태: document.getElementById('newChargeCable').value,
                USB랜젠더상태: document.getElementById('newUsbLan').value,
                마우스상태: document.getElementById('newMouse').value,
                가방상태: document.getElementById('newBag').value,
                케이스상태: document.getElementById('newCase').value,
                등록일: new Date().toISOString().split('T')[0]
            };

            const success = await saveDataToSheets(newRental, 'rental');
            if (success) {
                allRentals.push(newRental);
                filteredRentals = [...allRentals];
                loadRentals();
                updateStats();
                closeModal('addRentalModal');
                alert('새 대여가 추가되었습니다.');
            } else {
                alert('저장 중 오류가 발생했습니다.');
            }
        });

        document.getElementById('editRentalForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (editingRentalIndex >= 0) {
                const updatedRental = {
                    ...allRentals[editingRentalIndex],
                    관리번호: document.getElementById('editRentalCode').value,
                    제품시리얼: document.getElementById('editRentalSerial').value,
                    학교명: document.getElementById('editRentalSchool').value,
                    학교급: document.getElementById('editRentalGrade').value,
                    학생명: document.getElementById('editRentalStudent').value,
                    상태: document.getElementById('editRentalStatus').value,
                    메모1: document.getElementById('editRentalMemo1').value,
                    메모2: document.getElementById('editRentalMemo2').value,
                    학생생년월일: document.getElementById('editStudentBirth').value,
                    학생연락처: document.getElementById('editStudentPhone').value,
                    개인정보동의일자: document.getElementById('editPrivacyDate').value,
                    보호자명: document.getElementById('editGuardianName').value,
                    관계: document.getElementById('editRelation').value,
                    보호자연락처: document.getElementById('editGuardianPhone').value,
                    기타사항: document.getElementById('editEtc').value,
                    충전기상태: document.getElementById('editCharger').value,
                    충전케이블상태: document.getElementById('editChargeCable').value,
                    USB랜젠더상태: document.getElementById('editUsbLan').value,
                    마우스상태: document.getElementById('editMouse').value,
                    가방상태: document.getElementById('editBag').value,
                    케이스상태: document.getElementById('editCase').value
                };

                const success = await saveDataToSheets(updatedRental, 'rental');
                if (success) {
                    allRentals[editingRentalIndex] = updatedRental;
                    filteredRentals = [...allRentals];
                    loadRentals();
                    updateStats();
                    closeModal('editRentalModal');
                    alert('대여 정보가 수정되었습니다.');
                } else {
                    alert('저장 중 오류가 발생했습니다.');
                }
            }
        });

        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const productData = {
                차수: document.getElementById('productPhase').value,
                관리번호: document.getElementById('productCode').value,
                제품명: document.getElementById('productName').value,
                시리얼: document.getElementById('productSerial').value,
                등록일: new Date().toISOString().split('T')[0]
            };

            if (editingProductIndex >= 0) {
                const success = await saveDataToSheets(productData, 'product');
                if (success) {
                    allProducts[editingProductIndex] = productData;
                    filteredProducts = [...allProducts];
                    loadProducts();
                    closeModal('productModal');
                    alert('제품이 수정되었습니다.');
                } else {
                    alert('저장 중 오류가 발생했습니다.');
                }
            } else {
                const success = await saveDataToSheets(productData, 'product');
                if (success) {
                    allProducts.push(productData);
                    filteredProducts = [...allProducts];
                    loadProducts();
                    closeModal('productModal');
                    alert('제품이 추가되었습니다.');
                } else {
                    alert('저장 중 오류가 발생했습니다.');
                }
            }
        });

        // 삭제 기능
        function deleteRental(index) {
            if (confirm('정말 삭제하시겠습니까?')) {
                allRentals.splice(index, 1);
                filteredRentals = [...allRentals];
                loadRentals();
                updateStats();
            }
        }

        function deleteProduct(index) {
            if (confirm('정말 삭제하시겠습니까?')) {
                allProducts.splice(index, 1);
                filteredProducts = [...allProducts];
                loadProducts();
            }
        }

        function deleteSelectedRentals() {
            const checkboxes = document.querySelectorAll('#rentalTableBody input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('삭제할 항목을 선택해주세요.');
                return;
            }
            
            if (confirm(`선택한 ${checkboxes.length}개 항목을 삭제하시겠습니까?`)) {
                const indices = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
                indices.forEach(index => allRentals.splice(index, 1));
                filteredRentals = [...allRentals];
                loadRentals();
                updateStats();
            }
        }

        function deleteSelectedProducts() {
            const checkboxes = document.querySelectorAll('#productTableBody input[type="checkbox"]:checked');
            if (checkboxes.length === 0) {
                alert('삭제할 항목을 선택해주세요.');
                return;
            }
            
            if (confirm(`선택한 ${checkboxes.length}개 항목을 삭제하시겠습니까?`)) {
                const indices = Array.from(checkboxes).map(cb => parseInt(cb.value)).sort((a, b) => b - a);
                indices.forEach(index => allProducts.splice(index, 1));
                filteredProducts = [...allProducts];
                loadProducts();
            }
        }

        // Excel 다운로드
        function downloadRentalSample() {
            const headers = [
                '순번', '관리번호', '제품시리얼', '학교명', '학교급', '학생명', '상태', '메모1', '메모2',
                '학생생년월일', '학생연락처', '개인정보동의일자', '보호자명', '관계', '보호자연락처', '기타사항',
                '충전기상태', '충전케이블상태', 'USB랜젠더상태', '마우스상태', '가방상태', '케이스상태'
            ];
            
            const sampleData = [
                [1, '2025-NEW1', 'UPLOADED001', '성산초등학교', '초', '김학생', '대여중', '성산초 본교', '', '2015-03-01', '010-1234-5678', '2025-01-01', '김부모', '부', '010-9876-5432', ''],
                [2, '2025-NEW2', 'UPLOADED002', '세화초등학교', '초', '이학생', '대여중', 'HDMI 케이블 추가', '파일 정리', '2015-05-15', '010-2345-6789', '2025-01-02', '이부모', '모', '010-8765-4321', ''],
                [3, '2025-NEW3', 'UPLOADED003', '한림초등학교', '초', '박학생', '대여중', '케이스 추가', '', '2015-08-20', '010-3456-7890', '2025-01-03', '박부모', '부', '010-7654-3210', '']
            ];

            const ws = XLSX.utils.aoa_to_sheet([headers, ...sampleData]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '대여관리');
            XLSX.writeFile(wb, '대여관리_업로드샘플.xlsx');
        }

        function downloadProductSample() {
            const headers = ['차수', '관리번호', '제품명', '시리얼'];
            const sampleData = [
                ['1차', '2025-UPLOAD1', '삼성노트북A', 'UPLOADED001'],
                ['1차', '2025-UPLOAD2', '삼성노트북A', 'UPLOADED002'],
                ['2차', '2025-UPLOAD3', '삼성태블릿B', 'UPLOADED003']
            ];

            const ws = XLSX.utils.aoa_to_sheet([headers, ...sampleData]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '제품관리');
            XLSX.writeFile(wb, '제품관리_업로드샘플.xlsx');
        }

        // Excel 업로드
        function uploadRentalExcel() {
            document.getElementById('fileInput').onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                        
                        if (jsonData.length < 2) {
                            alert('올바른 형식의 파일이 아닙니다.');
                            return;
                        }

                        const headers = jsonData[0];
                        const rows = jsonData.slice(1);

                        rows.forEach(async (row) => {
                            if (row.length > 0 && row[1]) { // 관리번호가 있는 경우만
                                const newRental = {
                                    순번: allRentals.length + 1,
                                    관리번호: row[1] || '',
                                    제품시리얼: row[2] || '',
                                    학교명: row[3] || '',
                                    학교급: row[4] || '',
                                    학생명: row[5] || '',
                                    상태: '대여중', // 항상 대여중으로 설정
                                    메모1: row[7] || '',
                                    메모2: row[8] || '',
                                    학생생년월일: row[9] || '',
                                    학생연락처: row[10] || '',
                                    개인정보동의일자: row[11] || '',
                                    보호자명: row[12] || '',
                                    관계: row[13] || '',
                                    보호자연락처: row[14] || '',
                                    기타사항: row[15] || '',
                                    충전기상태: row[16] || '양호',
                                    충전케이블상태: row[17] || '양호',
                                    USB랜젠더상태: row[18] || '양호',
                                    마우스상태: row[19] || '양호',
                                    가방상태: row[20] || '양호',
                                    케이스상태: row[21] || '양호',
                                    등록일: new Date().toISOString().split('T')[0]
                                };

                                await saveDataToSheets(newRental, 'rental');
                                allRentals.push(newRental);
                            }
                        });

                        filteredRentals = [...allRentals];
                        loadRentals();
                        updateStats();
                        alert('대여 데이터가 업로드되었습니다.');
                    } catch (error) {
                        console.error('파일 처리 오류:', error);
                        alert('파일 처리 중 오류가 발생했습니다.');
                    }
                };
                reader.readAsArrayBuffer(file);
            };
            document.getElementById('fileInput').click();
        }

        function uploadProductExcel() {
            document.getElementById('fileInput').onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                        
                        if (jsonData.length < 2) {
                            alert('올바른 형식의 파일이 아닙니다.');
                            return;
                        }

                        const headers = jsonData[0];
                        const rows = jsonData.slice(1);

                        rows.forEach(async (row) => {
                            if (row.length > 0 && row[1]) { // 관리번호가 있는 경우만
                                const newProduct = {
                                    차수: row[0] || '',
                                    관리번호: row[1] || '',
                                    제품명: row[2] || '',
                                    시리얼: row[3] || '',
                                    등록일: new Date().toISOString().split('T')[0]
                                };

                                await saveDataToSheets(newProduct, 'product');
                                allProducts.push(newProduct);
                            }
                        });

                        filteredProducts = [...allProducts];
                        loadProducts();
                        alert('제품 데이터가 업로드되었습니다.');
                    } catch (error) {
                        console.error('파일 처리 오류:', error);
                        alert('파일 처리 중 오류가 발생했습니다.');
                    }
                };
                reader.readAsArrayBuffer(file);
            };
            document.getElementById('fileInput').click();
        }

        // 피드백 관리
        function loadFeedback() {
            const tbody = document.getElementById('feedbackTableBody');
            tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500">피드백이 없습니다.</td></tr>';
        }

        // 사용자 관리
        function editUser(username) {
            alert(`${username} 사용자 편집 기능`);
        }

        function deleteUser(username) {
            if (confirm(`${username} 사용자를 삭제하시겠습니까?`)) {
                alert(`${username} 사용자가 삭제되었습니다.`);
            }
        }

        // 전체 선택 기능
        document.getElementById('selectAllRentals').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#rentalTableBody input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });

        document.getElementById('selectAllProducts').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('#productTableBody input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });

        // 모바일 메뉴 토글
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('open');
        });

        // 모달 드래그 기능
        let isDragging = false;
        let currentModal = null;
        let startX, startY, startLeft, startTop;

        document.querySelectorAll('.modal-header').forEach(header => {
            header.addEventListener('mousedown', function(e) {
                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'I') return;
                
                isDragging = true;
                currentModal = this.closest('.modal-content');
                
                startX = e.clientX;
                startY = e.clientY;
                startLeft = parseInt(window.getComputedStyle(currentModal).left) || 0;
                startTop = parseInt(window.getComputedStyle(currentModal).top) || 0;
                
                e.preventDefault();
            });
        });

        document.addEventListener('mousemove', function(e) {
            if (!isDragging || !currentModal) return;
            
            const deltaX = e.clientX - startX;
            const deltaY = e.clientY - startY;
            
            currentModal.style.left = (startLeft + deltaX) + 'px';
            currentModal.style.top = (startTop + deltaY) + 'px';
            currentModal.style.margin = '0';
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
            currentModal = null;
        });

        // 모달 외부 클릭으로 닫기 (드래그 중이 아닐 때만)
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this && !isDragging) {
                    this.style.display = 'none';
                }
            });
        });

        // 초기 데이터 로딩
        window.addEventListener('load', function() {
            // 페이지 로드 시 자동으로 데이터 로딩하지 않음 (로그인 후에만)
        });
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"95491f39ba95686d","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDguFFv0HXvqp57tnbm69viGpiZaSWmR1BFumio6fe90wkf%2FBKlUC08lyr%2FHfPb5IMunhDlSohsjBf%2FHVUt%2Fwp%2FfD%2Bqb3alvDrQ6GmyV4KTPRQmYxWCXeR%2FBfKYQcmACm4p%2BZM6vjMS1p2NPadVn7JwKyhto29fUr6cTrGlnMektF7e2NInV%2FMcF8wW8IGSjQsF%2FQplllFHx%2F46WvlCEYFOayvFOQj8GCaUsOhgJxJxHsYEy0T6P5OTJsjefk7%2FSlnth1iVCyFDcSDA6ssnC2BzYFH1p5Z6%2FNx%2FuGuVE6wBDupcIRRRqK8h827dY2p6XpSbxSWa070nFqv6OMi2qHHm%2FObij44kgn%2FkL8sGC79bVZOYaexF6BIyfBrJUkI7LE5wgGBDmJTWMNeEddNfRSyws9QXoADGzL1KWqWY8qqbp%2BGJtQyplkXZ%2F8NlfQHDFPu18tSItzM2gBg3N28x2HbcXGU1dzmz542wCAKc1GSwke2Skgz2uLuqDvIrIyR50p9Ly2i1oivYBaSUU%2BKfOvJOQ%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDguFFv0HXvqp57tnbm69viGpiZaSWmR1BFumio6fe90wkf/BKlUC08lyr/HfPb5IMunhDlSohsjBf/HVUt/wp/fD+qb3alvDrQ6GmyV4KTPRQmYxWCXeR/BfKYQcmACm4p+ZM6vjMS1p2NPadVn7JwKyhto29fUr6cTrGlnMektF7e2NInV/McF8wW8IGSjQsF/QplllFHx/46WvlCEYFOayvFOQj8GCaUsOhgJxJxHsYEy0T6P5OTJsjefk7/Slnth1iVCyFDcSDA6ssnC2BzYFH1p5Z6/Nx/uGuVE6wBDupcIRRRqK8h827dY2p6XpSbxSWa070nFqv6OMi2qHHm/Obij44kgn/kL8sGC79bVZOYaexF6BIyfBrJUkI7LE5wgGBDmJTWMNeEddNfRSyws9QXoADGzL1KWqWY8qqbp+GJtQyplkXZ/8NlfQHDFPu18tSItzM2gBg3N28x2HbcXGU1dzmz542wCAKc1GSwke2Skgz2uLuqDvIrIyR50p9Ly2i1oivYBaSUU+KfOvJOQ=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
