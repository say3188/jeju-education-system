<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제주교육청 스마트단말 관리 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4a5568;
            --secondary-color: #718096;
            --accent-color: #3182ce;
            --success-color: #38a169;
            --warning-color: #d69e2e;
            --danger-color: #e53e3e;
            --light-gray: #f7fafc;
            --dark-gray: #2d3748;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--light-gray);
        }

        .header {
            background: linear-gradient(135deg, var(--dark-gray) 0%, var(--primary-color) 100%);
            color: white;
        }

        .sidebar {
            background: linear-gradient(180deg, #e2e8f0 0%, #cbd5e0 100%);
            border-right: 2px solid #a0aec0;
        }

        .main-content {
            background: white;
            min-height: calc(100vh - 64px);
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: #2c5aa0;
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-success:hover {
            background: #2f855a;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-1px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            background: var(--primary-color);
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
            cursor: move;
        }

        .modal-body {
            padding: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        .dashboard-card {
            background: linear-gradient(135deg, var(--accent-color) 0%, #2c5aa0 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .dashboard-card.success {
            background: linear-gradient(135deg, var(--success-color) 0%, #2f855a 100%);
        }

        .dashboard-card.warning {
            background: linear-gradient(135deg, var(--warning-color) 0%, #b7791f 100%);
        }

        .dashboard-card.danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #c53030 100%);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: var(--primary-color);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 500;
            font-size: 14px;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }

        tr:hover {
            background: #f8fafc;
        }

        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: var(--accent-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }

        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .pagination button:hover {
            background: #f3f4f6;
        }

        .pagination button:disabled {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .accessories-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 6px;
        }

        .accessories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-rental {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-available {
            background: #dcfce7;
            color: #16a34a;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 2% auto;
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="logo">
                <i class="fas fa-laptop"></i>
            </div>
            <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">제주교육청 스마트단말 관리 시스템</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label>사용자명</label>
                    <input type="text" id="username" class="form-control" placeholder="사용자명을 입력하세요">
                </div>
                <div class="form-group">
                    <label>비밀번호</label>
                    <input type="password" id="password" class="form-control" placeholder="비밀번호를 입력하세요">
                </div>
                <button type="submit" class="btn-primary w-full py-3 text-lg">로그인</button>
            </form>
            <div class="text-center mt-6 text-sm text-gray-600">
                <p>콜센터 번호: 1811-8290</p>
            </div>
        </div>
    </div>

    <!-- Main System -->
    <div id="mainSystem" class="hidden">
        <!-- Header -->
        <div class="header px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <i class="fas fa-laptop text-2xl"></i>
                <h1 class="text-xl font-bold">제주교육청 스마트단말 관리 시스템</h1>
            </div>
            <div class="flex items-center gap-4">
                <span id="currentUser" class="text-sm"></span>
                <button id="logoutBtn" class="btn-danger">로그아웃</button>
            </div>
        </div>

        <div class="flex">
            <!-- Sidebar -->
            <div class="sidebar w-64 min-h-screen p-4">
                <nav class="space-y-2">
                    <a href="#" class="menu-item flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm transition-all" data-page="rental">
                        <i class="fas fa-clipboard-list text-blue-600"></i>
                        <span class="font-medium">대여 관리</span>
                    </a>
                    <a href="#" class="menu-item flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm transition-all" data-page="products">
                        <i class="fas fa-box text-green-600"></i>
                        <span class="font-medium">제품 관리</span>
                    </a>
                    <a href="#" class="menu-item flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm transition-all admin-only" data-page="users">
                        <i class="fas fa-users text-purple-600"></i>
                        <span class="font-medium">사용자 관리</span>
                    </a>
                    <a href="#" class="menu-item flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm transition-all" data-page="feedback">
                        <i class="fas fa-comments text-orange-600"></i>
                        <span class="font-medium">피드백 게시판</span>
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="main-content flex-1 p-6">
                <!-- Rental Management Page -->
                <div id="rentalPage" class="page">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-4">대여 관리</h2>
                        <p class="text-gray-600">스마트단말 대여 현황을 관리합니다.</p>
                    </div>

                    <!-- Dashboard Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="dashboard-card">
                            <h3 class="text-sm font-medium opacity-90">1차 장비 수</h3>
                            <p class="text-3xl font-bold" id="phase1Count">0</p>
                            <i class="fas fa-laptop text-2xl opacity-50 float-right mt-2"></i>
                        </div>
                        <div class="dashboard-card success">
                            <h3 class="text-sm font-medium opacity-90">2차 장비 수</h3>
                            <p class="text-3xl font-bold" id="phase2Count">0</p>
                            <i class="fas fa-tablet text-2xl opacity-50 float-right mt-2"></i>
                        </div>
                        <div class="dashboard-card warning">
                            <h3 class="text-sm font-medium opacity-90">대여중</h3>
                            <p class="text-3xl font-bold" id="rentalCount">0</p>
                            <i class="fas fa-hand-holding text-2xl opacity-50 float-right mt-2"></i>
                        </div>
                        <div class="dashboard-card danger">
                            <h3 class="text-sm font-medium opacity-90">미 대여중</h3>
                            <p class="text-3xl font-bold" id="availableCount">0</p>
                            <i class="fas fa-exclamation-triangle text-2xl opacity-50 float-right mt-2"></i>
                        </div>
                    </div>

                    <!-- Search and Filters -->
                    <div class="card p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">통합 검색</label>
                                <input type="text" id="rentalSearch" class="form-control" placeholder="관리번호, 학교명, 학생명, 제품명...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">상태 선택</label>
                                <select id="statusFilter" class="form-control">
                                    <option value="">전체 상태</option>
                                    <option value="대여중">대여중</option>
                                    <option value="미 대여중">미 대여중</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">차수 선택</label>
                                <select id="phaseFilter" class="form-control">
                                    <option value="">전체 차수</option>
                                    <option value="1차">1차</option>
                                    <option value="2차">2차</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">모델 선택</label>
                                <select id="modelFilter" class="form-control">
                                    <option value="">전체 모델</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">개인정보동의일자 시작</label>
                                <input type="date" id="dateStart" class="form-control">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">개인정보동의일자 종료</label>
                                <input type="date" id="dateEnd" class="form-control">
                            </div>
                        </div>
                        <div class="flex gap-2 mt-4">
                            <button id="searchBtn" class="btn-primary">
                                <i class="fas fa-search mr-2"></i>검색
                            </button>
                            <button id="resetBtn" class="btn-success">
                                <i class="fas fa-refresh mr-2"></i>초기화
                            </button>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button id="addRentalBtn" class="btn-success">
                            <i class="fas fa-plus mr-2"></i>새 대여 추가
                        </button>
                        <button id="downloadRentalSampleBtn" class="btn-primary">
                            <i class="fas fa-download mr-2"></i>Excel 샘플
                        </button>
                        <button id="uploadRentalBtn" class="btn-primary">
                            <i class="fas fa-upload mr-2"></i>Excel 업로드
                        </button>
                        <button id="deleteAllRentalBtn" class="btn-danger admin-only">
                            <i class="fas fa-trash mr-2"></i>전체 삭제
                        </button>
                    </div>

                    <!-- Rental Table -->
                    <div class="table-container">
                        <table id="rentalTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllRental"></th>
                                    <th>순번</th>
                                    <th>관리번호</th>
                                    <th>제품시리얼</th>
                                    <th>학교명</th>
                                    <th>학교급</th>
                                    <th>학생명</th>
                                    <th>제품명</th>
                                    <th>상태</th>
                                    <th>메모1</th>
                                    <th>메모2</th>
                                    <th>기타</th>
                                </tr>
                            </thead>
                            <tbody id="rentalTableBody">
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination" id="rentalPagination">
                        <button id="prevPageRental">이전</button>
                        <input type="number" id="currentPageRental" min="1" value="1" style="width: 60px; text-align: center;">
                        <span>/ <span id="totalPagesRental">1</span></span>
                        <button id="nextPageRental">다음</button>
                    </div>
                </div>

                <!-- Products Management Page -->
                <div id="productsPage" class="page hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-4">제품 관리</h2>
                        <p class="text-gray-600">제품 데이터를 관리합니다.</p>
                    </div>

                    <!-- Search -->
                    <div class="flex gap-4 mb-4">
                        <input type="text" id="productSearch" class="form-control flex-1" placeholder="차수, 관리번호, 제품명, 시리얼 검색...">
                        <button id="searchProductBtn" class="btn-primary">
                            <i class="fas fa-search mr-2"></i>검색
                        </button>
                        <button id="resetProductBtn" class="btn-success">
                            <i class="fas fa-refresh mr-2"></i>초기화
                        </button>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <button id="addProductBtn" class="btn-success admin-only">
                            <i class="fas fa-plus mr-2"></i>제품 추가
                        </button>
                        <button id="downloadProductSampleBtn" class="btn-primary admin-only">
                            <i class="fas fa-download mr-2"></i>Excel 샘플
                        </button>
                        <button id="uploadProductBtn" class="btn-primary admin-only">
                            <i class="fas fa-upload mr-2"></i>Excel 업로드
                        </button>
                        <button id="deleteAllProductBtn" class="btn-danger admin-only">
                            <i class="fas fa-trash mr-2"></i>전체 삭제
                        </button>
                    </div>

                    <!-- Products Table -->
                    <div class="table-container">
                        <table id="productTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllProduct"></th>
                                    <th>차수</th>
                                    <th>관리번호</th>
                                    <th>제품명</th>
                                    <th>시리얼</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="productTableBody">
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination" id="productPagination">
                        <button id="prevPageProduct">이전</button>
                        <input type="number" id="currentPageProduct" min="1" value="1" style="width: 60px; text-align: center;">
                        <span>/ <span id="totalPagesProduct">1</span></span>
                        <button id="nextPageProduct">다음</button>
                    </div>
                </div>

                <!-- Users Management Page -->
                <div id="usersPage" class="page hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-4">사용자 관리</h2>
                        <p class="text-gray-600">시스템 사용자를 관리합니다.</p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-2 mb-4">
                        <button id="addUserBtn" class="btn-success">
                            <i class="fas fa-plus mr-2"></i>사용자 추가
                        </button>
                    </div>

                    <!-- Users Table -->
                    <div class="table-container">
                        <table id="userTable">
                            <thead>
                                <tr>
                                    <th>사용자명</th>
                                    <th>권한</th>
                                    <th>생성일</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Feedback Board Page -->
                <div id="feedbackPage" class="page hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-4">피드백 게시판</h2>
                        <p class="text-gray-600">시스템 개선을 위한 의견을 공유합니다.</p>
                    </div>

                    <!-- Search -->
                    <div class="flex gap-4 mb-4">
                        <input type="text" id="feedbackSearch" class="form-control flex-1" placeholder="제목, 내용으로 검색...">
                        <button id="searchFeedbackBtn" class="btn-primary">
                            <i class="fas fa-search mr-2"></i>검색
                        </button>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-2 mb-4">
                        <button id="addFeedbackBtn" class="btn-success">
                            <i class="fas fa-plus mr-2"></i>새 글 작성
                        </button>
                    </div>

                    <!-- Feedback Table -->
                    <div class="table-container">
                        <table id="feedbackTable">
                            <thead>
                                <tr>
                                    <th>번호</th>
                                    <th>제목</th>
                                    <th>작성자</th>
                                    <th>작성일</th>
                                    <th>조회수</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="feedbackTableBody">
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination" id="feedbackPagination">
                        <button id="prevPageFeedback">이전</button>
                        <input type="number" id="currentPageFeedback" min="1" value="1" style="width: 60px; text-align: center;">
                        <span>/ <span id="totalPagesFeedback">1</span></span>
                        <button id="nextPageFeedback">다음</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rental Detail Modal -->
    <div id="rentalDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>대여 정보 수정</h3>
                <button class="close" style="float: right; background: none; border: none; color: white; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="rentalDetailForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>관리번호</label>
                            <input type="text" id="editManagementNumber" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>제품시리얼</label>
                            <input type="text" id="editProductSerial" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학교명</label>
                            <input type="text" id="editSchoolName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학교급</label>
                            <select id="editSchoolLevel" class="form-control">
                                <option value="초등학교">초등학교</option>
                                <option value="중학교">중학교</option>
                                <option value="고등학교">고등학교</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>학생명</label>
                            <input type="text" id="editStudentName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>제품명</label>
                            <input type="text" id="editProductName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>상태</label>
                            <select id="editStatus" class="form-control">
                                <option value="대여중">대여중</option>
                                <option value="미 대여중">미 대여중</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>메모1</label>
                            <input type="text" id="editMemo1" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>메모2</label>
                            <input type="text" id="editMemo2" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생생년월일</label>
                            <input type="date" id="editStudentBirth" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생연락처</label>
                            <input type="text" id="editStudentPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>개인정보동의일자</label>
                            <input type="date" id="editPrivacyDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자명</label>
                            <input type="text" id="editGuardianName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>관계</label>
                            <input type="text" id="editRelationship" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자연락처</label>
                            <input type="text" id="editGuardianPhone" class="form-control">
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>기타사항</label>
                            <textarea id="editOtherNotes" class="form-control" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Accessories Section -->
                    <div class="accessories-section">
                        <h4 class="font-medium mb-3"><i class="fas fa-tools mr-2"></i>악세사리 관리</h4>
                        <div class="accessories-grid">
                            <div class="form-group">
                                <label><i class="fas fa-plug mr-1"></i>충전기</label>
                                <select id="editChargerStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-cable mr-1"></i>충전케이블</label>
                                <select id="editCableStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-ethernet mr-1"></i>USB 랜 젠더</label>
                                <select id="editUsbStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mouse mr-1"></i>마우스</label>
                                <select id="editMouseStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-bag mr-1"></i>가방</label>
                                <select id="editBagStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mobile-alt mr-1"></i>케이스</label>
                                <select id="editCaseStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 mt-6">
                        <button type="button" class="btn-success" onclick="saveRentalChanges()">저장</button>
                        <button type="button" class="btn-danger" onclick="closeModal('rentalDetailModal')">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Rental Modal -->
    <div id="addRentalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>새 대여 추가</h3>
                <button class="close" style="float: right; background: none; border: none; color: white; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addRentalForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>관리번호</label>
                            <input type="text" id="newManagementNumber" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>제품시리얼</label>
                            <input type="text" id="newProductSerial" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>학교명</label>
                            <input type="text" id="newSchoolName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>학교급</label>
                            <select id="newSchoolLevel" class="form-control" required>
                                <option value="">선택하세요</option>
                                <option value="초등학교">초등학교</option>
                                <option value="중학교">중학교</option>
                                <option value="고등학교">고등학교</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>학생명</label>
                            <input type="text" id="newStudentName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>제품명</label>
                            <input type="text" id="newProductName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>메모1</label>
                            <input type="text" id="newMemo1" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>메모2</label>
                            <input type="text" id="newMemo2" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생생년월일</label>
                            <input type="date" id="newStudentBirth" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>학생연락처</label>
                            <input type="text" id="newStudentPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>개인정보동의일자</label>
                            <input type="date" id="newPrivacyDate" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자명</label>
                            <input type="text" id="newGuardianName" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>관계</label>
                            <input type="text" id="newRelationship" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>보호자연락처</label>
                            <input type="text" id="newGuardianPhone" class="form-control">
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>기타사항</label>
                            <textarea id="newOtherNotes" class="form-control" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Accessories Section -->
                    <div class="accessories-section">
                        <h4 class="font-medium mb-3"><i class="fas fa-tools mr-2"></i>악세사리 관리</h4>
                        <div class="accessories-grid">
                            <div class="form-group">
                                <label><i class="fas fa-plug mr-1"></i>충전기</label>
                                <select id="newChargerStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-cable mr-1"></i>충전케이블</label>
                                <select id="newCableStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-ethernet mr-1"></i>USB 랜 젠더</label>
                                <select id="newUsbStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mouse mr-1"></i>마우스</label>
                                <select id="newMouseStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-bag mr-1"></i>가방</label>
                                <select id="newBagStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-mobile-alt mr-1"></i>케이스</label>
                                <select id="newCaseStatus" class="form-control">
                                    <option value="양호">양호</option>
                                    <option value="훼손">훼손</option>
                                    <option value="완파">완파</option>
                                    <option value="분실">분실</option>
                                    <option value="초기미포함">초기미포함</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2 mt-6">
                        <button type="submit" class="btn-success">저장</button>
                        <button type="button" class="btn-danger" onclick="closeModal('addRentalModal')">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Other Modals -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>제품 추가</h3>
                <button class="close" style="float: right; background: none; border: none; color: white; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addProductForm">
                    <div class="form-group">
                        <label>차수</label>
                        <select id="newPhase" class="form-control" required>
                            <option value="">선택하세요</option>
                            <option value="1차">1차</option>
                            <option value="2차">2차</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>관리번호</label>
                        <input type="text" id="newProductManagementNumber" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>제품명</label>
                        <input type="text" id="newProductNameAdd" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>시리얼</label>
                        <input type="text" id="newProductSerialAdd" class="form-control" required>
                    </div>
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="submit" class="btn-success">저장</button>
                        <button type="button" class="btn-danger" onclick="closeModal('addProductModal')">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>사용자 추가</h3>
                <button class="close" style="float: right; background: none; border: none; color: white; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label>사용자명</label>
                        <input type="text" id="newUsername" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>비밀번호</label>
                        <input type="password" id="newUserPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>권한</label>
                        <select id="newUserRole" class="form-control" required>
                            <option value="">선택하세요</option>
                            <option value="최고관리자">최고관리자</option>
                            <option value="관리자">관리자</option>
                            <option value="사용자">사용자</option>
                        </select>
                    </div>
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="submit" class="btn-success">저장</button>
                        <button type="button" class="btn-danger" onclick="closeModal('addUserModal')">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="addFeedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>새 글 작성</h3>
                <button class="close" style="float: right; background: none; border: none; color: white; font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addFeedbackForm">
                    <div class="form-group">
                        <label>제목</label>
                        <input type="text" id="newFeedbackTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>내용</label>
                        <textarea id="newFeedbackContent" class="form-control" rows="10" required></textarea>
                    </div>
                    <div class="flex justify-end gap-2 mt-6">
                        <button type="submit" class="btn-success">저장</button>
                        <button type="button" class="btn-danger" onclick="closeModal('addFeedbackModal')">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- File Upload Input -->
    <input type="file" id="fileUpload" accept=".xlsx,.xls" style="display: none;">

    <script>
        // Google Sheets API Configuration
        const SHEETS_API_KEY = 'AIzaSyAktuKM0rhd6GJJsvJjaFlhAVCB3poklxY';
        const SPREADSHEET_ID = '1HnnVFEa8pNEdiaEE-7DmECqtq-hOUJI_8VB4y8ojLHg';

        // Sheet Names
        const SHEETS = {
            PRODUCTS: '제품관리',
            RENTALS: '대여관리',
            USERS: '사용자관리',
            FEEDBACK: '피드백'
        };

        // Global Variables
        let currentUser = null;
        let currentUserRole = null;
        let allRentals = [];
        let allProducts = [];
        let allUsers = [];
        let allFeedback = [];
        let filteredRentals = [];
        let filteredProducts = [];
        let currentRentalPage = 1;
        let currentProductPage = 1;
        let currentFeedbackPage = 1;
        const itemsPerPage = 20;

        // Initialize Google Sheets API
        function initGoogleSheetsAPI() {
            gapi.load('client', async () => {
                await gapi.client.init({
                    apiKey: SHEETS_API_KEY,
                    discoveryDocs: ['https://sheets.googleapis.com/$discovery/rest?version=v4']
                });
                console.log('Google Sheets API initialized');
            });
        }

        // Google Sheets API Functions
        async function readSheet(sheetName, range = 'A:Z') {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${sheetName}!${range}`
                });
                return response.result.values || [];
            } catch (error) {
                console.error('Error reading sheet:', error);
                return [];
            }
        }

        async function writeSheet(sheetName, values, range = 'A1') {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.update({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${sheetName}!${range}`,
                    valueInputOption: 'RAW',
                    resource: {
                        values: values
                    }
                });
                return response.result;
            } catch (error) {
                console.error('Error writing sheet:', error);
                return null;
            }
        }

        async function appendSheet(sheetName, values) {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${sheetName}!A1`,
                    valueInputOption: 'RAW',
                    insertDataOption: 'INSERT_ROWS',
                    resource: {
                        values: values
                    }
                });
                return response.result;
            } catch (error) {
                console.error('Error appending to sheet:', error);
                return null;
            }
        }

        // Authentication Functions
        function login(username, password) {
            const users = {
                'admin': { password: 'admin123', role: '최고관리자' },
                'manager': { password: 'manager123', role: '관리자' },
                'user': { password: 'user123', role: '사용자' }
            };

            if (users[username] && users[username].password === password) {
                currentUser = username;
                currentUserRole = users[username].role;
                localStorage.setItem('currentUser', username);
                localStorage.setItem('currentUserRole', currentUserRole);
                return true;
            }
            return false;
        }

        function logout() {
            currentUser = null;
            currentUserRole = null;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentUserRole');
            showLoginScreen();
        }

        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            const savedRole = localStorage.getItem('currentUserRole');
            if (savedUser && savedRole) {
                currentUser = savedUser;
                currentUserRole = savedRole;
                return true;
            }
            return false;
        }

        // UI Functions
        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainSystem').classList.add('hidden');
        }

        function showMainSystem() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainSystem').classList.remove('hidden');
            document.getElementById('currentUser').textContent = `${currentUser} (${currentUserRole})`;
            
            // Hide admin-only elements based on role
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(el => {
                if (currentUserRole !== '최고관리자') {
                    el.style.display = 'none';
                } else {
                    el.style.display = '';
                }
            });

            showPage('rental');
            loadAllData();
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            document.getElementById(pageId + 'Page').classList.remove('hidden');
            
            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('bg-white', 'shadow-sm');
            });
            document.querySelector(`[data-page="${pageId}"]`).classList.add('bg-white', 'shadow-sm');

            // Load page-specific data
            switch(pageId) {
                case 'rental':
                    renderRentalTable();
                    updateDashboard();
                    break;
                case 'products':
                    renderProductTable();
                    break;
                case 'users':
                    renderUserTable();
                    break;
                case 'feedback':
                    renderFeedbackTable();
                    break;
            }
        }

        // Data Loading Functions
        async function loadAllData() {
            try {
                // Load products
                const productData = await readSheet(SHEETS.PRODUCTS);
                if (productData.length > 1) {
                    allProducts = productData.slice(1).map((row, index) => ({
                        id: index + 1,
                        phase: row[0] || '',
                        managementNumber: row[1] || '',
                        productName: row[2] || '',
                        serial: row[3] || ''
                    }));
                }

                // Load rentals
                const rentalData = await readSheet(SHEETS.RENTALS);
                if (rentalData.length > 1) {
                    allRentals = rentalData.slice(1).map((row, index) => ({
                        id: index + 1,
                        managementNumber: row[1] || '',
                        productSerial: row[2] || '',
                        schoolName: row[3] || '',
                        schoolLevel: row[4] || '',
                        studentName: row[5] || '',
                        status: row[6] || '대여중',
                        memo1: row[7] || '',
                        memo2: row[8] || '',
                        studentBirth: row[9] || '',
                        studentPhone: row[10] || '',
                        privacyDate: row[11] || '',
                        guardianName: row[12] || '',
                        relationship: row[13] || '',
                        guardianPhone: row[14] || '',
                        otherNotes: row[15] || '',
                        chargerStatus: row[16] || '양호',
                        cableStatus: row[17] || '양호',
                        usbStatus: row[18] || '양호',
                        mouseStatus: row[19] || '양호',
                        bagStatus: row[20] || '양호',
                        caseStatus: row[21] || '양호'
                    }));
                }

                // Load users
                const userData = await readSheet(SHEETS.USERS);
                if (userData.length > 1) {
                    allUsers = userData.slice(1).map((row, index) => ({
                        id: index + 1,
                        username: row[0] || '',
                        role: row[1] || '',
                        createdDate: row[2] || new Date().toISOString().split('T')[0]
                    }));
                }

                // Load feedback
                const feedbackData = await readSheet(SHEETS.FEEDBACK);
                if (feedbackData.length > 1) {
                    allFeedback = feedbackData.slice(1).map((row, index) => ({
                        id: index + 1,
                        title: row[1] || '',
                        content: row[2] || '',
                        author: row[3] || '',
                        createdDate: row[4] || '',
                        views: parseInt(row[5]) || 0
                    }));
                }

                // Update all displays
                filteredRentals = [...allRentals];
                filteredProducts = [...allProducts];
                updateModelFilter();
                updateDashboard();
                renderRentalTable();

            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Rental Functions
        function updateDashboard() {
            const phase1Count = allProducts.filter(p => p.phase === '1차').length;
            const phase2Count = allProducts.filter(p => p.phase === '2차').length;
            const rentalCount = allRentals.filter(r => r.status === '대여중').length;
            const availableCount = allRentals.filter(r => r.status === '미 대여중').length;

            document.getElementById('phase1Count').textContent = phase1Count;
            document.getElementById('phase2Count').textContent = phase2Count;
            document.getElementById('rentalCount').textContent = rentalCount;
            document.getElementById('availableCount').textContent = availableCount;
        }

        function updateModelFilter() {
            const modelFilter = document.getElementById('modelFilter');
            const models = [...new Set(allProducts.map(p => p.productName))];
            
            modelFilter.innerHTML = '<option value="">전체 모델</option>';
            models.forEach(model => {
                if (model) {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelFilter.appendChild(option);
                }
            });
        }

        function searchRentals() {
            const searchText = document.getElementById('rentalSearch').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const phaseFilter = document.getElementById('phaseFilter').value;
            const modelFilter = document.getElementById('modelFilter').value;
            const dateStart = document.getElementById('dateStart').value;
            const dateEnd = document.getElementById('dateEnd').value;

            filteredRentals = allRentals.filter(rental => {
                const matchesSearch = !searchText || 
                    rental.managementNumber.toLowerCase().includes(searchText) ||
                    rental.schoolName.toLowerCase().includes(searchText) ||
                    rental.studentName.toLowerCase().includes(searchText) ||
                    rental.productSerial.toLowerCase().includes(searchText);

                const matchesStatus = !statusFilter || rental.status === statusFilter;

                // Find product for phase and model filtering
                const product = allProducts.find(p => p.serial === rental.productSerial);
                const matchesPhase = !phaseFilter || (product && product.phase === phaseFilter);
                const matchesModel = !modelFilter || (product && product.productName === modelFilter);

                const matchesDateRange = (!dateStart || !dateEnd) || 
                    (rental.privacyDate >= dateStart && rental.privacyDate <= dateEnd);

                return matchesSearch && matchesStatus && matchesPhase && matchesModel && matchesDateRange;
            });

            currentRentalPage = 1;
            renderRentalTable();
        }

        function renderRentalTable() {
            const tbody = document.getElementById('rentalTableBody');
            const start = (currentRentalPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredRentals.slice(start, end);

            tbody.innerHTML = '';

            pageData.forEach((rental, index) => {
                const product = allProducts.find(p => p.serial === rental.productSerial);
                const productName = product ? product.productName : rental.productSerial;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="rental-checkbox" data-id="${rental.id}"></td>
                    <td>${start + index + 1}</td>
                    <td><a href="#" class="text-blue-600 hover:underline" onclick="openRentalDetail(${rental.id})">${rental.managementNumber}</a></td>
                    <td>${rental.productSerial}</td>
                    <td>${rental.schoolName}</td>
                    <td>${rental.schoolLevel}</td>
                    <td>${rental.studentName}</td>
                    <td>${productName}</td>
                    <td><span class="status-badge ${rental.status === '대여중' ? 'status-rental' : 'status-available'}">${rental.status}</span></td>
                    <td>${rental.memo1}</td>
                    <td>${rental.memo2}</td>
                    <td>${rental.otherNotes}</td>
                `;
                tbody.appendChild(row);
            });

            // Update pagination
            const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
            document.getElementById('currentPageRental').value = currentRentalPage;
            document.getElementById('totalPagesRental').textContent = totalPages;
            document.getElementById('prevPageRental').disabled = currentRentalPage === 1;
            document.getElementById('nextPageRental').disabled = currentRentalPage === totalPages;
        }

        function openRentalDetail(id) {
            const rental = allRentals.find(r => r.id === id);
            if (!rental) return;

            // Populate form fields
            document.getElementById('editManagementNumber').value = rental.managementNumber;
            document.getElementById('editProductSerial').value = rental.productSerial;
            document.getElementById('editSchoolName').value = rental.schoolName;
            document.getElementById('editSchoolLevel').value = rental.schoolLevel;
            document.getElementById('editStudentName').value = rental.studentName;
            
            const product = allProducts.find(p => p.serial === rental.productSerial);
            document.getElementById('editProductName').value = product ? product.productName : '';
            
            document.getElementById('editStatus').value = rental.status;
            document.getElementById('editMemo1').value = rental.memo1;
            document.getElementById('editMemo2').value = rental.memo2;
            document.getElementById('editStudentBirth').value = rental.studentBirth;
            document.getElementById('editStudentPhone').value = rental.studentPhone;
            document.getElementById('editPrivacyDate').value = rental.privacyDate;
            document.getElementById('editGuardianName').value = rental.guardianName;
            document.getElementById('editRelationship').value = rental.relationship;
            document.getElementById('editGuardianPhone').value = rental.guardianPhone;
            document.getElementById('editOtherNotes').value = rental.otherNotes;

            // Populate accessories
            document.getElementById('editChargerStatus').value = rental.chargerStatus;
            document.getElementById('editCableStatus').value = rental.cableStatus;
            document.getElementById('editUsbStatus').value = rental.usbStatus;
            document.getElementById('editMouseStatus').value = rental.mouseStatus;
            document.getElementById('editBagStatus').value = rental.bagStatus;
            document.getElementById('editCaseStatus').value = rental.caseStatus;

            // Store current editing ID
            document.getElementById('rentalDetailModal').dataset.editingId = id;
            
            openModal('rentalDetailModal');
        }

        async function saveRentalChanges() {
            const editingId = parseInt(document.getElementById('rentalDetailModal').dataset.editingId);
            const rentalIndex = allRentals.findIndex(r => r.id === editingId);
            
            if (rentalIndex === -1) return;

            // Update rental object
            const rental = allRentals[rentalIndex];
            rental.managementNumber = document.getElementById('editManagementNumber').value;
            rental.productSerial = document.getElementById('editProductSerial').value;
            rental.schoolName = document.getElementById('editSchoolName').value;
            rental.schoolLevel = document.getElementById('editSchoolLevel').value;
            rental.studentName = document.getElementById('editStudentName').value;
            rental.status = document.getElementById('editStatus').value;
            rental.memo1 = document.getElementById('editMemo1').value;
            rental.memo2 = document.getElementById('editMemo2').value;
            rental.studentBirth = document.getElementById('editStudentBirth').value;
            rental.studentPhone = document.getElementById('editStudentPhone').value;
            rental.privacyDate = document.getElementById('editPrivacyDate').value;
            rental.guardianName = document.getElementById('editGuardianName').value;
            rental.relationship = document.getElementById('editRelationship').value;
            rental.guardianPhone = document.getElementById('editGuardianPhone').value;
            rental.otherNotes = document.getElementById('editOtherNotes').value;
            rental.chargerStatus = document.getElementById('editChargerStatus').value;
            rental.cableStatus = document.getElementById('editCableStatus').value;
            rental.usbStatus = document.getElementById('editUsbStatus').value;
            rental.mouseStatus = document.getElementById('editMouseStatus').value;
            rental.bagStatus = document.getElementById('editBagStatus').value;
            rental.caseStatus = document.getElementById('editCaseStatus').value;

            // Update Google Sheets
            const rowData = [
                rental.id,
                rental.managementNumber,
                rental.productSerial,
                rental.schoolName,
                rental.schoolLevel,
                rental.studentName,
                rental.status,
                rental.memo1,
                rental.memo2,
                rental.studentBirth,
                rental.studentPhone,
                rental.privacyDate,
                rental.guardianName,
                rental.relationship,
                rental.guardianPhone,
                rental.otherNotes,
                rental.chargerStatus,
                rental.cableStatus,
                rental.usbStatus,
                rental.mouseStatus,
                rental.bagStatus,
                rental.caseStatus
            ];

            await writeSheet(SHEETS.RENTALS, [rowData], `A${rentalIndex + 2}`);

            closeModal('rentalDetailModal');
            searchRentals();
            updateDashboard();
            alert('저장되었습니다.');
        }

        async function addNewRental() {
            const form = document.getElementById('addRentalForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const newRental = {
                id: allRentals.length + 1,
                managementNumber: document.getElementById('newManagementNumber').value,
                productSerial: document.getElementById('newProductSerial').value,
                schoolName: document.getElementById('newSchoolName').value,
                schoolLevel: document.getElementById('newSchoolLevel').value,
                studentName: document.getElementById('newStudentName').value,
                status: '대여중',
                memo1: document.getElementById('newMemo1').value,
                memo2: document.getElementById('newMemo2').value,
                studentBirth: document.getElementById('newStudentBirth').value,
                studentPhone: document.getElementById('newStudentPhone').value,
                privacyDate: document.getElementById('newPrivacyDate').value,
                guardianName: document.getElementById('newGuardianName').value,
                relationship: document.getElementById('newRelationship').value,
                guardianPhone: document.getElementById('newGuardianPhone').value,
                otherNotes: document.getElementById('newOtherNotes').value,
                chargerStatus: document.getElementById('newChargerStatus').value,
                cableStatus: document.getElementById('newCableStatus').value,
                usbStatus: document.getElementById('newUsbStatus').value,
                mouseStatus: document.getElementById('newMouseStatus').value,
                bagStatus: document.getElementById('newBagStatus').value,
                caseStatus: document.getElementById('newCaseStatus').value
            };

            const rowData = [
                newRental.id,
                newRental.managementNumber,
                newRental.productSerial,
                newRental.schoolName,
                newRental.schoolLevel,
                newRental.studentName,
                newRental.status,
                newRental.memo1,
                newRental.memo2,
                newRental.studentBirth,
                newRental.studentPhone,
                newRental.privacyDate,
                newRental.guardianName,
                newRental.relationship,
                newRental.guardianPhone,
                newRental.otherNotes,
                newRental.chargerStatus,
                newRental.cableStatus,
                newRental.usbStatus,
                newRental.mouseStatus,
                newRental.bagStatus,
                newRental.caseStatus
            ];

            await appendSheet(SHEETS.RENTALS, [rowData]);
            allRentals.push(newRental);

            closeModal('addRentalModal');
            form.reset();
            searchRentals();
            updateDashboard();
            alert('저장되었습니다.');
        }

        // Product Functions
        function renderProductTable() {
            const tbody = document.getElementById('productTableBody');
            const start = (currentProductPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredProducts.slice(start, end);

            tbody.innerHTML = '';

            pageData.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="product-checkbox" data-id="${product.id}"></td>
                    <td>${product.phase}</td>
                    <td>${product.managementNumber}</td>
                    <td>${product.productName}</td>
                    <td>${product.serial}</td>
                    <td>
                        <button class="btn-primary mr-1" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-danger" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update pagination
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            document.getElementById('currentPageProduct').value = currentProductPage;
            document.getElementById('totalPagesProduct').value = totalPages;
            document.getElementById('prevPageProduct').disabled = currentProductPage === 1;
            document.getElementById('nextPageProduct').disabled = currentProductPage === totalPages;
        }

        async function addNewProduct() {
            const form = document.getElementById('addProductForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const newProduct = {
                id: allProducts.length + 1,
                phase: document.getElementById('newPhase').value,
                managementNumber: document.getElementById('newProductManagementNumber').value,
                productName: document.getElementById('newProductNameAdd').value,
                serial: document.getElementById('newProductSerialAdd').value
            };

            const rowData = [
                newProduct.phase,
                newProduct.managementNumber,
                newProduct.productName,
                newProduct.serial
            ];

            await appendSheet(SHEETS.PRODUCTS, [rowData]);
            allProducts.push(newProduct);

            closeModal('addProductModal');
            form.reset();
            updateModelFilter();
            renderProductTable();
            alert('저장되었습니다.');
        }

        // User Functions
        function renderUserTable() {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';

            allUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.role}</td>
                    <td>${user.createdDate}</td>
                    <td>
                        <button class="btn-primary mr-1" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-danger" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function addNewUser() {
            const form = document.getElementById('addUserForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const newUser = {
                id: allUsers.length + 1,
                username: document.getElementById('newUsername').value,
                role: document.getElementById('newUserRole').value,
                createdDate: new Date().toISOString().split('T')[0]
            };

            const rowData = [
                newUser.username,
                newUser.role,
                newUser.createdDate
            ];

            await appendSheet(SHEETS.USERS, [rowData]);
            allUsers.push(newUser);

            closeModal('addUserModal');
            form.reset();
            renderUserTable();
            alert('저장되었습니다.');
        }

        // Feedback Functions
        function renderFeedbackTable() {
            const tbody = document.getElementById('feedbackTableBody');
            const start = (currentFeedbackPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = allFeedback.slice(start, end);

            tbody.innerHTML = '';

            pageData.forEach((feedback, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${start + index + 1}</td>
                    <td><a href="#" class="text-blue-600 hover:underline" onclick="openFeedbackDetail(${feedback.id})">${feedback.title}</a></td>
                    <td>${feedback.author}</td>
                    <td>${feedback.createdDate}</td>
                    <td>${feedback.views}</td>
                    <td>
                        <button class="btn-danger" onclick="deleteFeedback(${feedback.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Update pagination
            const totalPages = Math.ceil(allFeedback.length / itemsPerPage);
            document.getElementById('currentPageFeedback').value = currentFeedbackPage;
            document.getElementById('totalPagesFeedback').textContent = totalPages;
            document.getElementById('prevPageFeedback').disabled = currentFeedbackPage === 1;
            document.getElementById('nextPageFeedback').disabled = currentFeedbackPage === totalPages;
        }

        async function addNewFeedback() {
            const form = document.getElementById('addFeedbackForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const newFeedback = {
                id: allFeedback.length + 1,
                title: document.getElementById('newFeedbackTitle').value,
                content: document.getElementById('newFeedbackContent').value,
                author: currentUser,
                createdDate: new Date().toISOString().split('T')[0],
                views: 0
            };

            const rowData = [
                newFeedback.id,
                newFeedback.title,
                newFeedback.content,
                newFeedback.author,
                newFeedback.createdDate,
                newFeedback.views
            ];

            await appendSheet(SHEETS.FEEDBACK, [rowData]);
            allFeedback.push(newFeedback);

            closeModal('addFeedbackModal');
            form.reset();
            renderFeedbackTable();
            alert('저장되었습니다.');
        }

        // File Upload Functions
        function downloadRentalSample() {
            const headers = [
                '순번', '관리번호', '제품시리얼', '학교명', '학교급', '학생명', '상태', '메모1', '메모2',
                '학생생년월일', '학생연락처', '개인정보동의일자', '보호자명', '관계', '보호자연락처', '기타사항',
                '충전기상태', '충전케이블상태', 'USB랜젠더상태', '마우스상태', '가방상태', '케이스상태'
            ];
            
            const sampleData = [
                ['1', '2025-NEW1', 'UPLOADED001', '오름초등학교', '초등학교', '박지성', '대여중', '오름초등학교', '대학수', 
                 '20111105', '01037892', '20250407', '김부모', '부', '01049962933', '', '양호', '양호', '양호', '양호', '양호', '양호']
            ];

            downloadExcel(headers, sampleData, '대여관리_샘플.xlsx');
        }

        function downloadProductSample() {
            const headers = ['차수', '관리번호', '제품명', '시리얼'];
            const sampleData = [
                ['1차', '2025-UPLOAD1', '삼성노트북A', 'UPLOADED001'],
                ['2차', '2025-UPLOAD2', '프로젝터 (EPSON)', 'UPLOADED002']
            ];

            downloadExcel(headers, sampleData, '제품관리_샘플.xlsx');
        }

        function downloadExcel(headers, data, filename) {
            // Create CSV content
            const csvContent = [headers, ...data]
                .map(row => row.map(cell => `"${cell}"`).join(','))
                .join('\n');

            // Create blob and download
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename.replace('.xlsx', '.csv');
            link.click();
        }

        function uploadFile(type) {
            const fileInput = document.getElementById('fileUpload');
            fileInput.onchange = (e) => handleFileUpload(e, type);
            fileInput.click();
        }

        function handleFileUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    if (type === 'product') {
                        processProductUpload(jsonData);
                    } else if (type === 'rental') {
                        processRentalUpload(jsonData);
                    }
                } catch (error) {
                    alert('파일을 읽는 중 오류가 발생했습니다.');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        async function processProductUpload(data) {
            if (data.length < 2) {
                alert('올바른 형식의 파일이 아닙니다.');
                return;
            }

            const newProducts = [];
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (row.length >= 4 && row[1] && row[3]) {
                    newProducts.push([row[0], row[1], row[2], row[3]]);
                }
            }

            if (newProducts.length === 0) {
                alert('업로드할 데이터가 없습니다.');
                return;
            }

            await appendSheet(SHEETS.PRODUCTS, newProducts);
            await loadAllData();
            alert(`${newProducts.length}개의 제품이 업로드되었습니다.`);
        }

        async function processRentalUpload(data) {
            if (data.length < 2) {
                alert('올바른 형식의 파일이 아닙니다.');
                return;
            }

            const newRentals = [];
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (row.length >= 6 && row[1] && row[2]) {
                    // Ensure all 22 columns are present
                    const fullRow = new Array(22).fill('').map((_, index) => row[index] || '');
                    fullRow[6] = '대여중'; // Status always set to rental
                    newRentals.push(fullRow);
                }
            }

            if (newRentals.length === 0) {
                alert('업로드할 데이터가 없습니다.');
                return;
            }

            await appendSheet(SHEETS.RENTALS, newRentals);
            await loadAllData();
            alert(`${newRentals.length}개의 대여 정보가 업로드되었습니다.`);
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            
            // Make modal draggable
            const modal = document.getElementById(modalId);
            const header = modal.querySelector('.modal-header');
            makeDraggable(modal, header);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function makeDraggable(element, handle) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            handle.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load Google Sheets API
            const script = document.createElement('script');
            script.src = 'https://apis.google.com/js/api.js';
            script.onload = initGoogleSheetsAPI;
            document.head.appendChild(script);

            // Load XLSX library
            const xlsxScript = document.createElement('script');
            xlsxScript.src = 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js';
            document.head.appendChild(xlsxScript);

            // Check authentication
            if (checkAuth()) {
                showMainSystem();
            } else {
                showLoginScreen();
            }

            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (login(username, password)) {
                    showMainSystem();
                } else {
                    alert('로그인 정보가 올바르지 않습니다.');
                }
            });

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Menu navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.dataset.page;
                    showPage(page);
                });
            });

            // Search and filter events
            document.getElementById('searchBtn').addEventListener('click', searchRentals);
            document.getElementById('resetBtn').addEventListener('click', function() {
                document.getElementById('rentalSearch').value = '';
                document.getElementById('statusFilter').value = '';
                document.getElementById('phaseFilter').value = '';
                document.getElementById('modelFilter').value = '';
                document.getElementById('dateStart').value = '';
                document.getElementById('dateEnd').value = '';
                filteredRentals = [...allRentals];
                currentRentalPage = 1;
                renderRentalTable();
            });

            // Action buttons
            document.getElementById('addRentalBtn').addEventListener('click', () => openModal('addRentalModal'));
            document.getElementById('downloadRentalSampleBtn').addEventListener('click', downloadRentalSample);
            document.getElementById('uploadRentalBtn').addEventListener('click', () => uploadFile('rental'));

            document.getElementById('addProductBtn').addEventListener('click', () => openModal('addProductModal'));
            document.getElementById('downloadProductSampleBtn').addEventListener('click', downloadProductSample);
            document.getElementById('uploadProductBtn').addEventListener('click', () => uploadFile('product'));

            document.getElementById('addUserBtn').addEventListener('click', () => openModal('addUserModal'));
            document.getElementById('addFeedbackBtn').addEventListener('click', () => openModal('addFeedbackModal'));

            // Form submissions
            document.getElementById('addRentalForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewRental();
            });

            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewProduct();
            });

            document.getElementById('addUserForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewUser();
            });

            document.getElementById('addFeedbackForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewFeedback();
            });

            // Pagination events
            document.getElementById('prevPageRental').addEventListener('click', function() {
                if (currentRentalPage > 1) {
                    currentRentalPage--;
                    renderRentalTable();
                }
            });

            document.getElementById('nextPageRental').addEventListener('click', function() {
                const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
                if (currentRentalPage < totalPages) {
                    currentRentalPage++;
                    renderRentalTable();
                }
            });

            document.getElementById('currentPageRental').addEventListener('change', function() {
                const totalPages = Math.ceil(filteredRentals.length / itemsPerPage);
                const page = parseInt(this.value);
                if (page >= 1 && page <= totalPages) {
                    currentRentalPage = page;
                    renderRentalTable();
                } else {
                    this.value = currentRentalPage;
                }
            });

            // Product pagination
            document.getElementById('prevPageProduct').addEventListener('click', function() {
                if (currentProductPage > 1) {
                    currentProductPage--;
                    renderProductTable();
                }
            });

            document.getElementById('nextPageProduct').addEventListener('click', function() {
                const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
                if (currentProductPage < totalPages) {
                    currentProductPage++;
                    renderProductTable();
                }
            });

            // Modal close events
            document.querySelectorAll('.close').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    modal.style.display = 'none';
                });
            });

            // Click outside modal to close
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        });
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9548d86bfb81d4e3","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDhApvId9ce1ctZ2ErTsP3bCXGemBUCtJH1rtjo0yAebHjqCPy0irtWD3TKU01nLaFtpoEckk078b7rhuy0emswYdzTBjhJvYLB0weR%2Bh278SVkIzzpoT720nksN5%2FGVf3Xp8NOSSmhc4EEpN9O03OLVYgvi0VpKk%2FbF0AYRz1oBqqwpWlRgspihW1t15yscY04E9NFJ5P%2FTywkK0z991bLWQDh3I1cklCOAOqwY5CUkJyE6oGKkzovxqP%2FW%2B6s%2FIEpmC6VgwC5PewoBPHJRAyul%2Bg8QfWevE%2FL348c1wvantFHXau5MsR%2BefKwRLeQ6Y8uiNsjR9BDo3tVmbeWKgvuBgLB%2BjysXMuPd0D3Jld0j4bQX31qXKJqnSU7JTVV4yBx%2BxRIFkfK1QV53OJ8v6nx%2BlCqAZqK%2B2qcVej5pEZEJ%2BJxO1UtYriTzjv7Ndfi6Gi1FP8UnSJdOnJ%2FhdnGr7ao%2BpRi1e8%2FwI3RRt3TodPNrpKZAPgZr48bUhOpxyWzI%2F4K3k%2BoDNIUOJ%2BJIpkcaU3IA%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDhApvId9ce1ctZ2ErTsP3bCXGemBUCtJH1rtjo0yAebHjqCPy0irtWD3TKU01nLaFtpoEckk078b7rhuy0emswYdzTBjhJvYLB0weR+h278SVkIzzpoT720nksN5/GVf3Xp8NOSSmhc4EEpN9O03OLVYgvi0VpKk/bF0AYRz1oBqqwpWlRgspihW1t15yscY04E9NFJ5P/TywkK0z991bLWQDh3I1cklCOAOqwY5CUkJyE6oGKkzovxqP/W+6s/IEpmC6VgwC5PewoBPHJRAyul+g8QfWevE/L348c1wvantFHXau5MsR+efKwRLeQ6Y8uiNsjR9BDo3tVmbeWKgvuBgLB+jysXMuPd0D3Jld0j4bQX31qXKJqnSU7JTVV4yBx+xRIFkfK1QV53OJ8v6nx+lCqAZqK+2qcVej5pEZEJ+JxO1UtYriTzjv7Ndfi6Gi1FP8UnSJdOnJ/hdnGr7ao+pRi1e8/wI3RRt3TodPNrpKZAPgZr48bUhOpxyWzI/4K3k+oDNIUOJ+JIpkcaU3IA=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
