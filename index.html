<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>제주교육청 스마트단말 관리 시스템</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        /* 로그인 화면 */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo img {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
        }

        .login-logo h1 {
            color: #4a6cf7;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .login-form .form-group {
            margin-bottom: 1rem;
        }

        .login-form label {
            display: block;
            margin-bottom: 0.5rem;
            color: #555;
            font-weight: 500;
        }

        .login-form input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .login-form input:focus {
            outline: none;
            border-color: #4a6cf7;
        }

        .login-btn {
            width: 100%;
            padding: 0.75rem;
            background: #4a6cf7;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .login-btn:hover {
            background: #3b5de8;
        }

        .contact-info {
            text-align: center;
            margin-top: 1.5rem;
            color: #666;
            font-size: 0.9rem;
        }

        /* 메인 시스템 */
        .main-system {
            display: none;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .layout {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            width: 250px;
            background: #34495e;
            color: white;
            padding: 1rem 0;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
            gap: 0.75rem;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: #4a6cf7;
        }

        .logout-btn {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .content {
            flex: 1;
            padding: 2rem;
            background: #ecf0f1;
        }

        .page {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .page.active {
            display: block;
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            border-bottom: 3px solid #4a6cf7;
            padding-bottom: 0.5rem;
        }

        /* 대시보드 카드 */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .dashboard-card.green {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }

        .dashboard-card.orange {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .dashboard-card.red {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }

        .dashboard-card h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .dashboard-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        /* 검색 및 필터 */
        .search-filters {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4a6cf7;
        }

        /* 버튼 */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4a6cf7;
            color: white;
        }

        .btn-primary:hover {
            background: #3b5de8;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* 액션 버튼 그룹 */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        /* 테이블 */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        th {
            background: #4a6cf7;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-rental {
            background: #fff3cd;
            color: #856404;
        }

        .status-available {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* 페이지네이션 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .pagination button {
            background: #4a6cf7;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .pagination button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .pagination input {
            width: 80px;
            text-align: center;
            padding: 0.5rem;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
        }

        /* 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e1e5e9;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #2c3e50;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }

        .close-btn:hover {
            color: #dc3545;
        }

        .modal-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .modal-body .form-group {
            grid-column: span 1;
        }

        .modal-body .form-group.full-width {
            grid-column: span 2;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid #e1e5e9;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
            }

            .sidebar-menu {
                display: flex;
                overflow-x: auto;
            }

            .sidebar-menu li {
                min-width: 150px;
            }

            .logout-btn {
                position: static;
                margin: 1rem;
            }

            .search-filters {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .modal-body {
                grid-template-columns: 1fr;
            }

            .modal-body .form-group {
                grid-column: span 1;
            }
        }

        /* 로딩 스피너 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4a6cf7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 알림 메시지 */
        .alert {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 5px;
            border: 1px solid transparent;
        }

        .alert-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        /* 파일 업로드 */
        .file-upload {
            border: 2px dashed #4a6cf7;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            background: #f8f9ff;
        }

        .file-upload.dragover {
            background: #e6f3ff;
            border-color: #0066cc;
        }

        .file-input {
            display: none;
        }

        .file-upload-text {
            color: #4a6cf7;
            font-weight: 500;
        }

        /* 액세서리 관리 */
        .accessories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .accessory-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #e1e5e9;
        }

        .accessory-item label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #555;
        }

        .accessory-item select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- 로그인 화면 -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <div style="width: 80px; height: 80px; background: linear-gradient(45deg, #4a6cf7, #764ba2); border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-graduation-cap" style="font-size: 2rem; color: white;"></i>
                </div>
                <h1>제주교육청 스마트단말 관리 시스템</h1>
                <p>Smart Device Management System</p>
            </div>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="username">사용자명</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i> 로그인
                </button>
            </form>
            <div class="contact-info">
                <p>콜센터: 1811-8290</p>
                <p>제주특별자치도교육청</p>
            </div>
        </div>
    </div>

    <!-- 메인 시스템 -->
    <div id="mainSystem" class="main-system">
        <header class="header">
            <h1>
                <i class="fas fa-laptop"></i>
                제주교육청 스마트단말 관리 시스템
            </h1>
            <div class="user-info">
                <span id="currentUser">관리자님 환영합니다!</span>
                <span id="currentTime"></span>
            </div>
        </header>

        <div class="layout">
            <nav class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#" onclick="showPage('dashboard')" class="active" id="menu-dashboard">
                        <i class="fas fa-tachometer-alt"></i> 대여 관리
                    </a></li>
                    <li><a href="#" onclick="showPage('products')" id="menu-products">
                        <i class="fas fa-box"></i> 제품 관리
                    </a></li>
                    <li><a href="#" onclick="showPage('users')" id="menu-users">
                        <i class="fas fa-users"></i> 사용자 관리
                    </a></li>
                    <li><a href="#" onclick="showPage('feedback')" id="menu-feedback">
                        <i class="fas fa-comments"></i> 피드백 게시판
                    </a></li>
                </ul>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> 로그아웃
                </button>
            </nav>

            <main class="content">
                <!-- 대여 관리 페이지 -->
                <div id="dashboard" class="page active">
                    <h2 class="page-title">대여 관리</h2>
                    <p>스마트단말 대여 현황을 관리합니다.</p>

                    <div class="dashboard-cards">
                        <div class="dashboard-card">
                            <h3>1차 장비 수</h3>
                            <div class="number" id="phase1Count">0</div>
                            <i class="fas fa-laptop" style="font-size: 2rem; opacity: 0.8;"></i>
                        </div>
                        <div class="dashboard-card green">
                            <h3>2차 장비 수</h3>
                            <div class="number" id="phase2Count">0</div>
                            <i class="fas fa-tablet-alt" style="font-size: 2rem; opacity: 0.8;"></i>
                        </div>
                        <div class="dashboard-card orange">
                            <h3>대여중</h3>
                            <div class="number" id="rentalCount">0</div>
                            <i class="fas fa-hand-holding" style="font-size: 2rem; opacity: 0.8;"></i>
                        </div>
                        <div class="dashboard-card red">
                            <h3>미 대여중</h3>
                            <div class="number" id="availableCount">0</div>
                            <i class="fas fa-check-circle" style="font-size: 2rem; opacity: 0.8;"></i>
                        </div>
                    </div>

                    <div class="search-filters">
                        <div class="form-group">
                            <label for="rentalSearch">통합 검색</label>
                            <input type="text" id="rentalSearch" placeholder="관리번호, 학교명, 학생명, 제품명...">
                        </div>
                        <div class="form-group">
                            <label for="statusFilter">상태 선택</label>
                            <select id="statusFilter">
                                <option value="">전체 상태</option>
                                <option value="대여중">대여중</option>
                                <option value="미대여중">미대여중</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="phaseFilter">차수 선택</label>
                            <select id="phaseFilter">
                                <option value="">전체 차수</option>
                                <option value="1차">1차</option>
                                <option value="2차">2차</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="modelFilter">모델 선택</label>
                            <select id="modelFilter">
                                <option value="">전체 모델</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                        <div>
                            <label for="dateFrom">개인정보동의일자 시작</label>
                            <input type="date" id="dateFrom">
                        </div>
                        <div>
                            <label for="dateTo">개인정보동의일자 종료</label>
                            <input type="date" id="dateTo">
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="searchRentals()">
                            <i class="fas fa-search"></i> 검색
                        </button>
                        <button class="btn btn-secondary" onclick="resetRentalFilters()">
                            <i class="fas fa-undo"></i> 초기화
                        </button>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="showAddRentalModal()">
                            <i class="fas fa-plus"></i> 새 대여 추가
                        </button>
                        <button class="btn btn-primary" onclick="downloadRentalSample()">
                            <i class="fas fa-download"></i> Excel 샘플
                        </button>
                        <label class="btn btn-warning" for="rentalFileInput">
                            <i class="fas fa-upload"></i> Excel 업로드
                        </label>
                        <input type="file" id="rentalFileInput" class="file-input" accept=".xlsx,.xls" onchange="handleRentalUpload(event)">
                        <button class="btn btn-danger" onclick="deleteAllRentals()">
                            <i class="fas fa-trash"></i> 전체 삭제
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllRentals" onchange="toggleAllRentals()"></th>
                                    <th>순번</th>
                                    <th>관리번호</th>
                                    <th>제품시리얼</th>
                                    <th>학교명</th>
                                    <th>학교급</th>
                                    <th>학생명</th>
                                    <th>제품명</th>
                                    <th>상태</th>
                                    <th>메모1</th>
                                    <th>메모2</th>
                                    <th>기타</th>
                                </tr>
                            </thead>
                            <tbody id="rentalTableBody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination">
                        <button id="prevRentalPage" onclick="changeRentalPage(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span>페이지</span>
                        <input type="number" id="currentRentalPage" value="1" min="1" onchange="goToRentalPage()">
                        <span>/ <span id="totalRentalPages">1</span></span>
                        <button id="nextRentalPage" onclick="changeRentalPage(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- 제품 관리 페이지 -->
                <div id="products" class="page">
                    <h2 class="page-title">제품 관리</h2>
                    <p>제품 데이터를 관리합니다.</p>

                    <div class="search-filters">
                        <div class="form-group">
                            <label for="productSearch">검색</label>
                            <input type="text" id="productSearch" placeholder="차수, 관리번호, 제품명, 시리얼 검색...">
                        </div>
                        <button class="btn btn-primary" onclick="searchProducts()">
                            <i class="fas fa-search"></i> 검색
                        </button>
                        <button class="btn btn-secondary" onclick="resetProductFilters()">
                            <i class="fas fa-undo"></i> 초기화
                        </button>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i> 제품 추가
                        </button>
                        <button class="btn btn-primary" onclick="downloadProductSample()">
                            <i class="fas fa-download"></i> Excel 샘플
                        </button>
                        <label class="btn btn-warning" for="productFileInput">
                            <i class="fas fa-upload"></i> Excel 업로드
                        </label>
                        <input type="file" id="productFileInput" class="file-input" accept=".xlsx,.xls" onchange="handleProductUpload(event)">
                        <button class="btn btn-danger" onclick="deleteAllProducts()">
                            <i class="fas fa-trash"></i> 전체 삭제
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllProducts" onchange="toggleAllProducts()"></th>
                                    <th>차수</th>
                                    <th>관리번호</th>
                                    <th>제품명</th>
                                    <th>시리얼</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="productTableBody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination">
                        <button id="prevProductPage" onclick="changeProductPage(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span>페이지</span>
                        <input type="number" id="currentProductPage" value="1" min="1" onchange="goToProductPage()">
                        <span>/ <span id="totalProductPages">1</span></span>
                        <button id="nextProductPage" onclick="changeProductPage(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- 사용자 관리 페이지 -->
                <div id="users" class="page">
                    <h2 class="page-title">사용자 관리</h2>
                    <p>시스템 사용자를 관리합니다.</p>

                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="showAddUserModal()">
                            <i class="fas fa-user-plus"></i> 사용자 추가
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>사용자명</th>
                                    <th>권한</th>
                                    <th>생성일</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 피드백 게시판 페이지 -->
                <div id="feedback" class="page">
                    <h2 class="page-title">피드백 게시판</h2>
                    <p>사용자 피드백을 관리합니다.</p>

                    <div class="search-filters">
                        <div class="form-group">
                            <label for="feedbackSearch">검색</label>
                            <input type="text" id="feedbackSearch" placeholder="제목, 내용 검색...">
                        </div>
                        <button class="btn btn-primary" onclick="searchFeedback()">
                            <i class="fas fa-search"></i> 검색
                        </button>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="showAddFeedbackModal()">
                            <i class="fas fa-plus"></i> 새 글 작성
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>번호</th>
                                    <th>제목</th>
                                    <th>작성자</th>
                                    <th>작성일</th>
                                    <th>조회수</th>
                                    <th>작업</th>
                                </tr>
                            </thead>
                            <tbody id="feedbackTableBody">
                                <!-- 동적으로 생성됨 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 대여 정보 수정 모달 -->
    <div id="editRentalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">대여 정보 수정</h3>
                <button class="close-btn" onclick="closeModal('editRentalModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editRentalId">관리번호</label>
                    <input type="text" id="editRentalId" readonly>
                </div>
                <div class="form-group">
                    <label for="editRentalSerial">제품시리얼</label>
                    <input type="text" id="editRentalSerial">
                </div>
                <div class="form-group">
                    <label for="editSchoolName">학교명</label>
                    <input type="text" id="editSchoolName">
                </div>
                <div class="form-group">
                    <label for="editSchoolLevel">학교급</label>
                    <select id="editSchoolLevel">
                        <option value="초등학교">초등학교</option>
                        <option value="중학교">중학교</option>
                        <option value="고등학교">고등학교</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editStudentName">학생명</label>
                    <input type="text" id="editStudentName">
                </div>
                <div class="form-group">
                    <label for="editProductName">제품명</label>
                    <input type="text" id="editProductName">
                </div>
                <div class="form-group">
                    <label for="editRentalStatus">상태</label>
                    <select id="editRentalStatus">
                        <option value="대여중">대여중</option>
                        <option value="미대여중">미대여중</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editMemo1">메모1</label>
                    <input type="text" id="editMemo1">
                </div>
                <div class="form-group">
                    <label for="editMemo2">메모2</label>
                    <input type="text" id="editMemo2">
                </div>
                <div class="form-group">
                    <label for="editStudentBirth">학생생년월일</label>
                    <input type="date" id="editStudentBirth">
                </div>
                <div class="form-group">
                    <label for="editStudentPhone">학생연락처</label>
                    <input type="tel" id="editStudentPhone">
                </div>
                <div class="form-group">
                    <label for="editConsentDate">개인정보동의일자</label>
                    <input type="date" id="editConsentDate">
                </div>
                <div class="form-group">
                    <label for="editParentName">보호자명</label>
                    <input type="text" id="editParentName">
                </div>
                <div class="form-group">
                    <label for="editRelation">관계</label>
                    <select id="editRelation">
                        <option value="부모">부모</option>
                        <option value="조부모">조부모</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editParentPhone">보호자연락처</label>
                    <input type="tel" id="editParentPhone">
                </div>
                <div class="form-group full-width">
                    <label for="editOther">기타사항</label>
                    <textarea id="editOther" rows="3"></textarea>
                </div>
                
                <div class="form-group full-width">
                    <h4 style="margin-bottom: 1rem; color: #4a6cf7;">
                        <i class="fas fa-tools"></i> 악세사리 관리
                    </h4>
                    <div class="accessories-grid">
                        <div class="accessory-item">
                            <label><i class="fas fa-plug"></i> 충전기</label>
                            <select id="editCharger">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-usb"></i> 충전케이블</label>
                            <select id="editCable">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-ethernet"></i> USB 랜 젠더</label>
                            <select id="editUsbAdapter">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-mouse"></i> 마우스</label>
                            <select id="editMouse">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-briefcase"></i> 가방</label>
                            <select id="editBag">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                        <div class="accessory-item">
                            <label><i class="fas fa-mobile-alt"></i> 케이스</label>
                            <select id="editCase">
                                <option value="양호">양호</option>
                                <option value="훼손">훼손</option>
                                <option value="완파">완파</option>
                                <option value="분실">분실</option>
                                <option value="초기미포함">초기미포함</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editRentalModal')">취소</button>
                <button class="btn btn-primary" onclick="saveRentalEdit()">저장</button>
            </div>
        </div>
    </div>

    <!-- 새 대여 추가 모달 -->
    <div id="addRentalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">새 대여 추가</h3>
                <button class="close-btn" onclick="closeModal('addRentalModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newRentalId">관리번호</label>
                    <input type="text" id="newRentalId" required>
                </div>
                <div class="form-group">
                    <label for="newRentalSerial">제품시리얼</label>
                    <input type="text" id="newRentalSerial" required>
                </div>
                <div class="form-group">
                    <label for="newSchoolName">학교명</label>
                    <input type="text" id="newSchoolName" required>
                </div>
                <div class="form-group">
                    <label for="newSchoolLevel">학교급</label>
                    <select id="newSchoolLevel" required>
                        <option value="">선택하세요</option>
                        <option value="초등학교">초등학교</option>
                        <option value="중학교">중학교</option>
                        <option value="고등학교">고등학교</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newStudentName">학생명</label>
                    <input type="text" id="newStudentName" required>
                </div>
                <div class="form-group">
                    <label for="newProductName">제품명</label>
                    <input type="text" id="newProductName" required>
                </div>
                <div class="form-group">
                    <label for="newMemo1">메모1</label>
                    <input type="text" id="newMemo1">
                </div>
                <div class="form-group">
                    <label for="newMemo2">메모2</label>
                    <input type="text" id="newMemo2">
                </div>
                <div class="form-group">
                    <label for="newStudentBirth">학생생년월일</label>
                    <input type="date" id="newStudentBirth">
                </div>
                <div class="form-group">
                    <label for="newStudentPhone">학생연락처</label>
                    <input type="tel" id="newStudentPhone">
                </div>
                <div class="form-group">
                    <label for="newConsentDate">개인정보동의일자</label>
                    <input type="date" id="newConsentDate">
                </div>
                <div class="form-group">
                    <label for="newParentName">보호자명</label>
                    <input type="text" id="newParentName">
                </div>
                <div class="form-group">
                    <label for="newRelation">관계</label>
                    <select id="newRelation">
                        <option value="">선택하세요</option>
                        <option value="부모">부모</option>
                        <option value="조부모">조부모</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newParentPhone">보호자연락처</label>
                    <input type="tel" id="newParentPhone">
                </div>
                <div class="form-group full-width">
                    <label for="newOther">기타사항</label>
                    <textarea id="newOther" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addRentalModal')">취소</button>
                <button class="btn btn-primary" onclick="addNewRental()">저장</button>
            </div>
        </div>
    </div>

    <!-- 제품 추가 모달 -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">제품 추가</h3>
                <button class="close-btn" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newProductPhase">차수</label>
                    <select id="newProductPhase" required>
                        <option value="">선택하세요</option>
                        <option value="1차">1차</option>
                        <option value="2차">2차</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newProductId">관리번호</label>
                    <input type="text" id="newProductId" required>
                </div>
                <div class="form-group">
                    <label for="newProductNameInput">제품명</label>
                    <input type="text" id="newProductNameInput" required>
                </div>
                <div class="form-group">
                    <label for="newProductSerial">시리얼</label>
                    <input type="text" id="newProductSerial" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addProductModal')">취소</button>
                <button class="btn btn-primary" onclick="addNewProduct()">저장</button>
            </div>
        </div>
    </div>

    <!-- 사용자 추가 모달 -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">사용자 추가</h3>
                <button class="close-btn" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newUsername">사용자명</label>
                    <input type="text" id="newUsername" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">비밀번호</label>
                    <input type="password" id="newPassword" required>
                </div>
                <div class="form-group">
                    <label for="newUserRole">권한</label>
                    <select id="newUserRole" required>
                        <option value="">선택하세요</option>
                        <option value="최고관리자">최고관리자</option>
                        <option value="관리자">관리자</option>
                        <option value="사용자">사용자</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addUserModal')">취소</button>
                <button class="btn btn-primary" onclick="addNewUser()">저장</button>
            </div>
        </div>
    </div>

    <!-- 피드백 추가 모달 -->
    <div id="addFeedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">새 글 작성</h3>
                <button class="close-btn" onclick="closeModal('addFeedbackModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group full-width">
                    <label for="newFeedbackTitle">제목</label>
                    <input type="text" id="newFeedbackTitle" required>
                </div>
                <div class="form-group full-width">
                    <label for="newFeedbackContent">내용</label>
                    <textarea id="newFeedbackContent" rows="10" required></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addFeedbackModal')">취소</button>
                <button class="btn btn-primary" onclick="addNewFeedback()">저장</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyBQW8SvnYg4R-1IssLlAZ5fJ4382nNztKA",
            authDomain: "jeju-education-system.firebaseapp.com",
            databaseURL: "https://jeju-education-system-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "jeju-education-system",
            storageBucket: "jeju-education-system.firebasestorage.app",
            messagingSenderId: "462514623607",
            appId: "1:462514623607:web:afa068226e4f115a4a2272"
        };

        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 전역 변수
        let currentUser = null;
        let currentPage = 'dashboard';
        let rentalData = [];
        let productData = [];
        let userData = [];
        let feedbackData = [];
        let currentRentalPage = 1;
        let currentProductPage = 1;
        let itemsPerPage = 20;
        let editingRentalId = null;

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            loadInitialData();
            
            // 기본 사용자 데이터 설정
            initializeDefaultUsers();
        });

        // 시간 업데이트
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }

        // 기본 사용자 초기화
        function initializeDefaultUsers() {
            const defaultUsers = [
                { username: 'admin', password: 'admin123', role: '최고관리자', createdAt: new Date().toISOString() },
                { username: 'manager', password: 'manager123', role: '관리자', createdAt: new Date().toISOString() },
                { username: 'user', password: 'user123', role: '사용자', createdAt: new Date().toISOString() }
            ];

            database.ref('users').once('value', (snapshot) => {
                if (!snapshot.exists()) {
                    defaultUsers.forEach(user => {
                        database.ref('users').push(user);
                    });
                }
            });
        }

        // 초기 데이터 로드
        function loadInitialData() {
            // Firebase에서 데이터 실시간 동기화
            database.ref('rentals').on('value', (snapshot) => {
                rentalData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        rentalData.push({
                            key: child.key,
                            ...child.val()
                        });
                    });
                }
                updateRentalDisplay();
                updateDashboardStats();
                updateModelFilter();
            });

            database.ref('products').on('value', (snapshot) => {
                productData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        productData.push({
                            key: child.key,
                            ...child.val()
                        });
                    });
                }
                updateProductDisplay();
            });

            database.ref('users').on('value', (snapshot) => {
                userData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        userData.push({
                            key: child.key,
                            ...child.val()
                        });
                    });
                }
                updateUserDisplay();
            });

            database.ref('feedback').on('value', (snapshot) => {
                feedbackData = [];
                if (snapshot.exists()) {
                    snapshot.forEach((child) => {
                        feedbackData.push({
                            key: child.key,
                            ...child.val()
                        });
                    });
                }
                updateFeedbackDisplay();
            });
        }

        // 로그인 처리
        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            database.ref('users').once('value', (snapshot) => {
                let loginSuccess = false;
                let userRole = '';

                snapshot.forEach((child) => {
                    const user = child.val();
                    if (user.username === username && user.password === password) {
                        loginSuccess = true;
                        userRole = user.role;
                        currentUser = {
                            username: username,
                            role: userRole
                        };
                    }
                });

                if (loginSuccess) {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('mainSystem').style.display = 'block';
                    document.getElementById('currentUser').textContent = `${userRole}님 환영합니다!`;
                    
                    // 권한에 따른 메뉴 표시
                    updateMenuByRole(userRole);
                } else {
                    alert('로그인 정보가 올바르지 않습니다.');
                }
            });
        }

        // 권한에 따른 메뉴 업데이트
        function updateMenuByRole(role) {
            const userMenu = document.getElementById('menu-users');
            if (role !== '최고관리자') {
                userMenu.style.display = 'none';
            }
        }

        // 로그아웃
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                currentUser = null;
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainSystem').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            }
        }

        // 페이지 전환
        function showPage(pageId) {
            // 모든 페이지 숨기기
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // 모든 메뉴 비활성화
            document.querySelectorAll('.sidebar-menu a').forEach(menu => {
                menu.classList.remove('active');
            });

            // 선택된 페이지 표시
            document.getElementById(pageId).classList.add('active');
            document.getElementById(`menu-${pageId}`).classList.add('active');
            
            currentPage = pageId;
        }

        // 대시보드 통계 업데이트
        function updateDashboardStats() {
            const phase1Count = rentalData.filter(item => item.phase === '1차').length;
            const phase2Count = rentalData.filter(item => item.phase === '2차').length;
            const rentalCount = rentalData.filter(item => item.status === '대여중').length;
            const availableCount = rentalData.filter(item => item.status === '미대여중').length;

            document.getElementById('phase1Count').textContent = phase1Count;
            document.getElementById('phase2Count').textContent = phase2Count;
            document.getElementById('rentalCount').textContent = rentalCount;
            document.getElementById('availableCount').textContent = availableCount;
        }

        // 모델 필터 업데이트
        function updateModelFilter() {
            const modelFilter = document.getElementById('modelFilter');
            const models = [...new Set(rentalData.map(item => item.productName).filter(Boolean))];
            
            modelFilter.innerHTML = '<option value="">전체 모델</option>';
            models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelFilter.appendChild(option);
            });
        }

        // 대여 관리 표시 업데이트
        function updateRentalDisplay() {
            const tbody = document.getElementById('rentalTableBody');
            const startIndex = (currentRentalPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = rentalData.slice(startIndex, endIndex);

            tbody.innerHTML = '';
            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="rental-checkbox" data-key="${item.key}"></td>
                    <td>${startIndex + index + 1}</td>
                    <td><a href="#" onclick="editRental('${item.key}')" style="color: #4a6cf7; text-decoration: none;">${item.managementId || ''}</a></td>
                    <td>${item.serial || ''}</td>
                    <td>${item.schoolName || ''}</td>
                    <td>${item.schoolLevel || ''}</td>
                    <td>${item.studentName || ''}</td>
                    <td>${item.productName || ''}</td>
                    <td><span class="status-badge ${item.status === '대여중' ? 'status-rental' : 'status-available'}">${item.status || '미대여중'}</span></td>
                    <td>${item.memo1 || ''}</td>
                    <td>${item.memo2 || ''}</td>
                    <td>${item.other || ''}</td>
                `;
                tbody.appendChild(row);
            });

            updateRentalPagination();
        }

        // 대여 관리 페이지네이션 업데이트
        function updateRentalPagination() {
            const totalPages = Math.ceil(rentalData.length / itemsPerPage);
            document.getElementById('totalRentalPages').textContent = totalPages;
            document.getElementById('currentRentalPage').value = currentRentalPage;
            
            document.getElementById('prevRentalPage').disabled = currentRentalPage <= 1;
            document.getElementById('nextRentalPage').disabled = currentRentalPage >= totalPages;
        }

        // 대여 관리 페이지 변경
        function changeRentalPage(direction) {
            const totalPages = Math.ceil(rentalData.length / itemsPerPage);
            const newPage = currentRentalPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentRentalPage = newPage;
                updateRentalDisplay();
            }
        }

        // 대여 관리 페이지 이동
        function goToRentalPage() {
            const page = parseInt(document.getElementById('currentRentalPage').value);
            const totalPages = Math.ceil(rentalData.length / itemsPerPage);
            
            if (page >= 1 && page <= totalPages) {
                currentRentalPage = page;
                updateRentalDisplay();
            }
        }

        // 제품 관리 표시 업데이트
        function updateProductDisplay() {
            const tbody = document.getElementById('productTableBody');
            const startIndex = (currentProductPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = productData.slice(startIndex, endIndex);

            tbody.innerHTML = '';
            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="product-checkbox" data-key="${item.key}"></td>
                    <td>${item.phase || ''}</td>
                    <td>${item.managementId || ''}</td>
                    <td>${item.productName || ''}</td>
                    <td>${item.serial || ''}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="editProduct('${item.key}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteProduct('${item.key}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateProductPagination();
        }

        // 제품 관리 페이지네이션 업데이트
        function updateProductPagination() {
            const totalPages = Math.ceil(productData.length / itemsPerPage);
            document.getElementById('totalProductPages').textContent = totalPages;
            document.getElementById('currentProductPage').value = currentProductPage;
            
            document.getElementById('prevProductPage').disabled = currentProductPage <= 1;
            document.getElementById('nextProductPage').disabled = currentProductPage >= totalPages;
        }

        // 제품 관리 페이지 변경
        function changeProductPage(direction) {
            const totalPages = Math.ceil(productData.length / itemsPerPage);
            const newPage = currentProductPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentProductPage = newPage;
                updateProductDisplay();
            }
        }

        // 제품 관리 페이지 이동
        function goToProductPage() {
            const page = parseInt(document.getElementById('currentProductPage').value);
            const totalPages = Math.ceil(productData.length / itemsPerPage);
            
            if (page >= 1 && page <= totalPages) {
                currentProductPage = page;
                updateProductDisplay();
            }
        }

        // 사용자 관리 표시 업데이트
        function updateUserDisplay() {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';
            
            userData.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td><span class="status-badge ${user.role === '최고관리자' ? 'status-rental' : 'status-available'}">${user.role}</span></td>
                    <td>${new Date(user.createdAt).toLocaleDateString('ko-KR')}</td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="editUser('${user.key}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${user.username !== 'admin' ? `<button class="btn btn-danger btn-sm" onclick="deleteUser('${user.key}')"><i class="fas fa-trash"></i></button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 피드백 관리 표시 업데이트
        function updateFeedbackDisplay() {
            const tbody = document.getElementById('feedbackTableBody');
            tbody.innerHTML = '';
            
            feedbackData.forEach((feedback, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><a href="#" onclick="viewFeedback('${feedback.key}')" style="color: #4a6cf7; text-decoration: none;">${feedback.title}</a></td>
                    <td>${feedback.author}</td>
                    <td>${new Date(feedback.createdAt).toLocaleDateString('ko-KR')}</td>
                    <td>${feedback.views || 0}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteFeedback('${feedback.key}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // 모달 관련 함수들
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            
            // 폼 초기화
            const modal = document.getElementById(modalId);
            const inputs = modal.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                } else {
                    input.value = '';
                }
            });
        }

        // 대여 추가 모달 표시
        function showAddRentalModal() {
            showModal('addRentalModal');
        }

        // 새 대여 추가
        function addNewRental() {
            const newRental = {
                managementId: document.getElementById('newRentalId').value,
                serial: document.getElementById('newRentalSerial').value,
                schoolName: document.getElementById('newSchoolName').value,
                schoolLevel: document.getElementById('newSchoolLevel').value,
                studentName: document.getElementById('newStudentName').value,
                productName: document.getElementById('newProductName').value,
                status: '대여중',
                memo1: document.getElementById('newMemo1').value,
                memo2: document.getElementById('newMemo2').value,
                studentBirth: document.getElementById('newStudentBirth').value,
                studentPhone: document.getElementById('newStudentPhone').value,
                consentDate: document.getElementById('newConsentDate').value,
                parentName: document.getElementById('newParentName').value,
                relation: document.getElementById('newRelation').value,
                parentPhone: document.getElementById('newParentPhone').value,
                other: document.getElementById('newOther').value,
                createdAt: new Date().toISOString()
            };

            // Firebase에 저장
            database.ref('rentals').push(newRental)
                .then(() => {
                    showAlert('새 대여가 성공적으로 추가되었습니다.', 'success');
                    closeModal('addRentalModal');
                })
                .catch((error) => {
                    showAlert('저장 중 오류가 발생했습니다: ' + error.message, 'error');
                });
        }

        // 대여 정보 수정
        function editRental(key) {
            const rental = rentalData.find(item => item.key === key);
            if (!rental) return;

            editingRentalId = key;
            
            // 모달에 데이터 채우기
            document.getElementById('editRentalId').value = rental.managementId || '';
            document.getElementById('editRentalSerial').value = rental.serial || '';
            document.getElementById('editSchoolName').value = rental.schoolName || '';
            document.getElementById('editSchoolLevel').value = rental.schoolLevel || '';
            document.getElementById('editStudentName').value = rental.studentName || '';
            document.getElementById('editProductName').value = rental.productName || '';
            document.getElementById('editRentalStatus').value = rental.status || '미대여중';
            document.getElementById('editMemo1').value = rental.memo1 || '';
            document.getElementById('editMemo2').value = rental.memo2 || '';
            document.getElementById('editStudentBirth').value = rental.studentBirth || '';
            document.getElementById('editStudentPhone').value = rental.studentPhone || '';
            document.getElementById('editConsentDate').value = rental.consentDate || '';
            document.getElementById('editParentName').value = rental.parentName || '';
            document.getElementById('editRelation').value = rental.relation || '';
            document.getElementById('editParentPhone').value = rental.parentPhone || '';
            document.getElementById('editOther').value = rental.other || '';
            
            // 악세사리 정보
            document.getElementById('editCharger').value = rental.charger || '양호';
            document.getElementById('editCable').value = rental.cable || '양호';
            document.getElementById('editUsbAdapter').value = rental.usbAdapter || '양호';
            document.getElementById('editMouse').value = rental.mouse || '양호';
            document.getElementById('editBag').value = rental.bag || '양호';
            document.getElementById('editCase').value = rental.case || '양호';

            showModal('editRentalModal');
        }

        // 대여 정보 저장
        function saveRentalEdit() {
            if (!editingRentalId) return;

            const updatedRental = {
                managementId: document.getElementById('editRentalId').value,
                serial: document.getElementById('editRentalSerial').value,
                schoolName: document.getElementById('editSchoolName').value,
                schoolLevel: document.getElementById('editSchoolLevel').value,
                studentName: document.getElementById('editStudentName').value,
                productName: document.getElementById('editProductName').value,
                status: document.getElementById('editRentalStatus').value,
                memo1: document.getElementById('editMemo1').value,
                memo2: document.getElementById('editMemo2').value,
                studentBirth: document.getElementById('editStudentBirth').value,
                studentPhone: document.getElementById('editStudentPhone').value,
                consentDate: document.getElementById('editConsentDate').value,
                parentName: document.getElementById('editParentName').value,
                relation: document.getElementById('editRelation').value,
                parentPhone: document.getElementById('editParentPhone').value,
                other: document.getElementById('editOther').value,
                charger: document.getElementById('editCharger').value,
                cable: document.getElementById('editCable').value,
                usbAdapter: document.getElementById('editUsbAdapter').value,
                mouse: document.getElementById('editMouse').value,
                bag: document.getElementById('editBag').value,
                case: document.getElementById('editCase').value,
                updatedAt: new Date().toISOString()
            };

            // 기존 데이터 병합
            const existingData = rentalData.find(item => item.key === editingRentalId);
            const finalData = { ...existingData, ...updatedRental };

            database.ref('rentals/' + editingRentalId).set(finalData)
                .then(() => {
                    showAlert('대여 정보가 성공적으로 수정되었습니다.', 'success');
                    closeModal('editRentalModal');
                    editingRentalId = null;
                })
                .catch((error) => {
                    showAlert('저장 중 오류가 발생했습니다: ' + error.message, 'error');
                });
        }

        // 제품 추가 모달 표시
        function showAddProductModal() {
            showModal('addProductModal');
        }

        // 새 제품 추가
        function addNewProduct() {
            const newProduct = {
                phase: document.getElementById('newProductPhase').value,
                managementId: document.getElementById('newProductId').value,
                productName: document.getElementById('newProductNameInput').value,
                serial: document.getElementById('newProductSerial').value,
                createdAt: new Date().toISOString()
            };

            database.ref('products').push(newProduct)
                .then(() => {
                    showAlert('새 제품이 성공적으로 추가되었습니다.', 'success');
                    closeModal('addProductModal');
                })
                .catch((error) => {
                    showAlert('저장 중 오류가 발생했습니다: ' + error.message, 'error');
                });
        }

        // 제품 삭제
        function deleteProduct(key) {
            if (confirm('이 제품을 삭제하시겠습니까?')) {
                database.ref('products/' + key).remove()
                    .then(() => {
                        showAlert('제품이 삭제되었습니다.', 'success');
                    })
                    .catch((error) => {
                        showAlert('삭제 중 오류가 발생했습니다: ' + error.message, 'error');
                    });
            }
        }

        // 사용자 추가 모달 표시
        function showAddUserModal() {
            showModal('addUserModal');
        }

        // 새 사용자 추가
        function addNewUser() {
            const newUser = {
                username: document.getElementById('newUsername').value,
                password: document.getElementById('newPassword').value,
                role: document.getElementById('newUserRole').value,
                createdAt: new Date().toISOString()
            };

            database.ref('users').push(newUser)
                .then(() => {
                    showAlert('새 사용자가 성공적으로 추가되었습니다.', 'success');
                    closeModal('addUserModal');
                })
                .catch((error) => {
                    showAlert('저장 중 오류가 발생했습니다: ' + error.message, 'error');
                });
        }

        // 사용자 삭제
        function deleteUser(key) {
            if (confirm('이 사용자를 삭제하시겠습니까?')) {
                database.ref('users/' + key).remove()
                    .then(() => {
                        showAlert('사용자가 삭제되었습니다.', 'success');
                    })
                    .catch((error) => {
                        showAlert('삭제 중 오류가 발생했습니다: ' + error.message, 'error');
                    });
            }
        }

        // 피드백 추가 모달 표시
        function showAddFeedbackModal() {
            showModal('addFeedbackModal');
        }

        // 새 피드백 추가
        function addNewFeedback() {
            const newFeedback = {
                title: document.getElementById('newFeedbackTitle').value,
                content: document.getElementById('newFeedbackContent').value,
                author: currentUser.username,
                views: 0,
                createdAt: new Date().toISOString()
            };

            database.ref('feedback').push(newFeedback)
                .then(() => {
                    showAlert('피드백이 성공적으로 추가되었습니다.', 'success');
                    closeModal('addFeedbackModal');
                })
                .catch((error) => {
                    showAlert('저장 중 오류가 발생했습니다: ' + error.message, 'error');
                });
        }

        // 피드백 삭제
        function deleteFeedback(key) {
            if (confirm('이 피드백을 삭제하시겠습니까?')) {
                database.ref('feedback/' + key).remove()
                    .then(() => {
                        showAlert('피드백이 삭제되었습니다.', 'success');
                    })
                    .catch((error) => {
                        showAlert('삭제 중 오류가 발생했습니다: ' + error.message, 'error');
                    });
            }
        }

        // Excel 업로드 관련 함수들
        function downloadRentalSample() {
            const headers = [
                '순번', '관리번호', '제품시리얼', '학교명', '학교급', '학생명', '상태', 
                '메모1', '메모2', '학생생년월일', '학생연락처', '개인정보동의일자', 
                '보호자명', '관계', '보호자연락처', '기타사항'
            ];
            
            const sampleData = [
                ['1', '2025-NEW1', 'UPLOADED001', '연동초등학교', '초등학교', '홍길동', '대여중', '연동샘플', '테스트', '20120101', '010-1234-5678', '20250101', '홍부모', '부모', '010-9876-5432', '샘플 데이터']
            ];
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([headers, ...sampleData]);
            XLSX.utils.book_append_sheet(wb, ws, '대여관리');
            XLSX.writeFile(wb, '대여관리_업로드샘플.xlsx');
        }

        function downloadProductSample() {
            const headers = ['차수', '관리번호', '제품명', '시리얼'];
            const sampleData = [
                ['1차', '2025-UPLOAD1', '업로드노트북', 'UPLOADSERIAL001'],
                ['2차', '2025-UPLOAD2', '업로드태블릿', 'UPLOADSERIAL002']
            ];
            
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet([headers, ...sampleData]);
            XLSX.utils.book_append_sheet(wb, ws, '제품관리');
            XLSX.writeFile(wb, '제품관리_업로드샘플.xlsx');
        }

        function handleRentalUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});

                    if (jsonData.length < 2) {
                        showAlert('Excel 파일에 데이터가 없습니다.', 'error');
                        return;
                    }

                    const headers = jsonData[0];
                    const rows = jsonData.slice(1);
                    
                    // 대여 데이터 처리
                    let uploadCount = 0;
                    const uploadPromises = rows.map(row => {
                        if (row.some(cell => cell !== undefined && cell !== '')) {
                            const rentalData = {
                                managementId: row[1] || '',
                                serial: row[2] || '',
                                schoolName: row[3] || '',
                                schoolLevel: row[4] || '',
                                studentName: row[5] || '',
                                status: '대여중', // 업로드 시 모두 대여중으로 설정
                                memo1: row[7] || '',
                                memo2: row[8] || '',
                                studentBirth: row[9] || '',
                                studentPhone: row[10] || '',
                                consentDate: row[11] || '',
                                parentName: row[12] || '',
                                relation: row[13] || '',
                                parentPhone: row[14] || '',
                                other: row[15] || '',
                                createdAt: new Date().toISOString()
                            };

                            uploadCount++;
                            return database.ref('rentals').push(rentalData);
                        }
                        return Promise.resolve();
                    });

                    Promise.all(uploadPromises)
                        .then(() => {
                            showAlert(`${uploadCount}개의 대여 데이터가 성공적으로 업로드되었습니다.`, 'success');
                            event.target.value = ''; // 파일 입력 초기화
                        })
                        .catch((error) => {
                            showAlert('업로드 중 오류가 발생했습니다: ' + error.message, 'error');
                        });

                } catch (error) {
                    showAlert('Excel 파일을 읽는 중 오류가 발생했습니다: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function handleProductUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});

                    if (jsonData.length < 2) {
                        showAlert('Excel 파일에 데이터가 없습니다.', 'error');
                        return;
                    }

                    const headers = jsonData[0];
                    const rows = jsonData.slice(1);
                    
                    // 제품 데이터 처리
                    let uploadCount = 0;
                    const uploadPromises = rows.map(row => {
                        if (row.some(cell => cell !== undefined && cell !== '')) {
                            const productData = {
                                phase: row[0] || '',
                                managementId: row[1] || '',
                                productName: row[2] || '',
                                serial: row[3] || '',
                                createdAt: new Date().toISOString()
                            };

                            uploadCount++;
                            return database.ref('products').push(productData);
                        }
                        return Promise.resolve();
                    });

                    Promise.all(uploadPromises)
                        .then(() => {
                            showAlert(`${uploadCount}개의 제품 데이터가 성공적으로 업로드되었습니다.`, 'success');
                            event.target.value = ''; // 파일 입력 초기화
                        })
                        .catch((error) => {
                            showAlert('업로드 중 오류가 발생했습니다: ' + error.message, 'error');
                        });

                } catch (error) {
                    showAlert('Excel 파일을 읽는 중 오류가 발생했습니다: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // 검색 및 필터 함수들
        function searchRentals() {
            // 검색 로직 구현
            updateRentalDisplay();
        }

        function resetRentalFilters() {
            document.getElementById('rentalSearch').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('phaseFilter').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            updateRentalDisplay();
        }

        function searchProducts() {
            // 검색 로직 구현
            updateProductDisplay();
        }

        function resetProductFilters() {
            document.getElementById('productSearch').value = '';
            updateProductDisplay();
        }

        function searchFeedback() {
            // 검색 로직 구현
            updateFeedbackDisplay();
        }

        // 전체 선택/해제
        function toggleAllRentals() {
            const selectAll = document.getElementById('selectAllRentals');
            const checkboxes = document.querySelectorAll('.rental-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        function toggleAllProducts() {
            const selectAll = document.getElementById('selectAllProducts');
            const checkboxes = document.querySelectorAll('.product-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        // 전체 삭제
        function deleteAllRentals() {
            if (confirm('모든 대여 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                database.ref('rentals').remove()
                    .then(() => {
                        showAlert('모든 대여 데이터가 삭제되었습니다.', 'success');
                    })
                    .catch((error) => {
                        showAlert('삭제 중 오류가 발생했습니다: ' + error.message, 'error');
                    });
            }
        }

        function deleteAllProducts() {
            if (confirm('모든 제품 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                database.ref('products').remove()
                    .then(() => {
                        showAlert('모든 제품 데이터가 삭제되었습니다.', 'success');
                    })
                    .catch((error) => {
                        showAlert('삭제 중 오류가 발생했습니다: ' + error.message, 'error');
                    });
            }
        }

        // 알림 표시
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            // 현재 활성 페이지에 알림 표시
            const activePage = document.querySelector('.page.active');
            activePage.insertBefore(alertDiv, activePage.firstChild);
            
            // 3초 후 자동 제거
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // 모달 드래그 기능
        document.addEventListener('DOMContentLoaded', function() {
            const modals = document.querySelectorAll('.modal-content');
            modals.forEach(modal => {
                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                let xOffset = 0;
                let yOffset = 0;

                const header = modal.querySelector('.modal-header');
                if (header) {
                    header.style.cursor = 'move';
                    header.addEventListener('mousedown', dragStart);
                }

                function dragStart(e) {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;

                    if (e.target === header || header.contains(e.target)) {
                        isDragging = true;
                    }
                }

                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', dragEnd);

                function drag(e) {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;

                        xOffset = currentX;
                        yOffset = currentY;

                        setTranslate(currentX, currentY, modal);
                    }
                }

                function dragEnd(e) {
                    initialX = currentX;
                    initialY = currentY;
                    isDragging = false;
                }

                function setTranslate(xPos, yPos, el) {
                    el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
                }
            });
        });
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"954a3fbe3897d771","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDm1hPKF32GSuOBNn6yYi4ot%2BdjPfn8%2FYC2JoNGYPR%2FAxPrrvwswyS5Cc9zHC7Nyf1P2HSR6%2FZ%2F7%2Bx%2FG4%2BOBfh%2FyAsB7FwT1LvVEL11zXoVioaKCByvfn8heYw6xmy8PVxaAYYHssdEaffhnw0qiwupvIyVZO1kQoqK6gPCpblpI4uGxxoCU48vp1kfZWIoOXqs55oHVSQ8Dm6h0VLbrZyWacvNb8Z3uolevCTHZv%2Fik%2FxY%2Fc16u5yyPaNcGj4pFmHb61%2Fw8HCdcStJq9s6kHPHV%2Fy1VhJHSgfn7wVSTt0ofsxQtLzcqa6Xk1PfCpTM01soFipG6GhtcU78I3WP%2FNIwQkeu%2FjDxoG6YxLDV0EF%2BI3jr4dgxZD153GelqWtWfb%2BJP4ZIr6zaQyBjtMwx87IH7TmxU6DabBSR5w6MJpcfClT8MSEolS7LX5AZR%2BIjkuOJH%2Fx8gdGfEbIytj2ZYkVmUipEUhPv7uqJ4gVriqYdJtURbU1tmSPdGsvoiCJhP0jJm2rgqKkwLCC4dgznhpyZ8%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDm1hPKF32GSuOBNn6yYi4ot+djPfn8/YC2JoNGYPR/AxPrrvwswyS5Cc9zHC7Nyf1P2HSR6/Z/7+x/G4+OBfh/yAsB7FwT1LvVEL11zXoVioaKCByvfn8heYw6xmy8PVxaAYYHssdEaffhnw0qiwupvIyVZO1kQoqK6gPCpblpI4uGxxoCU48vp1kfZWIoOXqs55oHVSQ8Dm6h0VLbrZyWacvNb8Z3uolevCTHZv/ik/xY/c16u5yyPaNcGj4pFmHb61/w8HCdcStJq9s6kHPHV/y1VhJHSgfn7wVSTt0ofsxQtLzcqa6Xk1PfCpTM01soFipG6GhtcU78I3WP/NIwQkeu/jDxoG6YxLDV0EF+I3jr4dgxZD153GelqWtWfb+JP4ZIr6zaQyBjtMwx87IH7TmxU6DabBSR5w6MJpcfClT8MSEolS7LX5AZR+IjkuOJH/x8gdGfEbIytj2ZYkVmUipEUhPv7uqJ4gVriqYdJtURbU1tmSPdGsvoiCJhP0jJm2rgqKkwLCC4dgznhpyZ8=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
